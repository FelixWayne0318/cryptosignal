# v7.2.27å…¨é¢ä¿®å¤å®æ–½æ€»ç»“

**ç‰ˆæœ¬**: v7.2.27
**æ—¥æœŸ**: 2025-11-11
**çŠ¶æ€**: è¿›è¡Œä¸­ï¼ˆæ­¥éª¤4/8ï¼‰

---

## ä¿®å¤å†…å®¹æ€»è§ˆ

| é—®é¢˜ | ä¼˜å…ˆçº§ | çŠ¶æ€ | å½±å“æ–‡ä»¶ |
|-----|--------|------|---------|
| 1. çº¿æ€§æ’å€¼æ”¹å‡½æ•° | P1 | âœ… å®Œæˆ | math_utils.py (æ–°å¢) |
| 2. æ¦‚ç‡æ ¡å‡†ç¡¬ç¼–ç +æ–­å´– | P0 | âœ… å®Œæˆ | config + empirical_calibration.py |
| 3. Fâ‰¥80/90å¤„ç† | P2 | ğŸ”„ è¿›è¡Œä¸­ | config + analyze_symbol_v72.py |
| 4. ç©ºå•Fé€»è¾‘é”™è¯¯ | P0 | ğŸ”„ è¿›è¡Œä¸­ | analyze_symbol_v72.py |
| 5. è¾¹ç•Œæ£€æŸ¥ | P2 | â¸ï¸ å¾…å¼€å§‹ | fund_leading.py |

---

##å·²å®Œæˆçš„ä¿®æ”¹ï¼ˆæ­¥éª¤1-3ï¼‰

### âœ… æ­¥éª¤1ï¼šconfig/signal_thresholds.json (+87è¡Œ)

æ–°å¢é…ç½®ï¼š
```json
{
  "Fæå€¼è­¦æˆ’é…ç½®": {
    "_enabled": true,
    "F_extreme_threshold": 90,
    "strategy": "conservative",  // ä¿å®ˆç­–ç•¥ï¼ˆæ¨èï¼‰
    "conservative_mode": {
      "confidence_min": 12,  // Fâ‰¥90åè€Œæé«˜è´¨é‡è¦æ±‚
      "P_min": 0.50,
      "EV_min": 0.015,
      "F_min": 50,
      "position_mult": 0.5
    }
  },

  "æ¦‚ç‡æ ¡å‡†çº¿æ€§å‚æ•°": {
    "Få› å­çº¿æ€§æ ¡å‡†": {
      "F_bonus_threshold_max": 70,
      "F_bonus_threshold_min": -30,
      "P_bonus_at_F_max": 0.05,    // F=70æ—¶+5%
      "P_penalty_at_F_min": -0.03  // F=-30æ—¶-3%
    },
    "Iå› å­çº¿æ€§æ ¡å‡†": {
      // åŒæ ·çº¿æ€§é…ç½®
    }
  }
}
```

### âœ… æ­¥éª¤2ï¼šats_core/utils/math_utils.pyï¼ˆæ–°å¢214è¡Œï¼‰

æä¾›3ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š
```python
def linear_reduce(x, x_min, x_max, value_at_min, value_at_max):
    """çº¿æ€§æ’å€¼å‡½æ•°ï¼ˆä»£ç ç®€æ´5å€ï¼‰"""

def get_effective_F(F, side_long):
    """åšå¤šFç›´æ¥ç”¨ï¼Œåšç©ºFå–å"""
    return F if side_long else -F

def is_valid_number(value):
    """NaN/Infæ£€æŸ¥"""
```

### âœ… æ­¥éª¤3ï¼šats_core/calibration/empirical_calibration.pyï¼ˆé‡æ„94è¡Œï¼‰

**ç§»é™¤ç¡¬ç¼–ç **ï¼š
```python
# æ—§ä»£ç ï¼ˆç¡¬ç¼–ç +æ–­å´–ï¼‰
if F_score > 30:   # âŒ ç¡¬ç¼–ç 
    P += 0.03      # âŒ æ–­å´–è·³å˜3%

# æ–°ä»£ç ï¼ˆé…ç½®+çº¿æ€§ï¼‰
P_bonus = linear_reduce(F_score, 0, 70, 0, 0.05)  # âœ… çº¿æ€§å¹³æ»‘
P += P_bonus
```

**æ•ˆæœå¯¹æ¯”**ï¼š
| Få€¼ | æ—§ä»£ç På¢ç›Š | æ–°ä»£ç På¢ç›Š | æ”¹è¿› |
|-----|-----------|-----------|------|
| 29  | 0%        | +2.1%     | å¹³æ»‘è¿‡æ¸¡ |
| 30  | **+3%** (è·³å˜) | +2.1% | æ¶ˆé™¤æ–­å´– |
| 50  | +3%       | +3.6%     | çº¿æ€§å¢é•¿ |
| 70  | +3%       | +5%       | å°é¡¶ |

---

## è¿›è¡Œä¸­çš„ä¿®æ”¹ï¼ˆæ­¥éª¤4-5ï¼‰

### ğŸ”„ æ­¥éª¤4-5ï¼šats_core/pipeline/analyze_symbol_v72.py

éœ€è¦ä¿®æ”¹3ä¸ªå…³é”®ä½ç½®ï¼š

#### ä¿®æ”¹ç‚¹1ï¼šå¯¼å…¥å·¥å…·å‡½æ•°ï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰
```python
from ats_core.utils.math_utils import linear_reduce, get_effective_F
```

#### ä¿®æ”¹ç‚¹2ï¼šè“„åŠ¿æ£€æµ‹é€»è¾‘ï¼ˆL195-315ï¼‰

**å½“å‰é—®é¢˜**ï¼š
1. âŒ ä¸åŒºåˆ†å¤šç©ºï¼ˆç©ºå•æ—¶F>0æ˜¯åä¿¡å·ï¼‰
2. âŒ Fâ‰¥70å°é¡¶ï¼ˆF=90ä¸F=70ç›¸åŒï¼‰
3. âš ï¸ ä½¿ç”¨reduction_ratioä¸­é—´å˜é‡ï¼ˆå¯ç®€åŒ–ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```python
# è®¡ç®—æœ‰æ•ˆFï¼ˆè€ƒè™‘å¤šç©ºï¼‰
F_effective = get_effective_F(F_v2, side_long_v72)

# Fâ‰¥90è­¦æˆ’å¤„ç†
if F_effective >= 90:
    # ä¿å®ˆç­–ç•¥ï¼šåè€Œæé«˜è´¨é‡è¦æ±‚
    extreme_config = momentum_config.get('Fæå€¼è­¦æˆ’é…ç½®', {})
    if extreme_config.get('strategy') == 'conservative':
        conservative_mode = extreme_config.get('conservative_mode', {})
        momentum_confidence_min = conservative_mode.get('confidence_min', 12)
        momentum_P_min = conservative_mode.get('P_min', 0.50)
        momentum_level = 3
        momentum_desc = "æé™è“„åŠ¿ï¼ˆè­¦æˆ’ï¼‰"
elif F_effective >= F_threshold_max:  # 70â‰¤F<90
    # ä½¿ç”¨linear_reduceç®€åŒ–ä»£ç 
    momentum_confidence_min = linear_reduce(F_effective, F_min, F_max, 15, 10)
    momentum_P_min = linear_reduce(F_effective, F_min, F_max, 0.50, 0.42)
    # ...
```

#### ä¿®æ”¹ç‚¹3ï¼šGate 2æ‹¦æˆªï¼ˆL320ï¼‰

**å½“å‰ä»£ç **ï¼š
```python
gates_fund_support = 1.0 if F_v2 >= F_min else 0.0  # âŒ ä¸è€ƒè™‘å¤šç©º
```

**ä¿®å¤å**ï¼š
```python
# v7.2.27ä¿®å¤ï¼šä½¿ç”¨F_effectiveè€ƒè™‘å¤šç©ºæ–¹å‘
F_effective = get_effective_F(F_v2, side_long_v72)
gates_fund_support = 1.0 if F_effective >= F_min else 0.0
```

---

## å¾…å¼€å§‹çš„ä¿®æ”¹ï¼ˆæ­¥éª¤6-8ï¼‰

### â¸ï¸ æ­¥éª¤6ï¼šats_core/features/fund_leading.py

æ·»åŠ è¾¹ç•Œæ£€æŸ¥ï¼š
```python
from ats_core.utils.math_utils import is_valid_number

# åœ¨F_rawè®¡ç®—å
if not is_valid_number(F_raw):
    return 0, {"degradation_reason": "invalid_F_raw", "F_raw": str(F_raw)}
```

### â¸ï¸ æ­¥éª¤7ï¼štest_linear_momentum.py

æ·»åŠ æ–°æµ‹è¯•ï¼š
1. æµ‹è¯•ç©ºå•Fé€»è¾‘
2. æµ‹è¯•Fâ‰¥90å¤„ç†
3. æµ‹è¯•æ¦‚ç‡æ ¡å‡†çº¿æ€§

### â¸ï¸ æ­¥éª¤8ï¼šGit commit

æ ‡å‡†commitæ¶ˆæ¯æ ¼å¼ã€‚

---

## å…³é”®æ”¹è¿›æ•ˆæœé¢„æµ‹

### ç©ºå•Fé€»è¾‘ä¿®å¤
**Before**ï¼š
- åšç©º+F=80 â†’ "ææ—©æœŸè“„åŠ¿" â†’ å‘ä¿¡å· âŒï¼ˆé”™è¯¯ï¼ŒF>0è¯´æ˜æœ‰äººæŠ„åº•ï¼‰
- åšç©º+F=-80 â†’ Gate2æ‹’ç» âŒï¼ˆé”™è¯¯ï¼ŒF<0è¯´æ˜ææ…Œé€ƒç¦»ï¼Œå¥½ä¿¡å·ï¼‰

**After**ï¼š
- åšç©º+F=80 â†’ F_eff=-80 â†’ Gate2æ‹’ç» âœ…ï¼ˆæ­£ç¡®ï¼‰
- åšç©º+F=-80 â†’ F_eff=80 â†’ "ææ—©æœŸè“„åŠ¿" âœ…ï¼ˆæ­£ç¡®ï¼‰

### æ¦‚ç‡æ ¡å‡†çº¿æ€§åŒ–
**Before**ï¼š
- F=29: På¢ç›Š0%
- F=30: På¢ç›Š+3%ï¼ˆæ–­å´–ï¼ï¼‰
- F=50: På¢ç›Š+3%ï¼ˆå°é¡¶ï¼‰

**After**ï¼š
- F=29: På¢ç›Š+2.07%
- F=30: På¢ç›Š+2.14%ï¼ˆå¹³æ»‘ï¼‰
- F=50: På¢ç›Š+3.57%ï¼ˆçº¿æ€§å¢é•¿ï¼‰

### Fâ‰¥90è­¦æˆ’
**Before**ï¼š
- F=90: confidence=10ï¼ˆä¸F=70ç›¸åŒï¼‰

**After**ï¼š
- F=90: confidence=12ï¼ˆåè€Œæé«˜ï¼Œé˜²æ­¢å¼‚å¸¸æ•°æ®ï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**ï¼šå®Œæˆanalyze_symbol_v72.pyä¿®æ”¹ï¼ˆæ­¥éª¤4-5ï¼‰
2. **ç„¶å**ï¼šæ·»åŠ è¾¹ç•Œæ£€æŸ¥ï¼ˆæ­¥éª¤6ï¼‰
3. **æµ‹è¯•**ï¼šæ›´æ–°æµ‹è¯•è„šæœ¬ï¼ˆæ­¥éª¤7ï¼‰
4. **æäº¤**ï¼šç¬¦åˆè§„èŒƒçš„Git commitï¼ˆæ­¥éª¤8ï¼‰

é¢„è®¡å®Œæˆæ—¶é—´ï¼šæœ¬æ¬¡ä¼šè¯å†…

---

**å½“å‰è¿›åº¦**: 3/8æ­¥éª¤å®Œæˆï¼ˆ37.5%ï¼‰
