================================================================================
CryptoSignal v6.1 服务器部署命令（标准流程）
================================================================================

⚠️ 重要：本文档已纳入标准化部署规范
详细规范见：docs/DEPLOYMENT_STANDARD.md

================================================================================
标准部署流程（4步）
================================================================================

# ============================================================================
# 第 1 步：进入项目目录并拉取代码
# ============================================================================
cd ~/cryptosignal

git fetch origin claude/review-system-overview-011CUhLQjByWuXC1bySJCHKQ
git checkout claude/review-system-overview-011CUhLQjByWuXC1bySJCHKQ
git pull origin claude/review-system-overview-011CUhLQjByWuXC1bySJCHKQ

# 验证：应该看到最新提交
git log --oneline -3

# ============================================================================
# 第 2 步：配置 Binance API 凭证（首次部署必需）
# ============================================================================

# 创建 Binance API 配置文件
cat > config/binance_credentials.json <<'EOF'
{
  "_comment": "Binance Futures API凭证配置",
  "binance": {
    "api_key": "您的API_KEY",
    "api_secret": "您的SECRET_KEY",
    "testnet": false,
    "_security": "只读权限API Key，不具备交易功能"
  }
}
EOF

# ⚠️ 重要：请将上面的 "您的API_KEY" 和 "您的SECRET_KEY" 替换为真实凭证
# 然后重新运行上面的 cat 命令

# 验证配置
python3 -c "
import json
with open('config/binance_credentials.json') as f:
    bn = json.load(f)['binance']
    if bn['api_key'] != '您的API_KEY':
        print('✅ Binance API配置已填写')
    else:
        print('❌ 请先填写API凭证')
"

# ============================================================================
# 第 3 步：运行部署脚本（自动验证 + 可选启动）
# ============================================================================
./deploy_v6.1.sh

# 脚本会自动完成：
#   1. 停止旧进程并备份配置
#   2. 验证代码修复（I因子架构、Prime阈值、防抖动）
#   3. 验证配置文件（Binance、Telegram）
#   4. 清理 Python 缓存
#   5. 快速测试运行（10秒验证）
#   6. 显示启动命令
#   7. 询问是否立即启动 ⬅️ 新增：支持直接启动（每5分钟扫描）

# 部署脚本会询问：
# "是否立即启动生产环境？(每5分钟扫描一次) [y/N]:"
#
# 选择 y：自动启动（Screen会话或nohup后台）⬅️ 推荐
# 选择 N：稍后手动启动

# ============================================================================
# 第 4 步：验证运行状态（如果第3步选择了启动）
# ============================================================================

# 检查进程
ps aux | grep realtime_signal_scanner

# 查看日志（Screen）
screen -r cryptosignal
# 按 Ctrl+A 然后 D 退出

# 查看日志（nohup）
tail -f logs/scanner_*.log

# ============================================================================
# 常用命令
# ============================================================================

# 重连Screen会话
screen -r cryptosignal

# 停止进程
ps aux | grep realtime_signal_scanner | grep -v grep | awk '{print $2}' | xargs kill

# 查看运行状态
ps aux | grep realtime_signal_scanner | grep -v grep

# 查看Telegram是否收到信号
# （检查Telegram app中的通知）

================================================================================
v6.1 修复摘要
================================================================================

✅ I因子架构修正（A层 → B层）
✅ Prime阈值降低（35 → 25分）
✅ 概率阈值降低（0.62 → 0.58）
✅ 防抖动放宽（1/2确认，60秒冷却，0.65阈值）

预期效果：
  • 信号量：3-7个Prime信号/小时（140币种）
  • 响应速度：提升33%
  • 信号质量：维持高质量

================================================================================
故障排查
================================================================================

如果遇到问题：

1. 依赖缺失
   pip3 install -r requirements.txt

2. 配置文件不存在
   检查 config/binance_credentials.json 和 config/telegram.json

3. 进程异常退出
   前台运行查看错误：python3 scripts/realtime_signal_scanner.py --interval 300

4. 详细文档
   查看 DEPLOYMENT_v6.1.md

================================================================================
