# Configuration Changelog

> **记录config/params.json的所有重大变更**

---

## v6.0 - 2025-10-30

### 重大变更：权重系统升级

**从180/160分制 → 100%百分比系统**

#### 变更内容

1. **权重系统**
   - 旧系统: 总权重 = 180分 (v4.0) 或 160分 (v2.0)
   - 新系统: 总权重 = 100.0% (百分比系统)
   - 验证: 启动时自动验证权重总和=100%

2. **因子数量升级**
   - 旧系统: 7维因子 (T/M/C/S/V/O/F)
   - 新系统: 10+1维因子 (T/M/C/S/V/O/L/B/Q/I + F)
   - 新增因子:
     - L (Liquidity) - 流动性因子
     - B (Basis+Funding) - 基差资金费因子
     - Q (Liquidation) - 清算密度因子
     - I (Independence) - 独立性因子

3. **F因子角色变更**
   - 旧系统: F因子权重=0，仅作极端否决器
   - 新系统: F因子权重=10.0%，参与评分 + 极端否决

4. **Prime阈值调整**
   - 旧系统: 65分 (基于180分制)
   - 新系统: 35分 (基于100分制)
   - 转换公式: 65 / 180 * 100 ≈ 36 → 调整为35

#### 权重配置对比

**v4.0/v2.0（旧系统）**:
```json
{
  "weights": {
    "T": 25,
    "M": 20,
    "C": 25,
    "S": 15,
    "V": 20,
    "O": 25,
    "F": 0
  },
  "total": 130  // 实际总和，不包含F
}
```

**v6.0（新系统）**:
```json
{
  "weights": {
    "T": 13.9,  // 趋势
    "M": 8.3,   // 动量
    "C": 11.1,  // CVD
    "S": 5.6,   // 结构
    "V": 8.3,   // 成交量
    "O": 11.1,  // 持仓量
    "L": 11.1,  // 流动性（新增）
    "B": 8.3,   // 基差资金费（新增）
    "Q": 5.6,   // 清算密度（新增）
    "I": 6.7,   // 独立性（新增）
    "E": 0,     // 保留字段
    "F": 10.0   // 资金费率（权重从0→10.0）
  },
  "total": 100.0  // 总和必须=100%
}
```

#### 层级权重分配

```
Layer 1 - 价格行为（36.1%）:
  T(13.9%) + M(8.3%) + S(5.6%) + V(8.3%)

Layer 2 - 资金流（32.2%）:
  C(11.1%) + O(11.1%) + F(10.0%) ⭐ F因子参与评分

Layer 3 - 微观结构（25.0%）:
  L(11.1%) + B(8.3%) + Q(5.6%)

Layer 4 - 市场环境（6.7%）:
  I(6.7%)
```

#### 迁移指南

如果你有旧版本配置，请按以下步骤迁移：

1. **备份当前配置**
   ```bash
   cp config/params.json config/params.json.v4.bak
   ```

2. **更新权重为百分比**
   - 所有权重值除以1.8（如果是180分制）或1.6（如果是160分制）
   - 或者直接使用上面v6.0的推荐权重配置

3. **验证权重总和**
   ```bash
   python3 -c "
   import json
   w = json.load(open('config/params.json'))['weights']
   total = sum(w.values())
   assert abs(total - 100.0) < 0.01, f'总和={total}, 必须=100.0'
   print(f'✓ 权重总和={total}')
   "
   ```

4. **调整Prime阈值**
   ```json
   {
     "publish": {
       "prime_threshold": 35  // 从65调整为35
     }
   }
   ```

5. **测试运行**
   ```bash
   python3 scripts/realtime_signal_scanner.py --max-symbols 20 --once
   ```

#### 配置验证

v6.0系统在启动时会自动验证配置：

- ✅ weights字段存在
- ✅ weights是字典类型
- ✅ 所有权重值是数字
- ✅ 权重总和=100.0%（误差<0.01）
- ✅ 包含必需的10+1维因子

**验证失败示例**:
```
❌ 配置错误: 权重总和必须=100.0% (v6.0系统)
当前总和: 101.0%
修复方法: 调整 config/params.json 中的权重值，确保总和=100.0
```

---

## v4.0 - 2024-XX-XX

### 初始180分制系统

- 7维因子: T/M/C/S/V/O/F
- 总权重: 180分
- F因子权重=0（仅否决器）
- Prime阈值: 65分

---

## 修改规范

今后修改config/params.json必须遵循以下规范：

1. **修改前**: 查阅 `standards/QUICK_REFERENCE.md`
2. **修改后**: 验证权重总和=100%
3. **测试**: 运行 `--max-symbols 20 --once` 测试
4. **提交**: 使用标准提交格式
5. **文档同步**: 如有重大变更，更新本CHANGELOG

### 提交消息格式

```bash
git commit -m "config: 调整T因子权重从13.9%到15.0%

- T: 13.9% → 15.0%（增强趋势权重）
- F: 10.0% → 8.9%（平衡整体权重）
- 总权重: 100.0% ✓
"
```

---

**维护者**: FelixWayne0318/cryptosignal
**最后更新**: 2025-10-30
