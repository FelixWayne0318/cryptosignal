{
  "trend": {
    "ema_order_min_bars": 6,
    "slope_atr_min_long": 0.06,
    "slope_atr_min_short": 0.04,
    "slope_lookback": 12,
    "atr_period": 14
  },

  "accel": {},

  "momentum": {
    "_comment": "P2.2修改：短窗口设计，与T因子正交化（降低70.8%→<50%重叠度）",
    "ema_fast": 3,
    "ema_slow": 5,
    "slope_lookback": 6,
    "slope_scale": 1.00,
    "accel_scale": 1.00,
    "slope_weight": 0.6,
    "accel_weight": 0.4,
    "_p22_rationale": "T因子用EMA5/20捕捉大趋势，M因子用EMA3/5捕捉快速动量→正交化"
  },

  "cvd_flow": {
    "lookback_hours": 6,
    "cvd_scale": 0.02
  },

  "structure": {
    "theta": {
      "big": 0.35,
      "small": 0.40,
      "overlay_add": 0.05,
      "new_phaseA_add": 0.10,
      "strong_regime_sub": 0.05
    }
  },

  "open_interest": {
    "long_oi24_lo": 1.0,
    "long_oi24_hi": 8.0,
    "short_oi24_lo": 2.0,
    "short_oi24_hi": 10.0,
    "upup12_lo": 6,
    "upup12_hi": 12,
    "dnup12_lo": 6,
    "dnup12_hi": 12,
    "crowding_p95_penalty": 10,
    "w_change": 0.7,
    "w_align": 0.3
  },

  "environment": {
    "chop14_max": 52,
    "room_min_for_bonus": 0.5
  },

  "orderbook_depth": {
    "_comment": "v2.2新增：订单簿深度指标（D）",
    "obi_depth": 20,
    "spread_neutral": 5.0,
    "spread_scale": 3.0,
    "liquidity_warning_bps": 10,
    "severe_liquidity_bps": 20
  },

  "funding_rate": {
    "_comment": "v2.2新增：资金费率与基差指标（F）+ FWI - 已废弃，迁移到basis_funding",
    "basis_scale": 50.0,
    "funding_scale": 10.0,
    "extreme_funding_threshold": 0.0015,
    "fwi_window_minutes": 30,
    "fwi_warning_threshold": 2.0
  },

  "liquidity": {
    "_comment": "P2.5修复：价格带法（±bps聚合），对齐专家建议和四道闸",
    "band_bps": 40.0,
    "impact_notional_usdt": 50000.0,
    "impact_threshold_bps": 10.0,
    "obi_threshold": 0.30,
    "spread_threshold_bps": 25.0,
    "spread_weight": 0.25,
    "impact_weight": 0.40,
    "obi_weight": 0.20,
    "coverage_weight": 0.15,
    "default_score_when_unavailable": 50,
    "_default_note": "v7.4.3: 当订单簿数据不可用时（如回测），使用此默认值而非0，避免错误惩罚"
  },

  "basis_funding": {
    "_comment": "v4.0新增：B因子 - 基差+资金费",
    "basis_neutral_bps": 50,
    "basis_extreme_bps": 100,
    "funding_neutral_rate": 0.001,
    "funding_extreme_rate": 0.002,
    "basis_weight": 0.6,
    "funding_weight": 0.4,
    "fwi_enabled": false,
    "fwi_window_minutes": 30,
    "fwi_boost_max": 20
  },

  "microconfirm_15m": {
    "ema10_side_window": 8,
    "ema10_side_min_ok": 6,
    "v3_over_v20_min": 0.8,
    "v3_over_v20_max": 2.2,
    "dV_abs_min": 0.05,
    "dV_abs_max": 0.8,
    "cvd_lookback": 5,
    "micro_pivot_look": 8,
    "micro_pivot_tolerance_atr1h": 0.25,
    "anti_explosion_atr15m_max": 2.5,
    "anti_explosion_vratio_max": 3.5,
    "min_conditions_pass": 2
  },

  "pricing": {
    "entry_ext_max": 0.6,
    "delta_base": 0.02,
    "delta_coef": 0.10,
    "sl_pivot_back": 0.10,
    "sl_atr_back": 1.8,
    "tp1_R": 1.0,
    "tp2_R_max": 2.5,
    "sr_band_lookback": 72,
    "sr_margin": 0.002,
    "room_atr_tp2_floor": 0.6,
    "tp2_room_floor_R": 1.8
  },

  "weights": {
    "_source": "从 config/factors_unified.json 自动加载（v7.4.2配置统一）",
    "_version": "v7.4.2",
    "T": 23.0,
    "M": 10.0,
    "C": 26.0,
    "V": 11.0,
    "O": 20.0,
    "B": 10.0,
    "L": 0.0,
    "S": 0.0,
    "F": 0.0,
    "I": 0.0,
    "E": 0.0
  },
  "weights_comment": {
    "_version": "v7.4.2 - 四步分层决策系统（革命性架构升级）",
    "_total_weight": "100%（A层6因子权重百分比系统）",
    "_layer1_price_action": "Layer 1 价格行为层（44%）: T(23%) + M(10%) + V(11%)",
    "_layer2_capital_flow": "Layer 2 资金流层（46%）: C(26%) + O(20%)",
    "_layer3_microstructure": "Layer 3 微观结构层（10%）: B(10%)",
    "_layer_b_modulators": "B层调制器（不评分）: L(流动性) + S(结构) + F(资金领先) + I(独立性)",
    "_modulator_role": "L/S/F/I仅调制position/Teff/cost/confidence，不修改方向分数",
    "_deprecated": "E(0) - 环境因子已废弃",
    "_removed": "Q因子配置已移除（代码未实现）",
    "_change_log_v6.6": "权重再分配（S的11% + Q的4%）: T+4%, M+3%, C+4%, V+1%, O+3%",
    "_change_log_v6.7_p22": "M权重降低（P1.3分析：T-M相关66.4%）: M-7% (17%→10%), C+3% (24%→27%), O+4% (17%→21%)",
    "_change_log_v7.3.3": "B因子权重提升(+4%): T-1%(24→23), C-1%(27→26), V-1%(12→11), O-1%(21→20)",
    "_v733_rationale": "B因子（基差+资金费）是重要的市场情绪指标，6%权重过低，提升到10%",
    "_rationale": "L/S/F/I是质量指标非方向指标，整合为调制器实现连续仓位调整，消除硬拒绝门槛",
    "_soft_constraints": "仅DataQual≥0.90为硬门槛，EV和P改为软约束（不拒绝信号，仅不发布）"
  },

  "fund_leading": {
    "oi_weight": 0.4,
    "vol_weight": 0.3,
    "cvd_weight": 0.3,
    "trend_weight": 0.6,
    "slope_weight": 0.4,
    "oi_scale": 3.0,
    "vol_scale": 0.3,
    "cvd_scale": 0.02,
    "price_scale": 3.0,
    "slope_scale": 0.01,
    "leading_scale": 200.0,
    "crowding_veto": {
      "_comment": "P0.4: 过热veto机制，防止追高",
      "enabled": true,
      "basis_lookback": 100,
      "funding_lookback": 100,
      "percentile": 90,
      "crowding_penalty": 0.5,
      "min_data_points": 50
    }
  },

  "factor_optimization_v2": {
    "_comment": "P0-P2因子系统优化配置（2024年专家审查修复）",
    "_enabled": true,
    "_issues_fixed": "1.归一化不一致 2.T-M相关性 3.硬编码阈值",

    "adaptive_threshold": {
      "_comment": "P0.1-P0.3: B/V/O因子自适应阈值",
      "mode": "hybrid",
      "_mode_options": "zscore | percentile | legacy | hybrid (推荐)",
      "min_data_points": 50,
      "fallback_to_legacy": true
    },

    "basis_funding_adaptive": {
      "_comment": "P0.1: B因子自适应阈值配置",
      "enabled": true,
      "lookback": 100,
      "neutral_percentile": 50,
      "extreme_percentile": 90,
      "neutral_min_bps": 20.0,
      "neutral_max_bps": 200.0,
      "extreme_min_bps": 50.0,
      "extreme_max_bps": 300.0
    },

    "volume_adaptive": {
      "_comment": "P0.2: V因子自适应阈值配置",
      "enabled": true,
      "lookback": 20,
      "percentile": 50,
      "min_threshold_pct": 0.001,
      "max_threshold_pct": 0.02
    },

    "open_interest_adaptive": {
      "_comment": "P0.3: O因子自适应阈值配置",
      "enabled": true,
      "lookback": 12,
      "percentile": 70,
      "min_threshold_pct": 0.003,
      "max_threshold_pct": 0.03
    },

    "use_notional_oi": {
      "_comment": "P1.2: 使用名义持仓量（合约数×价格）而非合约数",
      "enabled": true,
      "contract_multiplier": 1.0,
      "fallback_on_error": true
    },

    "factor_normalizer": {
      "_comment": "P1.1: 统一因子归一化框架",
      "enabled": true,
      "mode": "hybrid",
      "_mode_options": "zscore | percentile | legacy | hybrid",
      "window_size": 100,
      "tanh_scale": 2.0,
      "min_data_points": 30
    },

    "tm_correlation": {
      "_comment": "P1.3: T-M因子相关性管理",
      "monitor_enabled": true,
      "correlation_threshold_warning": 0.5,
      "correlation_threshold_action": 0.7,
      "action": "log_only",
      "_action_options": "log_only | reduce_m_weight | orthogonalize",
      "m_weight_reduced": 10.0,
      "_note": "当avg_corr≥0.7时，若action=reduce_m_weight，M权重从17%→10%"
    },

    "accumulation_detection": {
      "_comment": "P2.1: 蓄势待发检测增强版本",
      "version": "v2",
      "_version_options": "v1 (原有逻辑) | v2 (增强veto)",
      "v1": {
        "F_threshold": 90,
        "C_threshold": 60,
        "T_max": 40,
        "position_threshold": 35
      },
      "v2": {
        "F_threshold": 85,
        "C_threshold": 60,
        "T_min": -10,
        "T_max": 40,
        "veto": {
          "crowding_basis_bps": 150,
          "crowding_penalty": 0.7,
          "liquidity_threshold": 50,
          "liquidity_penalty": 0.85,
          "momentum_threshold": -50,
          "momentum_penalty": 0.8,
          "oi_threshold": -30,
          "oi_penalty": 0.85,
          "cancel_threshold": 0.6
        },
        "base_position_threshold": 35
      }
    }
  },

  "publish": {
    "prime_prob_min": 0.45,
    "prime_dims_ok_min": 3,
    "prime_dim_threshold": 30,
    "watch_prob_min": 0.52,
    "watch_prob_max": 0.67,
    "_comment": "v7.2.8修复: 与signal_thresholds.json保持一致(0.45)，消除配置冲突"
  },

  "base": {
    "min_quote_volume": 5000000,
    "min_z24_abs": 0.5,
    "min_pool_size": 20
  },

  "overlay": {
    "oi_1h_pct_big": 0.003,
    "oi_1h_pct_small": 0.01,
    "hot_decay_hours": 2,
    "z_volume_1h_threshold": 3,
    "min_hour_quote_usdt": 5000000,
    "z24_and_24h_quote": {
      "z24": 1.0,
      "quote": 5000000
    },
    "triple_sync": {
      "mode": "2of3",
      "dP1h_abs_pct": 0.015,
      "v5_over_v20": 1.2,
      "cvd_mix_abs_per_h": 0.025,
      "anti_chase": {
        "enabled": true,
        "lookback": 72,
        "max_distance_pct": 0.05
      }
    }
  },

  "new_coin": {
    "enabled": true,
    "min_hours": 1,
    "ultra_new_hours": 24,
    "phaseA_days": 7,
    "phaseB_days": 30,
    "max_days": 30,
    "min_volume_24h": 10000000,
    "ultra_new_prime_prob_min": 0.75,
    "ultra_new_dims_ok_min": 6,
    "ultra_new_prime_strength_min": 45,
    "ultra_new_prime_dim_threshold": 70,
    "ultra_new_watch_prob_min": 0.65,
    "phaseA_prime_prob_min": 0.72,
    "phaseA_dims_ok_min": 5,
    "phaseA_prime_strength_min": 40,
    "phaseA_watch_prob_min": 0.60,
    "phaseB_prime_prob_min": 0.70,
    "phaseB_dims_ok_min": 4,
    "phaseB_prime_strength_min": 35,
    "phaseB_watch_prob_min": 0.60,
    "_comment": "v7.2.6修复：添加watch_prob_min和prime_dim_threshold配置，移除硬编码"
  },

  "limits": {
    "per_symbol_delay_ms": 600
  },

  "elite_universe": {
    "_comment": "世界顶级候选池构建参数",
    "min_quote_volume": 5000000,
    "min_trades_24h": 10000,
    "min_anomaly_score": 40,
    "min_quality_score": 60,
    "anti_chase_distance": 0.03
  },

  "universe": [
    "BTCUSDT",
    "ETHUSDT",
    "BNBUSDT",
    "SOLUSDT"
  ],

  "four_step_system": {
    "_comment": "v7.4四步分层决策系统 - 基于专家实施方案",
    "_version": "v7.4.2",
    "_description": "革命性架构：不仅给方向，更给具体价格（入场/止损/止盈）",
    "enabled": true,

    "fusion_mode": {
      "_comment": "融合模式：控制四步系统与旧系统的关系",
      "_description": "true=四步系统替代旧系统（真正融合），false=并行模式（仅对比）",
      "enabled": true,
      "compatibility_mode": {
        "_comment": "兼容性设置：确保向后兼容",
        "preserve_old_fields": true,
        "_description": "true=保留旧系统字段（is_prime等），false=仅用新系统字段"
      }
    },

    "step1_direction": {
      "_comment": "Step1: 方向确认层 - A层因子 + I因子置信度 + BTC对齐 + 硬veto",
      "min_final_strength": 5.0,
      "_fix_note": "v7.4.2回测修复: 20.0→5.0 (原阈值过高导致回测0信号，实际范围约4-15)",

      "weights": {
        "_comment": "A层因子权重（与现有权重保持一致）",
        "T": 0.23,
        "M": 0.10,
        "C": 0.26,
        "V": 0.11,
        "O": 0.20,
        "B": 0.10
      },

      "I_thresholds": {
        "_comment": "I因子Beta映射阈值（I∈[0,100]，高值=独立，低值=跟随BTC）",
        "high_beta": 15,
        "moderate_beta": 30,
        "low_beta": 50,
        "independent": 85
      },

      "btc_alignment": {
        "_comment": "BTC方向对齐参数",
        "strong_trend_threshold": 70.0,
        "same_direction_base": 0.90,
        "same_direction_bonus": 0.10,
        "opposite_direction_base": 0.70,
        "opposite_direction_bonus": 0.25
      },

      "hard_veto": {
        "_comment": "高Beta币 vs 强BTC趋势 - 硬veto防作死规则",
        "enabled": true,
        "high_beta_threshold": 30,
        "strong_btc_threshold": 70.0
      },

      "confidence": {
        "_comment": "置信度范围和曲线参数",
        "floor": 0.50,
        "ceiling": 1.00,

        "_comment_mapping": "I因子置信度映射曲线（v7.4.2配置化，消除硬编码）",
        "mapping": {
          "high_beta_base": 0.60,
          "high_beta_range": 0.10,
          "moderate_beta_base": 0.70,
          "moderate_beta_range": 0.15,
          "low_beta_base": 0.85,
          "low_beta_range": 0.10,
          "independent_base": 0.95,
          "independent_range": 0.05
        },
        "_mapping_note": "I < high_beta: [0.60, 0.70], I < moderate_beta: [0.70, 0.85], I < low_beta: [0.85, 0.95], I >= low_beta: [0.95, 1.00]"
      }
    },

    "step2_timing": {
      "_comment": "Step2: 时机判断层 - Enhanced F v2（修正价格自相关问题）",

      "enhanced_f": {
        "_comment": "Enhanced F v2: flow_momentum - price_momentum（只用非价格因子C/O/V/B）",
        "scale": 20.0,
        "min_threshold": -30.0,
        "_fix_note": "v7.4.2回测修复(P0-8): 30.0→-30.0 (原阈值过高导致回测0信号，实际范围0.5-3.1，现允许中性时机，只拒绝追涨)",

        "flow_weights": {
          "_comment": "Flow因子权重（仅非价格因子，避免自相关）",
          "C": 0.40,
          "O": 0.30,
          "V": 0.20,
          "B": 0.10
        },

        "lookback_hours": 6,
        "_note": "计算6小时前后的flow_score差异",

        "_comment_flow_params": "Flow动量计算参数（v7.4.2配置化，消除硬编码）",
        "flow_weak_threshold": 1.0,
        "base_min_value": 10.0,
        "_flow_params_note": "flow值弱于threshold时认为无动量，base取max(..., base_min_value)避免除0"
      },

      "timing_quality": {
        "_comment": "时机质量评级阈值",
        "excellent": 80,
        "good": 60,
        "fair": 30,
        "mediocre": -30,
        "poor": -60
      },

      "S_factor": {
        "_comment": "S因子（结构）时机增强",
        "theta_threshold": 0.65,
        "timing_boost": 10
      },

      "_L_factor_removed_note": "v7.4.3: L因子时机惩罚已移除。根据设计文档，L因子仅用于Step3止损宽度调整（流动性差→更宽止损），而非Step2时机评分惩罚"
    },

    "step3_risk": {
      "_comment": "Step3: 风险管理层 - Entry/SL/TP价格计算",

      "volatility": {
        "_comment": "波动率计算参数",
        "atr_period": 14,
        "max_loss_fraction": 0.02
      },

      "entry_price": {
        "_comment": "入场价计算（基于Enhanced F和支撑/阻力）",
        "strong_accumulation_f": 15.0,
        "moderate_accumulation_f": 5.0,
        "_fix_note": "v7.4.2回测修复(P0-8): 从70/40调整为15/5 (原阈值过高，实际Enhanced_F范围0.5-3.1，现与实际数据对齐)",
        "buffer_strong": 1.000,
        "buffer_moderate": 1.002,
        "buffer_weak": 1.005,

        "_comment_fallback": "无支撑/阻力时的fallback buffer（v7.4.2配置化，v7.4.2调整为更保守）",
        "fallback_moderate_buffer": 0.999,
        "fallback_weak_buffer": 0.997,
        "_fallback_note": "无支撑时做多用current_price * fallback_buffer，无阻力时做空用current_price / fallback_buffer",
        "_fallback_p0_5_fix": "v7.4.2 P0-5修复：从0.998/0.995调整为0.999/0.997（更保守，减少滑点风险）"
      },

      "stop_loss": {
        "_comment": "止损策略（支持两种模式）",
        "mode": "structure_above_or_below",
        "_mode_options": "tight | structure_above_or_below",

        "base_atr_multiplier": 2.0,

        "liquidity_adjustment": {
          "_comment": "根据L因子调整止损距离",
          "low_liquidity_threshold": -30,
          "high_liquidity_threshold": 30,
          "low_liquidity_multiplier": 1.5,
          "high_liquidity_multiplier": 0.8
        },

        "tight_mode": {
          "_comment": "紧止损模式（当前逻辑）",
          "structure_buffer": 0.998,
          "use_max_of_structure_and_volatility": true
        },

        "structure_above_or_below_mode": {
          "_comment": "结构上下模式（止损更远，降低被扫概率）",
          "structure_buffer_long": 0.994,
          "structure_buffer_short": 1.006,
          "use_min_of_structure_and_volatility": true
        }
      },

      "take_profit": {
        "_comment": "止盈计算",
        "min_risk_reward_ratio": 1.5,
        "structure_buffer": 0.998,
        "use_max_of_min_and_structure": true
      },

      "orderbook": {
        "_comment": "订单簿分析参数（从L因子元数据提取）- v7.4.2完整版",
        "enabled": true,

        "_comment_wall_detection": "买墙/卖墙检测阈值",
        "obi_buy_wall_threshold": 0.3,
        "obi_sell_wall_threshold": -0.3,
        "wall_adjustment_enabled": false,

        "_comment_depth_score": "深度得分计算权重（OBI + 覆盖 + 冲击）",
        "depth_score_weights": {
          "obi_base_weight": 0.50,
          "coverage_weight": 0.25,
          "impact_cost_weight": 0.25
        },

        "_comment_obi_score": "OBI基础分计算参数",
        "obi_score": {
          "base_score": 50.0,
          "multiplier": 50.0
        },

        "_comment_coverage": "深度覆盖度分值",
        "coverage_scores": {
          "covered": 100.0,
          "not_covered": 0.0
        },

        "_comment_impact_cost": "价格冲击成本评分参数",
        "impact_cost": {
          "excellent_threshold_bps": 10,
          "acceptable_threshold_bps": 50,
          "score_multiplier": 2.0
        },

        "_note": "v7.4.2: 从硬编码升级为配置化，便于后续调优"
      }
    },

    "step4_quality": {
      "_comment": "Step4: 质量控制层 - 四道闸门验证",

      "gate1_volume": {
        "_comment": "Gate1: 基础成交量筛选 - v7.4.3已禁用（选币阶段已过滤成交量）",
        "enabled": false,
        "_disable_reason": "选币阶段已通过min_volume_24h_usdt过滤低流动性币种，此处重复检查无意义",
        "min_volume_24h": 1000000,
        "_legacy_note": "原阈值以币数计量（非USDT），保留仅供参考"
      },

      "gate2_noise": {
        "_comment": "Gate2: 噪声过滤（ATR/Price） - v7.4.2: 添加资产类别动态阈值",
        "max_noise_ratio": 0.15,

        "_comment_dynamic": "基于资产类别的动态阈值（P0-6修复：稳定币/主流币/山寨币分级）",
        "enable_dynamic": true,
        "dynamic_thresholds": {
          "stablecoins": {
            "_comment": "稳定币（USDT, BUSD, USDC等）- 低波动性",
            "max_noise_ratio": 0.05,
            "symbols": ["USDTUSDT", "BUSDUSDT", "USDCUSDT", "TUSDUSDT", "DAIUSDT"]
          },
          "blue_chip": {
            "_comment": "蓝筹币（BTC, ETH, BNB等主流币）- 中等波动性",
            "max_noise_ratio": 0.10,
            "symbols": ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "ADAUSDT", "XRPUSDT", "DOTUSDT", "AVAXUSDT", "MATICUSDT", "LINKUSDT"]
          },
          "altcoins": {
            "_comment": "山寨币（其他所有币种）- 高波动性",
            "max_noise_ratio": 0.20
          }
        },

        "_p0_6_rationale": "稳定币波动小用0.05过滤异常，主流币用0.10，山寨币用0.20避免过度拒绝高质量信号"
      },

      "gate3_strength": {
        "_comment": "Gate3: 信号强度门槛",
        "min_prime_strength": 5.0,
        "_fix_note": "v7.4.2回测修复(P0-8续): 35→5.0 (原阈值过高导致Step4拒绝，实际prime_strength约5-15，现与Step1阈值对齐)"
      },

      "gate4_contradiction": {
        "_comment": "Gate4: 因子矛盾检测",

        "c_vs_o": {
          "_comment": "C vs O矛盾检测（资金流vs持仓）",
          "enabled": true,
          "abs_threshold": 60
        },

        "t_vs_enhanced_f": {
          "_comment": "T vs Enhanced_F矛盾检测（趋势vs时机）",
          "enabled": true,
          "t_strong_threshold": 70,
          "enhanced_f_chase_threshold": -40
        }
      },

      "final_decision": {
        "_comment": "最终决策参数",
        "min_ev": 0.8,
        "min_risk_reward": 1.0,
        "min_final_score": 50.0
      },

      "crowding_detection": {
        "_comment": "过热检测（防止追高）",
        "oi_crowding_percentile": 95,
        "basis_extreme_percentile": 95,
        "funding_extreme_percentile": 95
      }
    },

    "integration": {
      "_comment": "系统集成参数",
      "dual_run_mode": false,
      "_dual_run_note": "true=新旧系统并行运行对比，false=仅用新系统",
      "fallback_on_error": true,
      "detailed_logging": true
    },

    "symbol_refresh": {
      "_comment": "币种列表动态刷新配置 - v7.4.2方案B（无需重启发现新币）",
      "_version": "v7.4.2",
      "_feature": "动态币种发现机制",

      "enabled": true,
      "_enabled_note": "启用币种列表动态刷新（推荐），关闭则需要重启才能发现新币",

      "refresh_interval_hours": 6,
      "_interval_rationale": "每6小时刷新一次（每天4次），平衡及时性和资源消耗",
      "_interval_options": "可选值: 3h(更激进), 6h(推荐), 12h(保守)",

      "refresh_times_utc": [0, 6, 12, 18],
      "_times_note": "固定时间点刷新（UTC时间），便于监控和调试",

      "new_coin_detection": {
        "_comment": "新币发现和初始化配置",

        "min_kline_requirements": {
          "_comment": "新币K线数据最少要求（避免数据不足产生噪声信号）",
          "15m_min_bars": 20,
          "1h_min_bars": 24,
          "4h_min_bars": 7,
          "1d_min_bars": 3,
          "_rationale": "15m需5h, 1h需1天, 4h需28h, 1d需3天数据"
        },

        "notification": {
          "_comment": "新币发现通知配置",
          "enabled": true,
          "telegram_notify": true,
          "min_volume_threshold_m": 50,
          "_threshold_note": "只通知流动性>50M USDT的大盘新币",
          "log_all_new_coins": true
        }
      },

      "delisting_handling": {
        "_comment": "退市币种处理配置",
        "grace_period_hours": 2,
        "_grace_period_note": "退市宽限期2小时（对齐冷却期），等待信号发送完成",
        "cleanup_on_next_refresh": true
      },

      "failure_handling": {
        "_comment": "刷新失败容错配置",
        "max_retries": 3,
        "retry_interval_minutes": 5,
        "keep_old_list_on_failure": true,
        "_failure_note": "刷新失败时保持旧列表，避免用错误数据",
        "alert_on_consecutive_failures": 3,
        "_alert_note": "连续3次失败发送Telegram告警"
      },

      "persistence": {
        "_comment": "币种列表变化历史记录",
        "enabled": true,
        "log_file": "data/symbol_list_history.jsonl",
        "archive_monthly": true,
        "_record_fields": ["timestamp", "total_symbols", "new_symbols", "removed_symbols", "volume_changes"]
      },

      "_design_principles": [
        "渐进式初始化：新币数据不足时暂不分析",
        "双缓冲机制：刷新时不影响当前扫描",
        "温和移除：退市币种等待冷却期结束",
        "保守容错：宁可不刷新，也不用错误数据",
        "完整追溯：记录所有币种变化历史"
      ]
    }
  },

  "backtest": {
    "_comment": "Backtest Framework v1.0 - 零硬编码历史数据回测系统",
    "_version": "v1.0",
    "_description": "配置驱动的回测框架，所有参数可调，支持多符号、多时间段回测",
    "_standard": "SYSTEM_ENHANCEMENT_STANDARD.md v3.3.0",
    "_design_doc": "docs/BACKTEST_FRAMEWORK_v1.0_DESIGN.md",

    "data_loader": {
      "_comment": "历史数据加载器配置",
      "default_interval": "1h",
      "api_retry_count": 3,
      "api_retry_delay_base": 2.0,
      "api_retry_delay_range": 2.0,
      "api_timeout_seconds": 30,
      "cache_enabled": true,
      "cache_dir": "data/backtest_cache",
      "cache_max_size_mb": 500,
      "cache_ttl_hours": 168
    },

    "engine": {
      "_comment": "回测引擎配置（v1.5 P0修复：限价单模型 + 手续费 + 悲观假设）",
      "batch_size": 1,
      "progress_log_interval": 100,
      "signal_cooldown_hours": 2,

      "_comment_execution": "=== 交易执行参数（v1.5 P0修复） ===",
      "max_entry_bars": 4,
      "_max_entry_bars_note": "限价单有效期（1h bar数），超时未成交则信号失效（专家方案：防止未来信息泄露）",

      "taker_fee_rate": 0.0005,
      "_taker_fee_rate_note": "Taker手续费率（0.05%），双边收费（入场+出场）",

      "slippage_percent": 0.02,
      "_slippage_percent_note": "滑点基数（0.02% = 2bps），做多买贵/做空卖便宜（v1.5调整：从0.1%降至0.02%更真实）",
      "slippage_range": 0.01,
      "_slippage_range_note": "滑点随机范围（±0.01%），模拟真实市场波动",

      "_comment_position": "=== 仓位管理参数 ===",
      "position_size_usdt": 100,
      "_position_size_note": "固定仓位大小（v1.0简化版，v1.6将改为基于风险%的动态仓位）",

      "max_holding_hours": 168,
      "_max_holding_note": "最大持仓时长（168h = 7天），超时强制平仓",

      "enable_anti_jitter": true,
      "_anti_jitter_note": "启用Anti-Jitter冷却期（2小时），与实盘一致",

      "exit_classification": {
        "_comment": "退出原因分类（§6.4分段逻辑配置）",
        "sl_hit": {"priority": 1, "label": "SL_HIT"},
        "tp1_hit": {"priority": 2, "label": "TP1_HIT"},
        "tp2_hit": {"priority": 3, "label": "TP2_HIT"},
        "max_holding_exceeded": {"priority": 4, "label": "TIMEOUT"},
        "manual_close": {"priority": 5, "label": "MANUAL"},
        "entry_not_filled": {"priority": 6, "label": "ENTRY_NOT_FILLED"}
      },

      "_comment_v1_1": "=== v1.1增强：REJECT信号记录（计算真实Step通过率） ===",
      "record_reject_analyses": true,
      "_record_reject_note": "启用后记录所有分析结果（包括REJECT），用于计算真实Step1-4通过率",

      "reject_analysis_fields": {
        "_comment": "REJECT分析记录字段配置",
        "record_factor_scores": true,
        "record_step_results": true,
        "record_rejection_reason": true
      }
    },

    "metrics": {
      "_comment": "性能评估配置",
      "min_signals_for_stats": 10,
      "confidence_level": 0.95,
      "risk_free_rate": 0.03,
      "pnl_histogram_bins": [-10, -5, -2, 0, 2, 5, 10, 20],
      "holding_time_bins_hours": [1, 6, 12, 24, 48, 72, 168]
    },

    "output": {
      "_comment": "输出格式配置",
      "default_format": "json",
      "json_indent": 2,
      "markdown_include_charts": false,
      "csv_delimiter": ","
    }
  },

  "paper_trading": {
    "_comment": "Real-Time Paper Trading配置 - v1.0",
    "_version": "v1.0.0",
    "_design_doc": "参考QuantConnect架构，适配CryptoSignal四步系统",

    "enabled": true,
    "symbols": ["BNBUSDT"],
    "interval": "1h",
    "initial_equity": 100000,

    "data_feed": {
      "_comment": "数据流配置",
      "source": "binance_mainnet",
      "use_1m_bar_simulation": true,
      "_use_1m_note": "使用1m bar模拟tick执行（简化版，后续可升级到真正tick）",
      "reconnect_delay": 5,
      "reconnect_max_retries": 10,
      "buffer_size": 1000,
      "kline_lookback_bars": 300
    },

    "execution": {
      "_comment": "执行模拟配置",
      "taker_fee_rate": 0.0005,
      "_fee_note": "Taker手续费率0.05%，双边收费",

      "slippage_bps": 2,
      "_slippage_note": "滑点基点(2bps = 0.02%)，多头买贵/空头卖便宜",

      "max_entry_minutes": 240,
      "_max_entry_note": "限价单有效期（240分钟 = 4小时），超时未成交则信号失效",

      "max_holding_minutes": 2880,
      "_max_holding_note": "最大持仓时长（2880分钟 = 48小时），超时强制平仓"
    },

    "risk": {
      "_comment": "风险管理配置",
      "per_trade_risk_pct": 0.01,
      "_risk_note": "单笔交易最大风险1%权益",

      "max_concurrent_positions": 3,
      "_max_pos_note": "最大并发持仓数",

      "max_daily_trades": 10,
      "_daily_note": "每日最大交易次数",

      "max_drawdown_percent": 5.0,
      "_dd_note": "最大回撤5%触发交易暂停"
    },

    "reporting": {
      "_comment": "报告与状态配置",
      "log_interval_minutes": 60,
      "_log_note": "每60分钟输出一次性能摘要",

      "save_state_interval": 300,
      "_save_note": "每5分钟保存一次状态（用于重启恢复）",

      "state_file": "data/paper_state.json",
      "trades_file": "data/paper_trades.json",
      "equity_curve_file": "data/paper_equity.json"
    }
  }
}