# 9+2因子系统规范

**规范版本**: v6.4 Phase 2
**生效日期**: 2025-11-02
**状态**: 生效中

> ⚠️ **重要**: 本文档为因子系统核心规范。
> - **A层**: 9个方向因子（T/M/C/S/V/O/L/B/Q），权重总和100%
> - **B层**: 2个调制器（F/I），权重0%，仅调节温度/成本/阈值
>
> 完整的技术细节参见源文档：`../newstandards/STANDARDS.md § 2`

---

## 快速导航

- [A层：方向因子（9维）](#a层方向因子)
- [B层：调制器（2维）](#b层调制器)
- [统一标准化链](#统一标准化链)
- [权重配置](#权重配置)

详细规范请查阅：`newstandards/STANDARDS.md`（待合并）

---

## A层：方向因子

### 因子列表

| 因子 | 名称 | 权重 | 数据源 | 输出范围 |
|------|------|------|--------|---------|
| **T** | 趋势 | 18.0% | 1h K线 | ±100 |
| **M** | 动量 | 12.0% | 1h K线 | ±100 |
| **C** | CVD | 18.0% | 1h K线 + 成交 | ±100 |
| **S** | 结构/速度 | 10.0% | 1h K线 | ±100 |
| **V** | 量能 | 10.0% | 1h K线 | ±100 |
| **O** | OI | 12.0% | OI数据 | ±100 |
| **L** | 流动性 | 12.0% | 订单簿 | ±100 |
| **B** | 基差/资金 | 4.0% | 现货+期货 | ±100 |
| **Q** | 清算密度 | 4.0% | aggTrades | ±100 |

**总计**: 100.0% ✅

**架构分层** (v6.1权重):
- **Layer 1** (价格行为 50%): T(18%) + M(12%) + S(10%) + V(10%)
- **Layer 2** (资金流 30%): C(18%) + O(12%)
- **Layer 3** (微观结构 20%): L(12%) + B(4%) + Q(4%)

---

## B层：调制器

| 因子 | 名称 | 权重 | 作用 |
|------|------|------|------|
| **F** | 资金领先 | 0.0% | 调节温度/成本/阈值 |
| **I** | 独立性 | 0.0% | 调节温度/成本/阈值 |

详见：[MODULATORS.md](MODULATORS.md)

---

## 统一标准化链

所有因子统一使用以下标准化流程：

1. **预平滑**: `x̃_t = α·x_t + (1-α)·x̃_{t-1}`
2. **稳健缩放**: `z = (x̃ - μ) / (1.4826·MAD)`
3. **软winsor**: `z_soft = sign(z)[z0 + (zmax-z0)(1-exp(-(|z|-z0)/λ))]`
4. **压缩到±100**: `s_k = 100 · tanh(z_soft/τ_k)`

---

## 权重配置

**配置文件**: `config/params.json`

**实际生效权重** (v6.1 - I因子架构修复版):
```json
{
  "weights": {
    "T": 18.0,
    "M": 12.0,
    "C": 18.0,
    "S": 10.0,
    "V": 10.0,
    "O": 12.0,
    "L": 12.0,
    "B": 4.0,
    "Q": 4.0,
    "_b_layer": "以下为B层调制器，不参与评分",
    "F": 0.0,
    "I": 0.0,
    "E": 0.0
  }
}
```

**要求**: A层9因子总和必须=100.0%，B层调制器(F/I)权重=0%

---

## 实现模块

- `ats_core/factors_v2/*.py` - 各因子计算
- `ats_core/scoring/scorecard.py` - 加权聚合

---

**维护**: 量化研究团队
**审核**: 系统架构师
