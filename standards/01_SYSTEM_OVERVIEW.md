# CryptoSignal 系统概览

**版本**: v7.3.2
**更新日期**: 2025-11-15

---

## 🎯 系统定位

CryptoSignal 是一个**加密货币合约交易信号生成系统**，专注于：
- ✅ **信号生成**：基于多维度因子分析生成Prime/Watch信号
- ✅ **风险控制**：通过四门系统和防抖动机制确保信号质量
- ❌ **不执行交易**：仅提供信号，不直接操作交易账户

---

## 📊 系统架构概览

```
┌─────────────────────────────────────────────────────────┐
│                      数据层                              │
│  Binance USDT-M (REST + WebSocket)                      │
│  • K线数据 (1m/5m/15m/1h/4h)                            │
│  • OI/Funding/深度/成交                                  │
│  • 新币专用数据流 (Phase 2)                              │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                    因子计算层                            │
│  10+1维因子系统 (A层 + B层)                              │
│  • A层 (9因子): T/M/C/S/V/O/L/B/Q                       │
│  • B层 (调制器): F(资金领先) / I(独立性)                 │
│  • 统一±100标准化                                        │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                   评分与概率层                           │
│  • 加权评分 (weighted_score)                            │
│  • Sigmoid概率映射 (probability)                        │
│  • Prime强度计算 (prime_strength)                       │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                    四门系统                              │
│  • DataQual门 (数据质量 ≥ 0.90)                         │
│  • EV门 (期望价值 > 0)                                   │
│  • Execution门 (流动性/滑点检查)                         │
│  • Probability门 (概率阈值)                             │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                  发布防抖动层                            │
│  • 入场阈值: 0.65                                        │
│  • 确认K线: 1/2                                         │
│  • 冷却时间: 60秒                                        │
│  • 防止频繁抖动                                          │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                  信号输出层                              │
│  • Prime信号 (高质量，推荐执行)                          │
│  • Watch信号 (观察级别)                                  │
│  • Telegram通知                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔢 6+4因子系统 (v7.3.2架构)

> **架构说明**: 根据代码实际实现（ats_core/cfg.py），系统采用6+4因子架构

### A层：核心因子 (6维，总权重100%)

| 因子 | 名称 | 权重 | 说明 |
|------|------|------|------|
| **T** | 趋势 | 24.0% | 基于ZLEMA的价格趋势 |
| **M** | 动量 | 17.0% | ROC/RSI/MACD综合动量 |
| **C** | CVD | 24.0% | 累计成交量差 |
| **V** | 量能 | 12.0% | 相对成交量和买卖差 |
| **O** | OI | 17.0% | 持仓量变化 |
| **B** | 基差/资金 | 6.0% | 现货-期货基差和资金费率 |

**权重总和**: 100% (A层核心因子)

**输出范围**: 每个因子 ∈ [-100, +100]
- 正值 = 看多信号
- 负值 = 看空信号
- 绝对值 = 信号强度

### B层：调制器 (4维，权重0%)

| 因子 | 名称 | 作用 | 权重 |
|------|------|------|------|
| **L** | 流动性 | 执行层质量门槛 | 0.0% |
| **S** | 结构/速度 | 调节评分 | 0.0% |
| **F** | 资金领先 | 调节温度/成本/概率阈值 | 0.0% |
| **I** | 独立性 | 调节温度/成本/概率阈值 | 0.0% |

**作用机制**: 不参与A层评分，仅作为调制器调节最终评分和阈值

### 废弃因子

| 因子 | 原权重 | 废弃原因 | 版本 |
|------|--------|---------|------|
| **Q** | 4.0% | 清算密度数据不稳定 | v6.6废弃 |
| **E** | - | 环境因子实验性 | v6.0废弃 |

**参考**: `ats_core/cfg.py` Line 43-45 (代码实现)

---

## 🚪 四门系统

信号必须通过四道门才能发布：

### 1. DataQual门 (数据质量)
- **阈值**: ≥ 0.90 (Prime) / ≥ 0.88 (Watch)
- **检查**: K线完整性、时间同步、异常检测
- **不通过**: 降级为Watch或拒绝

### 2. EV门 (期望价值)
- **阈值**: EV > 0
- **计算**: `EV = (P_chosen - 0.5) * 2`
- **不通过**: 拒绝信号

### 3. Execution门 (执行可行性)
- **流动性检查**: Impact ≤ 7 bps, Spread ≤ 25 bps (标准币)
- **订单簿失衡**: |OBI| ≤ 0.30 (标准币)
- **订单簿容纳度**: room_atr_ratio ≥ 0.6
- **不通过**: 拒绝信号

**注**: L（流动性）因子作为B层调制器参与质量评估，权重0%

### 4. Probability门 (概率阈值)
- **Prime**: P ≥ 0.58，≥3维度达标
- **Watch**: P ≥ 0.50
- **不通过**: 降级或拒绝

---

## 🎚️ 发布防抖动系统

防止信号频繁抖动的机制：

```
入场阈值: 0.65
  ↓
确认: 连续1/2根K线保持
  ↓
冷却: 60秒内不重复发送相同币种
  ↓
发布 Prime/Watch信号
```

**关键参数** (v6.1):
- `entry_threshold`: 0.65 (从0.80降低，响应更快)
- `confirm_bars`: 1/2 (从2/3降低，速度提升33%)
- `cooldown`: 60秒

---

## 🆕 新币通道 (Phase 2, v6.4)

### 核心改进
新币通道与成熟币通道彻底分离，使用专用数据流和模型：

**数据粒度**:
- 成熟币: 1h/4h K线
- 新币: 1m/5m/15m/1h K线 (Phase 2已实现)

**判定标准**:
- 进入: `bars_1h < 400` 或 `since_listing < 14d`
- 回切: `bars_1h ≥ 400` 且稳定运行

**Phase 2实现** (v6.4):
- ✅ 数据获取前预判
- ✅ 分钟级数据流 (1m/5m/15m)
- ✅ AVWAP锚点计算
- ✅ WebSocket实时订阅 (kline_1m/5m/15m)

**Phase 3待实现**:
- ⏸️ 新币专用因子 (T_new/M_new/S_new，基于ZLEMA_1m/5m)
- ⏸️ 点火-成势-衰竭模型

详见: [specifications/NEWCOIN.md](specifications/NEWCOIN.md)

---

## 📈 版本演进

| 版本 | 日期 | 关键特性 |
|------|------|---------|
| v6.0 | 2025-10-30 | 10+1维因子系统，F/I调制器 |
| v6.1 | 2025-11-01 | I因子架构修正，阈值优化 |
| v6.2 | 2025-11-02 | I因子双重归一化修复，4个Critical Bug |
| v6.3 | 2025-11-02 | 解决0信号困境，软化F/I，降低阈值 |
| v6.3.1 | 2025-11-02 | 新币判断规范符合性（bars_1h<400） |
| v6.3.2 | 2025-11-02 | 新币全流程逻辑冲突修复 |
| **v6.4** | **2025-11-02** | **Phase 2: 新币数据流架构改造** |

详见: [03_VERSION_HISTORY.md](03_VERSION_HISTORY.md)

---

## 🔧 核心模块

### 主要脚本
- **`scripts/realtime_signal_scanner.py`** - 实时信号扫描器（主入口）
- **`deploy_and_run.sh`** - 全自动部署脚本
- **`test_phase2.py`** - Phase 2功能测试

### 核心模块
- **`ats_core/pipeline/`** - 分析流水线
  - `analyze_symbol.py` - 单币种分析（数据获取+因子计算）
  - `batch_scan_optimized.py` - 批量扫描（WebSocket优化）
- **`ats_core/factors_v2/`** - 因子计算模块
- **`ats_core/gates/`** - 四门系统
- **`ats_core/publishing/`** - 发布和防抖动
- **`ats_core/data_feeds/`** - 数据获取（Phase 2新增）
  - `newcoin_data.py` - 新币数据获取
  - `ws_newcoin.py` - 新币WebSocket订阅

### 配置文件
- **`config/params.json`** - 权重、阈值、发布参数
- **`config/telegram.json`** - Telegram通知配置
- **`config/binance_credentials.json`** - Binance API凭证

---

## 🚀 快速开始

### 1. 部署
```bash
cd ~/cryptosignal
./deploy_and_run.sh
```

### 2. 手动启动
```bash
# 单次扫描
python3 scripts/realtime_signal_scanner.py

# 定期扫描（每5分钟）
python3 scripts/realtime_signal_scanner.py --interval 300

# 使用Screen后台运行
screen -S cryptosignal
python3 scripts/realtime_signal_scanner.py --interval 300
# 按 Ctrl+A 然后 D 分离会话
```

### 3. 查看日志
```bash
# 重连Screen会话
screen -r cryptosignal

# 或查看nohup日志
tail -f logs/scanner_*.log
```

---

## 📊 性能指标

### 扫描性能 (v6.4)
- **初始化时间**: 3-4分钟（首次WebSocket连接）
- **扫描速度**: 12-15秒/200币种
- **API调用**: 0次/扫描（WebSocket实时数据）

### 信号质量 (预期)
- **Prime信号**: 3-7个/小时
- **多空比例**: 接近1:1（对称选币）
- **响应速度**: 提升33%（防抖动优化）

---

## 🔗 相关文档

- **技术架构**: [02_ARCHITECTURE.md](02_ARCHITECTURE.md)
- **因子规范**: [specifications/FACTOR_SYSTEM.md](specifications/FACTOR_SYSTEM.md)
- **部署指南**: [deployment/DEPLOYMENT_GUIDE.md](deployment/DEPLOYMENT_GUIDE.md)
- **配置规范**: [configuration/PARAMS_SPEC.md](configuration/PARAMS_SPEC.md)

---

**维护**: 系统架构师
**审核**: 技术负责人
**版本**: v6.4-phase2
