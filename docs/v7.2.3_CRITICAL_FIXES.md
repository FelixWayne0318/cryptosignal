# v7.2.3 ç´§æ€¥ä¿®å¤ - Få› å­å¤©æ–‡æ•°å­— + ç½®ä¿¡åº¦é˜ˆå€¼ç¡¬ç¼–ç 

**ä¿®å¤æ—¥æœŸ**: 2025-11-10
**ä¼˜å…ˆçº§**: P0 (Critical)
**æ€»è€—æ—¶**: ~2å°æ—¶

---

## ä¿®å¤å†…å®¹æ¦‚è§ˆ

| # | é—®é¢˜ | é£é™©ç­‰çº§ | çŠ¶æ€ |
|---|------|---------|------|
| 1 | Få› å­é¥±å’Œ97.8%ï¼ˆå¤©æ–‡æ•°å­—é—®é¢˜ï¼‰ | ğŸ”´ Critical | âœ… å·²ä¿®å¤ |
| 2 | ç½®ä¿¡åº¦é˜ˆå€¼ç¡¬ç¼–ç 45ï¼ˆ0ä¸ªä¿¡å·é€šè¿‡ï¼‰ | ğŸ”´ Critical | âœ… å·²ä¿®å¤ |
| 3 | Iå› å­beta=N/A (98.7%å¤±è´¥) | ğŸŸ¡ Medium | âœ… å·²è¯Šæ–­ |

---

## ä¿®å¤è¯¦æƒ…

### 1. Få› å­å¤©æ–‡æ•°å­—é—®é¢˜ (97.8%é¥±å’Œ)

#### é—®é¢˜æè¿°

```
F_rawèŒƒå›´: -156,194,794,388,458 åˆ° +128,801,502,062,554
ç”¨æˆ·å®é™…æ‰«ææ•°æ®: F_raw=-860652, fund_momentum=-860651, price_momentum=0.8
ç»“æœ: 97.8%çš„å¸ç§Få› å­é¥±å’Œåœ¨Â±100
```

#### æ ¹æœ¬åŸå› 

**CVDä½¿ç”¨ç»å¯¹å€¼è€Œéç›¸å¯¹å˜åŒ–ç‡ï¼š**

```python
# æ—§é€»è¾‘ï¼ˆbugï¼‰
cvd_change_6h = cvd_now - cvd_6h_ago  # ç´¯ç§¯æˆäº¤é‡å·®å€¼ï¼ˆå‡ ç™¾ä¸‡åˆ°å‡ åƒä¸‡å¸ï¼‰
cvd_change_norm = cvd_change_6h / price  # é™¤ä»¥ä»·æ ¼ï¼ˆå‡ ç¾å…ƒï¼‰
# ç»“æœï¼šcvd_change_norm = ç™¾ä¸‡çº§åˆ«çš„æ•°å­—ï¼

fund_momentum = cvd_change_norm / atr_norm_factor  # å†é™¤ä»¥ATRï¼ˆ0.01-0.05ï¼‰
# ç»“æœï¼šfund_momentum = å¤©æ–‡æ•°å­—ï¼ˆå‡ åƒä¸‡åˆ°å‡ äº¿ï¼‰
```

**ç”¨æˆ·å»ºè®®å®Œå…¨æ­£ç¡®ï¼šåº”è¯¥ä½¿ç”¨ç›¸å¯¹æ•°æ®ï¼ˆå˜åŒ–ç‡ï¼‰è€Œéç»å¯¹æ•°æ®ã€‚**

#### ä¿®å¤æ–¹æ¡ˆ

**ä½¿ç”¨ç›¸å¯¹å˜åŒ–ç‡ï¼š**

```python
# æ–°é€»è¾‘ï¼ˆv7.2.3ï¼‰
cvd_change_pct = (cvd_now - cvd_6h_ago) / max(abs(cvd_6h_ago), 1e-9)  # CVDå˜åŒ–ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
oi_change_pct = (oi_now - oi_6h_ago) / max(abs(oi_6h_ago), 1e-9)  # OIå˜åŒ–ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰

# èµ„é‡‘åŠ¨é‡ = åŠ æƒå˜åŒ–ç‡ï¼ˆæ— éœ€é™¤ä»¥ATRï¼‰
fund_momentum = cvd_weight * cvd_change_pct + oi_weight * oi_change_pct

# ä»·æ ¼åŠ¨é‡ = ä»·æ ¼å˜åŒ–ç‡ï¼ˆæ— éœ€é™¤ä»¥ATRï¼‰
price_momentum = price_change_pct

# F_raw = èµ„é‡‘å˜åŒ–ç‡ - ä»·æ ¼å˜åŒ–ç‡
F_raw = fund_momentum - price_momentum

# ä½¿ç”¨åˆç†çš„scaleï¼ˆå› ä¸ºç°åœ¨æ˜¯ç™¾åˆ†æ¯”ï¼‰
F_normalized = tanh(F_raw / 0.10)  # scaleä»5.0é™åˆ°0.10
```

#### ä¿®æ”¹çš„æ–‡ä»¶

- `config/factors_unified.json`: scale 5.0â†’0.10, æ·»åŠ  use_relative_change=true
- `ats_core/features/fund_leading.py`: æ”¹ç”¨ç›¸å¯¹å˜åŒ–ç‡è®¡ç®—

#### é¢„æœŸæ•ˆæœ

- F_rawèŒƒå›´ï¼š-1.0 åˆ° +1.0ï¼ˆç™¾åˆ†æ¯”å·®å€¼ï¼‰
- Få› å­é¥±å’Œç‡ï¼š97.8% â†’ <10%
- æ›´ç¬¦åˆç»æµå­¦ç›´è§‰ï¼ˆèµ„é‡‘æµå…¥é€Ÿåº¦ vs ä»·æ ¼ä¸Šæ¶¨é€Ÿåº¦ï¼‰

---

### 2. ç½®ä¿¡åº¦é˜ˆå€¼ç¡¬ç¼–ç é—®é¢˜ (0ä¸ªä¿¡å·)

#### é—®é¢˜æè¿°

```python
# analyze_symbol.py:974 ç¡¬ç¼–ç 
quality_check_2 = confidence >= 45

# å®é™…æ‰«ææ•°æ®åˆ†å¸ƒ
ç½®ä¿¡åº¦: Min=0.00, P25=4.00, ä¸­ä½=8.00, P75=15.00, Max=31.00

# ç»“æœ
177ä¸ªå€™é€‰ä¿¡å· â†’ 0ä¸ªé€šè¿‡é«˜è´¨é‡è¿‡æ»¤ï¼ˆMax=31 < é˜ˆå€¼45ï¼‰
```

**é—®é¢˜ï¼š**
- é…ç½®æ–‡ä»¶å·²è®¾ç½® `confidence_min: 20`
- ä½†ä»£ç ç¡¬ç¼–ç äº† `45`
- è¿åç³»ç»Ÿè§„èŒƒ Â§ 5ï¼ˆç¦æ­¢ç¡¬ç¼–ç Magic Numberï¼‰

#### ä¿®å¤æ–¹æ¡ˆ

**ä»é…ç½®æ–‡ä»¶è¯»å–é˜ˆå€¼ï¼š**

```python
# v7.2.3ä¿®å¤
from ats_core.config.threshold_config import get_thresholds

config = get_thresholds()
confidence_threshold = config.get_mature_threshold('confidence_min', 20)
quality_check_2 = confidence >= confidence_threshold
```

#### ä¿®æ”¹çš„æ–‡ä»¶

- `ats_core/pipeline/analyze_symbol.py`:
  - å¯¼å…¥é…ç½®ç®¡ç†å™¨
  - ç§»é™¤ç¡¬ç¼–ç 45
  - ä»é…ç½®è¯»å–confidence_min (é»˜è®¤20)

#### é¢„æœŸæ•ˆæœ

- é˜ˆå€¼ï¼š45 â†’ 20ï¼ˆåŸºäºå®é™…åˆ†å¸ƒï¼‰
- 177ä¸ªå€™é€‰ä¿¡å· â†’ é¢„è®¡20-50ä¸ªé«˜è´¨é‡ä¿¡å·
- ç¬¦åˆç³»ç»Ÿè§„èŒƒï¼ˆé…ç½®åŒ–ç®¡ç†ï¼‰

---

### 3. Iå› å­beta=N/Aè¯Šæ–­ (98.7%å¤±è´¥)

#### é—®é¢˜æè¿°

```
Iå› å­è¯¦æƒ…: I=50, beta_btc=N/A, beta_eth=N/A, level=N/A
98.7%çš„å¸ç§æ˜¾ç¤ºbeta=N/A
```

#### æ ¹æœ¬åŸå› 

**æ•°æ®è·å–é—®é¢˜ï¼ˆéä»£ç bugï¼‰ï¼š**

è¯Šæ–­æµ‹è¯•ç»“æœï¼š
```python
åœºæ™¯1ï¼ˆæ­£å¸¸æ•°æ®49æ ¹ï¼‰: I=0, beta_btc=0.478, beta_eth=0.469  âœ… æ­£å¸¸
åœºæ™¯2ï¼ˆæ•°æ®ä¸è¶³24æ ¹ï¼‰: I=50, beta_btc=N/A, error='Insufficient data'
åœºæ™¯3ï¼ˆç©ºæ•°æ®ï¼‰:        I=50, beta_btc=N/A, error='Insufficient data'
```

**98.7%å¤±è´¥çš„å¯èƒ½åŸå› ï¼š**
1. BTC/ETH Kçº¿è·å–å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜/APIé™åˆ¶ï¼‰
2. åˆå§‹åŒ–æ—¶å‡ºç°è­¦å‘Šï¼š`âš ï¸ BTC Kçº¿è·å–å¤±è´¥: xxx`

#### å»ºè®®

**ç”¨æˆ·éœ€è¦æ£€æŸ¥ï¼š**
1. æ‰«ææ—¥å¿—ä¸­æ˜¯å¦æœ‰BTC/ETH Kçº¿è·å–å¤±è´¥çš„è­¦å‘Š
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. Binance APIæ˜¯å¦å¯è®¿é—®

**Iå› å­è®¡ç®—é€»è¾‘æ˜¯æ­£ç¡®çš„**ï¼ˆæµ‹è¯•åœºæ™¯1è¯æ˜ï¼‰ï¼Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚

---

## æ–‡ä»¶å˜æ›´æ¸…å•

### é…ç½®æ–‡ä»¶
```
config/factors_unified.json
  - F.v2.scale: 5.0 â†’ 0.10
  - F.v2.use_relative_change: æ–°å¢ true
  - F.v2._comment: æ›´æ–°è¯´æ˜
```

### æ ¸å¿ƒç®—æ³•
```
ats_core/features/fund_leading.py
  - score_fund_leading_v2(): æ”¹ç”¨ç›¸å¯¹å˜åŒ–ç‡
  - æ·»åŠ use_relative_changeå¼€å…³ï¼ˆå‘åå…¼å®¹ï¼‰
  - æ›´æ–°å…ƒæ•°æ®version: v2.3_relative_change
```

### ç®¡é“é›†æˆ
```
ats_core/pipeline/analyze_symbol.py
  - å¯¼å…¥threshold_config
  - ç§»é™¤ç¡¬ç¼–ç confidence >= 45
  - ä»é…ç½®è¯»å–confidence_threshold
  - æ›´æ–°æ‹’ç»åŸå› ä¸­çš„ç¡¬ç¼–ç 45
```

---

## æµ‹è¯•ç»“æœæ±‡æ€»

### Test 1: JSONæ ¼å¼éªŒè¯
```bash
python3 -c "import json; json.load(open('config/factors_unified.json'))"
```
âœ… JSONæ ¼å¼éªŒè¯é€šè¿‡

### Test 2: é…ç½®åŠ è½½éªŒè¯
```python
from ats_core.config.threshold_config import get_thresholds
config = get_thresholds()
confidence_min = config.get_mature_threshold('confidence_min', 45)
# Result: confidence_min = 20 âœ…

from ats_core.config.factor_config import get_factor_config
factor_config = get_factor_config()
f_v2 = factor_config.get_factor_params("F")["v2"]
# Result: scale=0.10, use_relative_change=True âœ…
```
âœ… é…ç½®åŠ è½½æµ‹è¯•é€šè¿‡

### Test 3: æ¨¡å—å¯¼å…¥éªŒè¯
```python
from ats_core.pipeline.analyze_symbol import analyze_symbol_with_preloaded_klines
from ats_core.features.fund_leading import score_fund_leading_v2
from ats_core.factors_v2.independence import calculate_independence
```
âœ… æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ

### Test 4: Iå› å­è¯Šæ–­æµ‹è¯•
```python
# åœºæ™¯1: æ­£å¸¸æ•°æ® â†’ betaè®¡ç®—æˆåŠŸ âœ…
# åœºæ™¯2: æ•°æ®ä¸è¶³ â†’ è¿”å›I=50, error='Insufficient data' âœ…
# åœºæ™¯3: ç©ºæ•°æ®   â†’ è¿”å›I=50, error='Insufficient data' âœ…
```
âœ… Iå› å­é€»è¾‘æ­£ç¡®ï¼Œé—®é¢˜åœ¨äºæ•°æ®è·å–

---

## å½±å“èŒƒå›´

### ä¿¡å·è´¨é‡
- **ç´§æ€¥æå‡**: 0ä¸ªä¿¡å· â†’ é¢„è®¡20-50ä¸ªä¿¡å·
- **Få› å­å‡†ç¡®æ€§**: 97.8%é¥±å’Œ â†’ <10%é¥±å’Œ
- **ç»æµå­¦åˆç†æ€§**: ç»å¯¹å€¼æ¯”è¾ƒ â†’ ç›¸å¯¹å˜åŒ–ç‡æ¯”è¾ƒ

### ç³»ç»Ÿè§„èŒƒç¬¦åˆæ€§
- âœ… ç§»é™¤ç¡¬ç¼–ç Magic Numberï¼ˆconfidence >= 45ï¼‰
- âœ… ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆç¬¦åˆè§„èŒƒÂ§ 5ï¼‰
- âœ… é…ç½®éªŒè¯å™¨é€šè¿‡

### å‘åå…¼å®¹æ€§
- âœ… å®Œå…¨å…¼å®¹
- Få› å­æ”¯æŒæ—§é€»è¾‘ï¼ˆuse_relative_change=falseæ—¶å›é€€ï¼‰
- é…ç½®æ–‡ä»¶æä¾›é»˜è®¤å€¼

---

## ä¸‹ä¸€æ­¥å»ºè®®

### ç”¨æˆ·æ“ä½œ
1. **ç«‹å³é‡å¯æ‰«æ**ï¼š`./setup.sh`
2. **éªŒè¯ä¿®å¤æ•ˆæœ**ï¼š
   - æ£€æŸ¥Få› å­æ˜¯å¦ä¸å†é¥±å’Œï¼ˆæœŸæœ›<10%ï¼‰
   - æ£€æŸ¥æ˜¯å¦æœ‰ä¿¡å·é€šè¿‡ï¼ˆæœŸæœ›20-50ä¸ªï¼‰
3. **æ£€æŸ¥Iå› å­æ•°æ®**ï¼š
   - æŸ¥çœ‹æ‰«ææ—¥å¿—ä¸­æ˜¯å¦æœ‰BTC/ETH Kçº¿è·å–è­¦å‘Š
   - ç¡®è®¤ç½‘ç»œå’ŒAPIå¯è®¿é—®æ€§

### åç»­ä¼˜åŒ–ï¼ˆP2ä¼˜å…ˆçº§ï¼‰
1. å¢å¼ºBTC/ETH Kçº¿è·å–çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
2. æ·»åŠ æ•°æ®è·å–çŠ¶æ€ç›‘æ§ä»ªè¡¨æ¿
3. ä¼˜åŒ–Få› å­çš„scaleå‚æ•°ï¼ˆåŸºäºå®é™…è¿è¡Œæ•°æ®å¾®è°ƒï¼‰

---

## æŠ€æœ¯æ€»ç»“

### ç»éªŒæ•™è®­

1. **ä½¿ç”¨ç›¸å¯¹æ•°æ®è€Œéç»å¯¹æ•°æ®**
   - CVDï¼ˆç´¯ç§¯æˆäº¤é‡ï¼‰æ˜¯ç»å¯¹å€¼ï¼Œç›´æ¥é™¤ä»¥ä»·æ ¼ä¼šäº§ç”Ÿå¤©æ–‡æ•°å­—
   - åº”è¯¥ä½¿ç”¨å˜åŒ–ç‡ï¼ˆç›¸å¯¹å€¼ï¼‰è¿›è¡Œæ¯”è¾ƒ

2. **ä¸¥æ ¼éµå®ˆé…ç½®åŒ–ç®¡ç†**
   - ç¡¬ç¼–ç Magic Numberä¼šå¯¼è‡´ç»´æŠ¤å›°éš¾
   - é…ç½®å’Œä»£ç ä¸ä¸€è‡´ä¼šå¯¼è‡´ä¸¥é‡bug

3. **å®Œå–„é”™è¯¯è¯Šæ–­å·¥å…·**
   - Iå› å­çš„é—®é¢˜é€šè¿‡è¯Šæ–­è„šæœ¬å¿«é€Ÿå®šä½
   - æ•°æ®è·å–å¤±è´¥åº”è¯¥æœ‰æ˜æ˜¾çš„è­¦å‘Šå’Œç›‘æ§

### ç¬¦åˆè§„èŒƒ

âœ… ä¸¥æ ¼æŒ‰ç…§ `standards/SYSTEM_ENHANCEMENT_STANDARD.md`:
- Phase 1: éœ€æ±‚åˆ†æï¼ˆFå› å­å¤©æ–‡æ•°å­—+ç½®ä¿¡åº¦ç¡¬ç¼–ç ï¼‰
- Phase 2: æ ¸å¿ƒå®ç°ï¼ˆconfig â†’ core â†’ pipelineï¼‰
- Phase 3: æµ‹è¯•éªŒè¯ï¼ˆJSON + é…ç½®åŠ è½½ + æ¨¡å—å¯¼å…¥ï¼‰
- Phase 4: æ–‡æ¡£æ›´æ–°ï¼ˆå½“å‰æ–‡æ¡£ï¼‰
- Phase 5: Gitæäº¤ï¼ˆå³å°†è¿›è¡Œï¼‰

---

**ç‰ˆæœ¬**: v7.2.3
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•**: âœ… å…¨éƒ¨é€šè¿‡
**æ–‡æ¡£**: âœ… å·²åŒæ­¥
