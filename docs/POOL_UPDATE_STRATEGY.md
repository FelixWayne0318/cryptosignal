# å€™é€‰æ± æ›´æ–°ç­–ç•¥

## ðŸ“‹ æ›´æ–°é¢‘çŽ‡å»ºè®®

### **Base Poolï¼ˆåŸºç¡€æ± ï¼‰**
- **æ›´æ–°é¢‘çŽ‡**: æ¯æ—¥1æ¬¡
- **æŽ¨èæ—¶é—´**: UTC 00:00ï¼ˆåŒ—äº¬æ—¶é—´ 08:00ï¼‰
- **åŽŸå› **:
  - Z24æ³¢åŠ¨æ€§æŒ‡æ ‡åŸºäºŽ24å°æ—¶æ•°æ®ï¼Œæ—¥é¢‘æ›´æ–°å³å¯
  - æµåŠ¨æ€§æŽ’åå˜åŒ–ä¸é¢‘ç¹
  - å‡å°‘APIè°ƒç”¨ï¼Œé¿å…é£ŽæŽ§

### **Overlay Poolï¼ˆå åŠ å±‚ï¼‰**
- **æ›´æ–°é¢‘çŽ‡**: æ¯å°æ—¶1æ¬¡
- **æŽ¨èæ—¶é—´**: æ¯å°æ—¶ç¬¬0åˆ†é’Ÿ
- **åŽŸå› **:
  - æ•æ‰çŸ­æœŸå¼‚åŠ¨ä¿¡å·ï¼ˆ1å°æ—¶ä»·æ ¼å˜åŠ¨ï¼‰
  - CVDèµ„é‡‘æµå®žæ—¶æ€§è¦æ±‚é«˜
  - é‡èƒ½æ¯”éœ€è¦åŠæ—¶æ›´æ–°

### **å®žæ—¶æ‰«æ**
- **æ›´æ–°é¢‘çŽ‡**: æŒ‰éœ€è¿è¡Œï¼ˆæ‰‹åŠ¨æˆ–æ¯15åˆ†é’Ÿï¼‰
- **æ•°æ®æ¥æº**: è¯»å–ç¼“å­˜çš„Base + Overlayæ± 
- **é€Ÿåº¦**: ~2åˆ†é’Ÿï¼ˆä»…åˆ†æžå€™é€‰å¸ï¼‰

---

## ðŸš€ æ€§èƒ½ä¼˜åŒ–å¯¹æ¯”

| åœºæ™¯ | å½“å‰æ–¹æ¡ˆ | ä¼˜åŒ–æ–¹æ¡ˆ | æå‡ |
|-----|---------|---------|-----|
| **é¦–æ¬¡è¿è¡Œ** | 5.2åˆ†é’Ÿ | 8.2åˆ†é’Ÿ | -58% |
| **åŽç»­æ‰«æ** | 5.2åˆ†é’Ÿ | 2åˆ†é’Ÿ | +62% |
| **APIè°ƒç”¨** | 521æ¬¡ | 180æ¬¡ | +65% |
| **é£ŽæŽ§é£Žé™©** | ä¸­ç­‰ | ä½Ž | âœ… |

**è¯´æ˜Ž**ï¼šé¦–æ¬¡è¿è¡Œç¨æ…¢ï¼ˆéœ€è¦å»ºç«‹Baseç¼“å­˜ï¼‰ï¼Œä½†åŽç»­æ‰«æé€Ÿåº¦æ˜¾è‘—æå‡ã€‚

---

## âš™ï¸ é…ç½®Crontabå®šæ—¶ä»»åŠ¡

### **1. ç¼–è¾‘Crontab**

```bash
crontab -e
```

### **2. æ·»åŠ å®šæ—¶ä»»åŠ¡**

```bash
# Base Pool: æ¯æ—¥UTC 00:00æ›´æ–°ï¼ˆåŒ—äº¬æ—¶é—´08:00ï¼‰
0 0 * * * cd ~/cryptosignal && python3 tools/update_pools.py --base >> logs/pool_update.log 2>&1

# Overlay Pool: æ¯å°æ—¶æ›´æ–°
0 * * * * cd ~/cryptosignal && python3 tools/update_pools.py --overlay >> logs/pool_update.log 2>&1

# å®žæ—¶æ‰«æ: æ¯15åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼ˆä»Žç¼“å­˜è¯»å–å€™é€‰æ± ï¼‰
*/15 * * * * cd ~/cryptosignal && python3 tools/full_run_v2_fast.py --send >> logs/scan.log 2>&1
```

### **3. åˆ›å»ºæ—¥å¿—ç›®å½•**

```bash
mkdir -p ~/cryptosignal/logs
```

### **4. éªŒè¯Crontab**

```bash
crontab -l  # æŸ¥çœ‹å·²è®¾ç½®çš„ä»»åŠ¡
```

---

## ðŸ› ï¸ æ‰‹åŠ¨æ›´æ–°å‘½ä»¤

### **æ£€æŸ¥ç¼“å­˜çŠ¶æ€**
```bash
cd ~/cryptosignal
python3 tools/update_pools.py --check
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
============================================================
å€™é€‰æ± ç¼“å­˜çŠ¶æ€
============================================================

ðŸ“¦ Base Pool:
   æ–‡ä»¶: /home/user/cryptosignal/data/base_pool.json
   æ›´æ–°: 2å°æ—¶30åˆ†é’Ÿå‰
   çŠ¶æ€: âœ… æœ‰æ•ˆ (å»ºè®®æ¯æ—¥æ›´æ–°)
   æ•°é‡: 67 ä¸ªå¸ç§

ðŸ”¥ Overlay Pool:
   æ–‡ä»¶: /home/user/cryptosignal/data/overlay_pool.json
   æ›´æ–°: 45åˆ†é’Ÿå‰
   çŠ¶æ€: âœ… æœ‰æ•ˆ (å»ºè®®æ¯å°æ—¶æ›´æ–°)
   æ•°é‡: 12 ä¸ªå¸ç§

============================================================
```

### **æ›´æ–°Base Pool**
```bash
python3 tools/update_pools.py --base
```

### **æ›´æ–°Overlay Pool**
```bash
python3 tools/update_pools.py --overlay
```

### **æ›´æ–°å…¨éƒ¨**
```bash
python3 tools/update_pools.py --all
```

### **å¼ºåˆ¶æ›´æ–°ï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰**
```bash
python3 tools/update_pools.py --all --force
```

---

## ðŸ“Š APIè°ƒç”¨é‡åˆ†æž

### **Base Poolæž„å»ºï¼ˆæ¯æ—¥1æ¬¡ï¼‰**
```
- all_24h(): 1æ¬¡è¯·æ±‚, weight=40
- klines_1h(800): 400æ¬¡è¯·æ±‚, weight=400
- æ€»è®¡: 401æ¬¡è¯·æ±‚, weight=440
- è€—æ—¶: ~4åˆ†é’Ÿ
```

### **Overlay Poolæž„å»ºï¼ˆæ¯å°æ—¶1æ¬¡ï¼‰**
```
- get_klines(1h, 60): 60æ¬¡è¯·æ±‚, weight=60
- get_open_interest(1h, 60): 60æ¬¡è¯·æ±‚, weight=60
- æ€»è®¡: 120æ¬¡è¯·æ±‚, weight=120
- è€—æ—¶: ~72ç§’
```

### **å®žæ—¶æ‰«æï¼ˆæ¯15åˆ†é’Ÿï¼Œè¯»ç¼“å­˜ï¼‰**
```
- Base/Overlay: ä»Žæ–‡ä»¶è¯»å–, 0æ¬¡API
- åˆ†æž60ä¸ªå€™é€‰å¸:
  * klines(1h,300): weight=1
  * klines(4h,200): weight=1
  * OI(1h,300): weight=1
  * æ€»è®¡: 180æ¬¡è¯·æ±‚, weight=180
- è€—æ—¶: ~2åˆ†é’Ÿ
```

### **é£ŽæŽ§è¯„ä¼°**
- **å¸å®‰é™åˆ¶**: 1200 req/min, 3000 weight/min
- **å•æ¬¡æ‰«æ**: 180 weightï¼ˆä»…6%é…é¢ï¼‰
- **ç»“è®º**: âœ… å®‰å…¨ï¼Œä¸ä¼šè§¦å‘é£ŽæŽ§

---

## ðŸŽ¯ ä¼˜åŒ–æ•ˆæžœ

### **ä¼˜åŒ–å‰ï¼ˆæ¯æ¬¡éƒ½é‡å»ºå€™é€‰æ± ï¼‰**
```
å…¨å¸‚åœºæ‰«æ â†’ Baseç­›é€‰ â†’ Overlayç­›é€‰ â†’ åˆ†æž â†’ å‘é€
    â†“           â†“           â†“           â†“
  40w        521æ¬¡      5.2åˆ†é’Ÿ    é£ŽæŽ§é£Žé™©
```

### **ä¼˜åŒ–åŽï¼ˆç¼“å­˜åˆ†ç¦»æ›´æ–°ï¼‰**
```
[æ¯æ—¥] Base Poolæ›´æ–° â†’ ç¼“å­˜
         â†“
[æ¯å°æ—¶] Overlay Poolæ›´æ–° â†’ ç¼“å­˜
         â†“
[å®žæ—¶] è¯»å–ç¼“å­˜ â†’ åˆ†æž â†’ å‘é€
       â†“         â†“
     0ç§’      180æ¬¡     2åˆ†é’Ÿ    âœ…å®‰å…¨
```

---

## ðŸ”§ é…ç½®å‚æ•°è¯´æ˜Ž

**config/params.json**:

```json
{
  "base": {
    "min_quote_volume": 5000000,    // æœ€å°æˆäº¤é¢500ä¸‡USDT
    "min_z24_abs": 0.5,              // Z24æ³¢åŠ¨æ€§é˜ˆå€¼
    "min_pool_size": 20              // ä¿åº•æ•°é‡ï¼ˆéœ‡è¡å¸‚ä¿è¯è‡³å°‘20ä¸ªï¼‰
  },

  "overlay": {
    "triple_sync": {
      "mode": "2of3",                // ä¸‰é€‰äºŒæ¨¡å¼ï¼ˆé™ä½Žä¸¥æ ¼åº¦ï¼‰
      "dP1h_abs_pct": 0.015,         // 1.5%ä»·æ ¼å˜åŠ¨ï¼ˆåŽŸ2%ï¼‰
      "v5_over_v20": 1.2,            // 1.2å€é‡èƒ½ï¼ˆåŽŸ1.3å€ï¼‰
      "cvd_mix_abs_per_h": 0.025,    // 2.5% CVDï¼ˆåŽŸ3%ï¼‰
      "anti_chase": {
        "enabled": true,             // å¯ç”¨å›žæ’¤è¿‡æ»¤
        "lookback": 72,              // å›žçœ‹72å°æ—¶
        "max_distance_pct": 0.05     // è·ç¦»é«˜ç‚¹/ä½Žç‚¹5%å†…è·³è¿‡
      }
    }
  }
}
```

---

## ðŸ“ æ—¥å¿—ç›‘æŽ§

### **æŸ¥çœ‹æ›´æ–°æ—¥å¿—**
```bash
tail -f ~/cryptosignal/logs/pool_update.log
```

### **æŸ¥çœ‹æ‰«ææ—¥å¿—**
```bash
tail -f ~/cryptosignal/logs/scan.log
```

### **æ—¥å¿—è½®è½¬ï¼ˆå¯é€‰ï¼‰**
```bash
# åœ¨ /etc/logrotate.d/cryptosignal
/home/user/cryptosignal/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**ï¼šéœ€è¦æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ `--all` å»ºç«‹åˆå§‹ç¼“å­˜
2. **ç½‘ç»œæ–­å¼€**ï¼šæ›´æ–°å¤±è´¥ä¸å½±å“çŽ°æœ‰ç¼“å­˜ï¼Œä¸‹æ¬¡é‡è¯•
3. **å¸å®‰å°IP**ï¼šå¦‚æžœé‡åˆ°403ï¼Œç­‰å¾…5åˆ†é’ŸåŽé‡è¯•
4. **æ—¶åŒºè®¾ç½®**ï¼šCrontabé»˜è®¤ä½¿ç”¨ç³»ç»Ÿæ—¶åŒºï¼Œæ³¨æ„UTCè½¬æ¢
5. **SSHæ–­å¼€**ï¼šä½¿ç”¨ `nohup` æˆ– `screen` ä¿æŒé•¿æ—¶é—´è¿è¡Œ

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. é¦–æ¬¡å»ºç«‹ç¼“å­˜
cd ~/cryptosignal
python3 tools/update_pools.py --all --force

# 2. æ£€æŸ¥çŠ¶æ€
python3 tools/update_pools.py --check

# 3. è¿è¡Œä¸€æ¬¡æ‰«ææµ‹è¯•
python3 tools/full_run_v2_fast.py

# 4. è®¾ç½®å®šæ—¶ä»»åŠ¡
crontab -e
# ï¼ˆç²˜è´´ä¸Šé¢çš„crontabé…ç½®ï¼‰

# 5. ç›‘æŽ§æ—¥å¿—
tail -f logs/scan.log
```

---

## ðŸ“ˆ ç›‘æŽ§å»ºè®®

- **æ¯æ—¥æ£€æŸ¥**ï¼šBase Poolæ•°é‡æ˜¯å¦æ­£å¸¸ï¼ˆ50-80ä¸ªï¼‰
- **æ¯å°æ—¶æ£€æŸ¥**ï¼šOverlay Poolæ˜¯å¦ä¸ºç©ºï¼ˆéœ‡è¡å¸‚å¯èƒ½ä¸º0ï¼‰
- **å®žæ—¶ç›‘æŽ§**ï¼šæ‰«ææˆåŠŸçŽ‡ã€ä¿¡å·æ•°é‡ã€Telegramå‘é€çŠ¶æ€
- **å¼‚å¸¸å‘Šè­¦**ï¼šAPIå¤±è´¥çŽ‡ > 10%æ—¶äººå·¥ä»‹å…¥
