# CryptoSignal v7.4.2 - å›æµ‹éªŒè¯å‡†å¤‡åº¦è¯„ä¼°

**è¯„ä¼°æ—¥æœŸ**: 2025-11-18
**è¯„ä¼°äºº**: Claude Code
**ç›®çš„**: è¯„ä¼°ç³»ç»Ÿæ˜¯å¦å…·å¤‡æ‰§è¡Œå››æ­¥å†³ç­–ç³»ç»Ÿå›æµ‹éªŒè¯çš„æ¡ä»¶

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

**å‡†å¤‡åº¦è¯„åˆ†**: âš ï¸ **75% - åŸºç¡€æ¡ä»¶æ»¡è¶³ï¼Œä½†ç¼ºå°‘å…³é”®å›æµ‹æ¡†æ¶**

**å…³é”®ç»“è®º**:
- âœ… å››æ­¥å†³ç­–ç³»ç»Ÿå®Œæ•´å¯ç”¨ï¼ˆ98%å®ç°åº¦ï¼‰
- âœ… æ•°æ®é‡‡é›†åŸºç¡€è®¾æ–½å­˜åœ¨
- âœ… Binanceå†å²æ•°æ®APIå¯ç”¨
- âœ… å› å­è®¡ç®—pipelineå®Œæ•´
- âŒ **ç¼ºå°‘ä¸“é—¨çš„å›æµ‹æ¡†æ¶/è„šæœ¬**
- âŒ **ç¼ºå°‘æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ä½“ç³»**

**æ¨èè¡ŒåŠ¨**: éœ€è¦å¼€å‘å›æµ‹æ¡†æ¶ï¼Œé¢„è®¡å·¥ä½œé‡ 2-3å¤©

---

## ğŸ” è¯¦ç»†è¯„ä¼°æ¸…å•

### âœ… å·²å…·å¤‡çš„æ¡ä»¶ï¼ˆ75%ï¼‰

#### 1. å››æ­¥å†³ç­–ç³»ç»Ÿ âœ… å®Œæ•´
- **çŠ¶æ€**: å·²å®Œæ•´å®ç°å¹¶éªŒè¯
- **è¯æ®**: `FOUR_STEP_SYSTEM_VERIFICATION_REPORT.md`
- **å¯ç”¨æ€§**: 100%
- **è°ƒç”¨æ–¹å¼**: `from ats_core.decision.four_step_system import run_four_step_decision`

#### 2. æ•°æ®é‡‡é›†åŸºç¡€è®¾æ–½ âœ… å­˜åœ¨
**æ¨¡å—ä½ç½®**:
- `ats_core/data/trade_recorder.py` - äº¤æ˜“è®°å½•å™¨
- `ats_core/data/analysis_db.py` - åˆ†ææ•°æ®åº“

**æ•°æ®åº“çŠ¶æ€**:
```
data/database/cryptosignal.db
â”œâ”€ signals è¡¨: 80æ¡å†å²è®°å½• âœ…
â”œâ”€ daily_metrics è¡¨: 0æ¡è®°å½•
â””â”€ candidate_pools è¡¨: 0æ¡è®°å½•
```

**signalsè¡¨å­—æ®µ**ï¼ˆ30ä¸ªå­—æ®µï¼‰:
- âœ… symbol, timestamp, side
- âœ… scores (å› å­å¾—åˆ†JSON)
- âœ… scores_meta (å…ƒæ•°æ®JSON)
- âœ… entry_price, stop_loss, take_profit_1/2
- âœ… current_price, is_prime, is_watch
- âœ… exit_price, exit_time, pnl_percent, pnl_usdtï¼ˆç”¨äºè·Ÿè¸ªç»“æœï¼‰

**è¯„ä¼°**: æ•°æ®ç»“æ„å®Œæ•´ï¼Œæ”¯æŒå†å²ä¿¡å·å­˜å‚¨å’Œç»“æœè·Ÿè¸ª âœ…

#### 3. Binanceå†å²æ•°æ®API âœ… å¯ç”¨

**æ¨¡å—ä½ç½®**:
- `ats_core/sources/binance.py` - Binance APIå°è£…
- `ats_core/sources/binance_safe.py` - å®‰å…¨ç‰ˆæœ¬

**å†å²Kçº¿èƒ½åŠ›**:
```python
# Binance APIæ”¯æŒå†å²Kçº¿æŸ¥è¯¢
# GET /api/v3/klines
# å‚æ•°: symbol, interval, startTime, endTime, limit
```

**éªŒè¯æ–¹æ³•**:
```bash
# æµ‹è¯•è·å–å†å²Kçº¿
python3 -c "
from ats_core.sources.binance import get_klines
klines = get_klines('BTCUSDT', '1h', limit=100)
print(f'è·å–åˆ° {len(klines)} æ ¹Kçº¿')
"
```

**è¯„ä¼°**: Binance APIå®Œæ•´æ”¯æŒå†å²æ•°æ®è·å– âœ…

#### 4. å› å­è®¡ç®—Pipeline âœ… å®Œæ•´

**ä¸»è¦æ¨¡å—**:
- `ats_core/pipeline/analyze_symbol.py` - å•å¸åˆ†æï¼ˆåŒ…å«æ‰€æœ‰å› å­è®¡ç®—ï¼‰
- `ats_core/factors/` - å› å­è®¡ç®—æ¨¡å—
  - `trend.py` (Tå› å­)
  - `momentum.py` (Må› å­)
  - `cvd_flow.py` (Cå› å­)
  - `volume.py` (Vå› å­)
  - `open_interest.py` (Oå› å­)
  - `basis_funding.py` (Bå› å­)
  - `liquidity.py` (Lå› å­)
  - `structure.py` (Så› å­)
  - `independence.py` (Iå› å­)

**è°ƒç”¨æµç¨‹**:
```
å†å²Kçº¿æ•°æ®
  â””â”€> analyze_symbol(symbol, k1, k5, k15, ...)
       â”œâ”€> è®¡ç®—9ä¸ªå› å­ (T/M/C/V/O/B/L/S/I)
       â”œâ”€> æ„é€ factor_scores_series
       â””â”€> è°ƒç”¨run_four_step_decision()
            â””â”€> è¿”å›ACCEPT/REJECT + Entry/SL/TP
```

**è¯„ä¼°**: å› å­è®¡ç®—å®Œå…¨ç‹¬ç«‹ï¼Œæ”¯æŒä»»æ„å†å²æ—¶é—´ç‚¹è®¡ç®— âœ…

#### 5. é…ç½®ç³»ç»Ÿ âœ… å®Œæ•´

**é…ç½®æ–‡ä»¶**: `config/params.json`
- âœ… `four_step_system` é…ç½®å—ï¼ˆå·²å¯ç”¨ï¼‰
- âœ… æ‰€æœ‰å› å­è®¡ç®—å‚æ•°
- âœ… é›¶ç¡¬ç¼–ç è®¾è®¡

**å›æµ‹é…ç½®éœ€æ±‚**:
- å¯ä»¥ç›´æ¥ä½¿ç”¨ç”Ÿäº§é…ç½®
- æˆ–åˆ›å»ºç‹¬ç«‹çš„ `config/backtest_params.json`

---

### âŒ ç¼ºå°‘çš„å…³é”®ç»„ä»¶ï¼ˆ25%ï¼‰

#### 1. å›æµ‹æ¡†æ¶ âŒ ä¸å­˜åœ¨

**å½“å‰çŠ¶æ€**:
```bash
$ find . -name "*backtest*" -o -name "*back_test*"
(æ— ç»“æœ)
```

**éœ€è¦çš„åŠŸèƒ½**:
1. **å†å²æ•°æ®åŠ è½½å™¨**
   ```python
   class HistoricalDataLoader:
       def load_klines(symbol, start_date, end_date, interval='1h')
       def load_btc_klines(start_date, end_date)
       def load_orderbook_snapshots(symbol, timestamp)  # å¯é€‰
   ```

2. **å›æµ‹å¼•æ“**
   ```python
   class BacktestEngine:
       def __init__(params, start_date, end_date, symbols)
       def run() -> BacktestResult
       def simulate_signal(symbol, timestamp, klines) -> signal
       def track_outcome(signal, actual_klines) -> pnl
   ```

3. **æ€§èƒ½è¯„ä¼°å™¨**
   ```python
   class PerformanceEvaluator:
       def calculate_metrics(signals) -> dict
       # èƒœç‡ã€å¹³å‡èµ”ç‡ã€å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ç­‰
   ```

**å¼€å‘å·¥ä½œé‡**:
- ä¼°è®¡: 2-3å¤©
- éš¾åº¦: ä¸­ç­‰

#### 2. æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ä½“ç³» âŒ ä¸å®Œæ•´

**éœ€è¦çš„æŒ‡æ ‡**:

**äº¤æ˜“æ€§èƒ½æŒ‡æ ‡**:
- [ ] æ€»ä¿¡å·æ•°é‡
- [ ] å¤š/ç©ºä¿¡å·åˆ†å¸ƒ
- [ ] èƒœç‡ (Win Rate)
- [ ] å¹³å‡èµ”ç‡ (Avg RR)
- [ ] ç›ˆäºæ¯” (Profit Factor)
- [ ] æœ€å¤§è¿ç»­äºæŸ (Max Consecutive Losses)

**å››æ­¥ç³»ç»Ÿç‰¹å®šæŒ‡æ ‡**:
- [ ] Step1é€šè¿‡ç‡ / æ‹’ç»åŸå› åˆ†å¸ƒ
- [ ] Step2é€šè¿‡ç‡ / æ—¶æœºè´¨é‡åˆ†å¸ƒ
- [ ] Step3é€šè¿‡ç‡ / å¹³å‡èµ”ç‡åˆ†å¸ƒ
- [ ] Step4é€šè¿‡ç‡ / é—¸é—¨æ‹’ç»åˆ†å¸ƒ
- [ ] ç¡¬vetoè§¦å‘æ¬¡æ•° / æ¯”ä¾‹

**é£é™©æŒ‡æ ‡**:
- [ ] æœ€å¤§å›æ’¤ (Max Drawdown)
- [ ] å¤æ™®æ¯”ç‡ (Sharpe Ratio)
- [ ] å¡å°”é©¬æ¯”ç‡ (Calmar Ratio)
- [ ] é£é™©ä»·å€¼ (VaR)

**å¯¹æ¯”æŒ‡æ ‡** (å››æ­¥ç³»ç»Ÿ vs æ—§ç³»ç»Ÿ):
- [ ] å¸ç­¹è¯†åˆ«ç‡æå‡
- [ ] è¿½é«˜æ‹¦æˆªç‡æå‡
- [ ] èƒœç‡å˜åŒ–
- [ ] ä¿¡å·æ•°é‡å˜åŒ–
- [ ] å¹³å‡æŒä»“æ—¶é—´å˜åŒ–

**å®ç°å»ºè®®**:
```python
# ats_core/backtest/metrics.py
class BacktestMetrics:
    def __init__(self, signals: List[Signal]):
        self.signals = signals

    def win_rate(self) -> float
    def avg_risk_reward(self) -> float
    def sharpe_ratio(self) -> float
    def max_drawdown(self) -> float
    def step_pass_rates(self) -> dict
    def generate_report(self) -> str
```

#### 3. å›æµ‹ç»“æœå¯è§†åŒ– âŒ ä¸å­˜åœ¨

**éœ€è¦çš„åŠŸèƒ½**:
- [ ] æƒç›Šæ›²çº¿å›¾ (Equity Curve)
- [ ] å›æ’¤æ›²çº¿å›¾ (Drawdown)
- [ ] ä¿¡å·åˆ†å¸ƒå›¾ï¼ˆæŒ‰æ—¶é—´ã€å¸ç§ã€æ–¹å‘ï¼‰
- [ ] å››æ­¥ç³»ç»Ÿæ¼æ–—å›¾ï¼ˆStep1â†’2â†’3â†’4é€šè¿‡ç‡ï¼‰
- [ ] èµ”ç‡åˆ†å¸ƒç›´æ–¹å›¾
- [ ] èƒœç‡çƒ­åŠ›å›¾ï¼ˆæŒ‰å¸‚åœºçŠ¶æ€ï¼‰

**å®ç°å»ºè®®**:
- ä½¿ç”¨ `matplotlib` æˆ– `plotly`
- è¾“å‡ºHTMLæŠ¥å‘Šï¼ˆé›†æˆå›¾è¡¨ï¼‰

---

## ğŸ“Š æ•°æ®å¯ç”¨æ€§è¯„ä¼°

### å†å²æ•°æ®éœ€æ±‚ vs å¯ç”¨æ€§

| æ•°æ®ç±»å‹ | å›æµ‹éœ€æ±‚ | å½“å‰å¯ç”¨æ€§ | è·å–æ–¹å¼ | çŠ¶æ€ |
|---------|---------|-----------|---------|------|
| 1h Kçº¿ | âœ… å¿…éœ€ | âœ… å¯ç”¨ | Binance API | âœ… |
| 5m Kçº¿ | âš ï¸ å¯é€‰ | âœ… å¯ç”¨ | Binance API | âœ… |
| 15m Kçº¿ | âš ï¸ å¯é€‰ | âœ… å¯ç”¨ | Binance API | âœ… |
| BTC Kçº¿ | âœ… å¿…éœ€ | âœ… å¯ç”¨ | Binance API | âœ… |
| æˆäº¤é‡ | âœ… å¿…éœ€ | âœ… å¯ç”¨ | Kçº¿åŒ…å« | âœ… |
| èµ„é‡‘è´¹ç‡ | âœ… å¿…éœ€ | âœ… å¯ç”¨ | Binance API | âœ… |
| æŒä»“é‡(OI) | âœ… å¿…éœ€ | âœ… å¯ç”¨ | Binance API | âœ… |
| è®¢å•ç°¿ | âš ï¸ å¯é€‰ | âŒ æ— å†å² | æ— å­˜å‚¨ | âš ï¸ |

**è¯„ä¼°**: æ ¸å¿ƒæ•°æ®å®Œå…¨å¯è·å–ï¼Œè®¢å•ç°¿å†å²æ•°æ®ç¼ºå¤±ä½†ä¸å½±å“åŸºç¡€å›æµ‹ âœ…

### è®¢å•ç°¿æ•°æ®é—®é¢˜

**é—®é¢˜**: Binance APIä¸æä¾›å†å²è®¢å•ç°¿å¿«ç…§

**å½±å“**:
- âš ï¸ Step3ä¸­çš„è®¢å•ç°¿å¢™è°ƒæ•´åŠŸèƒ½æ— æ³•å›æµ‹
- âš ï¸ Lå› å­è®¢å•ç°¿éƒ¨åˆ†éœ€è¦é™çº§å¤„ç†

**è§£å†³æ–¹æ¡ˆ**:
1. **çŸ­æœŸ**: è®¢å•ç°¿éƒ¨åˆ†ä½¿ç”¨é»˜è®¤å€¼/ç¦ç”¨å¢™è°ƒæ•´
2. **ä¸­æœŸ**: ä»ç°åœ¨å¼€å§‹é‡‡é›†å¹¶å­˜å‚¨è®¢å•ç°¿å¿«ç…§
3. **é•¿æœŸ**: ä½¿ç”¨è®¢å•ç°¿å†å²æ•°æ®è¿›è¡Œæ›´ç²¾ç¡®å›æµ‹

**è¯„ä¼°**: ä¸å½±å“æ ¸å¿ƒå›æµ‹èƒ½åŠ›ï¼Œè®¢å•ç°¿åŠŸèƒ½å¯åç»­éªŒè¯ âš ï¸

---

## ğŸ¯ å›æµ‹æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆA: ç®€æ˜“å›æµ‹ï¼ˆå¿«é€ŸéªŒè¯ï¼‰

**ç›®æ ‡**: å¿«é€ŸéªŒè¯å››æ­¥ç³»ç»ŸåŸºç¡€æ€§èƒ½

**èŒƒå›´**:
- æ—¶é—´: æœ€è¿‘3ä¸ªæœˆ (2024-08-18 ~ 2024-11-18)
- å¸ç§: Top 50å¸‚å€¼å¸ç§
- æ•°æ®: 1h Kçº¿ + åŸºç¡€å› å­

**å·¥ä½œé‡**: 1-2å¤©

**è¾“å‡º**:
- æ€»ä¿¡å·æ•°é‡
- å››æ­¥ç³»ç»Ÿé€šè¿‡ç‡
- ç®€å•èƒœç‡ç»Ÿè®¡
- Step1-4æ‹’ç»åŸå› åˆ†å¸ƒ

**ä¼˜ç‚¹**: å¿«é€ŸéªŒè¯ï¼Œä½æˆæœ¬
**ç¼ºç‚¹**: æŒ‡æ ‡ä¸å¤Ÿå…¨é¢

### æ–¹æ¡ˆB: å®Œæ•´å›æµ‹ï¼ˆæ·±åº¦éªŒè¯ï¼‰â­ æ¨è

**ç›®æ ‡**: å…¨é¢è¯„ä¼°å››æ­¥ç³»ç»Ÿæ€§èƒ½ï¼Œä¸æ—§ç³»ç»Ÿå¯¹æ¯”

**èŒƒå›´**:
- æ—¶é—´: 6ä¸ªæœˆ ~ 1å¹´ (2024-01-01 ~ 2024-11-18)
- å¸ç§: Top 100å¸‚å€¼å¸ç§
- æ•°æ®: 1h/5m/15m Kçº¿ + å…¨å› å­

**å·¥ä½œé‡**: 3-5å¤©

**è¾“å‡º**:
1. **å®Œæ•´æ€§èƒ½æŠ¥å‘Š**:
   - äº¤æ˜“æ€§èƒ½æŒ‡æ ‡ï¼ˆèƒœç‡ã€èµ”ç‡ã€å¤æ™®ã€å›æ’¤ï¼‰
   - å››æ­¥ç³»ç»Ÿç‰¹å®šæŒ‡æ ‡ï¼ˆå„æ­¥é€šè¿‡ç‡ã€æ‹’ç»åˆ†å¸ƒï¼‰
   - é£é™©æŒ‡æ ‡ï¼ˆVaRã€æœ€å¤§è¿äºï¼‰

2. **å¯¹æ¯”åˆ†æ**:
   - å››æ­¥ç³»ç»Ÿ vs æ—§ç³»ç»Ÿæ€§èƒ½å¯¹æ¯”
   - å¸ç­¹è¯†åˆ«ç‡æå‡
   - è¿½é«˜æ‹¦æˆªç‡æå‡
   - ä¿¡å·è´¨é‡æ”¹å–„

3. **å¯è§†åŒ–æŠ¥å‘Š**:
   - æƒç›Šæ›²çº¿
   - å›æ’¤æ›²çº¿
   - å››æ­¥æ¼æ–—å›¾
   - èµ”ç‡åˆ†å¸ƒ

**ä¼˜ç‚¹**: å…¨é¢éªŒè¯ï¼Œæ•°æ®å……åˆ†
**ç¼ºç‚¹**: å¼€å‘å·¥ä½œé‡è¾ƒå¤§

### æ–¹æ¡ˆC: ç”Ÿäº§æ•°æ®å›æµ‹ï¼ˆçœŸå®éªŒè¯ï¼‰

**ç›®æ ‡**: ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé‡‡é›†çš„çœŸå®ä¿¡å·è¿›è¡Œå›æµ‹éªŒè¯

**æ•°æ®æ¥æº**: `data/database/cryptosignal.db` (å·²æœ‰80æ¡ä¿¡å·)

**èŒƒå›´**:
- ä½¿ç”¨å·²é‡‡é›†çš„80ä¸ªå†å²ä¿¡å·
- è·Ÿè¸ªå®é™…ä»·æ ¼èµ°åŠ¿
- è®¡ç®—çœŸå®ç›ˆäº

**å·¥ä½œé‡**: 0.5å¤©ï¼ˆæ•°æ®å·²å­˜åœ¨ï¼‰

**è¾“å‡º**:
- 80ä¸ªä¿¡å·çš„çœŸå®è¡¨ç°
- å®é™…èƒœç‡
- å®é™…å¹³å‡èµ”ç‡
- Entry/SL/TPæ‰§è¡Œæƒ…å†µ

**ä¼˜ç‚¹**: çœŸå®æ•°æ®ï¼Œæ— æ¨¡æ‹Ÿè¯¯å·®
**ç¼ºç‚¹**: æ•°æ®é‡å°‘ï¼ˆ80ä¸ªï¼‰ï¼Œç»Ÿè®¡æ„ä¹‰æœ‰é™

---

## ğŸ“ æ¨èå®æ–½è·¯å¾„

### Phase 1: å¿«é€ŸéªŒè¯ï¼ˆ1å‘¨å†…ï¼‰â­ ç«‹å³æ‰§è¡Œ

**ç›®æ ‡**: éªŒè¯å››æ­¥ç³»ç»ŸåŸºç¡€å¯è¡Œæ€§

**æ­¥éª¤**:
1. **Day 1**: å¼€å‘ç®€æ˜“å›æµ‹æ¡†æ¶
   ```python
   # scripts/simple_backtest.py
   # æ ¸å¿ƒåŠŸèƒ½: å†å²æ•°æ®åŠ è½½ + å››æ­¥ç³»ç»Ÿè°ƒç”¨ + ç»“æœç»Ÿè®¡
   ```

2. **Day 2**: æ‰§è¡Œå›æµ‹
   ```bash
   # æœ€è¿‘3ä¸ªæœˆï¼ŒTop 50å¸ç§
   python scripts/simple_backtest.py --start 2024-08-18 --end 2024-11-18 --top 50
   ```

3. **Day 3**: åˆ†æç»“æœ
   - æ€»ä¿¡å·æ•°é‡
   - Step1-4é€šè¿‡ç‡
   - åŸºç¡€èƒœç‡ç»Ÿè®¡
   - è¯†åˆ«æ˜æ˜¾é—®é¢˜

**é¢„æœŸäº§å‡º**:
- âœ… éªŒè¯å››æ­¥ç³»ç»Ÿå¯è¿è¡Œ
- âœ… è·å¾—åˆæ­¥æ€§èƒ½æ•°æ®
- âœ… å‘ç°æ½œåœ¨é—®é¢˜

### Phase 2: å®Œæ•´å›æµ‹ï¼ˆ2-3å‘¨å†…ï¼‰

**ç›®æ ‡**: æ·±åº¦æ€§èƒ½è¯„ä¼° + å‚æ•°ä¼˜åŒ–

**æ­¥éª¤**:
1. **Week 1**: å¼€å‘å®Œæ•´å›æµ‹æ¡†æ¶
   - å†å²æ•°æ®åŠ è½½å™¨
   - å›æµ‹å¼•æ“
   - æ€§èƒ½è¯„ä¼°å™¨
   - å¯è§†åŒ–æ¨¡å—

2. **Week 2**: æ‰§è¡Œå®Œæ•´å›æµ‹
   - 6-12ä¸ªæœˆå†å²æ•°æ®
   - Top 100å¸ç§
   - å¤šæ—¶é—´æ¡†æ¶

3. **Week 3**: æ·±åº¦åˆ†æ + å‚æ•°è°ƒä¼˜
   - å¯¹æ¯”å››æ­¥ç³»ç»Ÿ vs æ—§ç³»ç»Ÿ
   - Walk-forward analysis
   - å‚æ•°æ•æ„Ÿæ€§åˆ†æ

**é¢„æœŸäº§å‡º**:
- âœ… å®Œæ•´æ€§èƒ½æŠ¥å‘Š
- âœ… å‚æ•°ä¼˜åŒ–å»ºè®®
- âœ… é£é™©è¯„ä¼°æŠ¥å‘Š

### Phase 3: ç”Ÿäº§éªŒè¯ï¼ˆæŒç»­ï¼‰

**ç›®æ ‡**: çœŸå®ç¯å¢ƒæ€§èƒ½è·Ÿè¸ª

**æ­¥éª¤**:
1. å¯ç”¨æ•°æ®é‡‡é›†ï¼ˆå·²æœ‰æ¨¡å—ï¼‰
2. æ¯æ—¥è·Ÿè¸ªä¿¡å·ç»“æœ
3. æœˆåº¦æ€§èƒ½æŠ¥å‘Š
4. æŒç»­å‚æ•°å¾®è°ƒ

---

## ğŸ› ï¸ éœ€è¦å¼€å‘çš„æ¨¡å—

### 1. å†å²æ•°æ®åŠ è½½å™¨ (ä¼˜å…ˆçº§: é«˜)

**æ–‡ä»¶**: `ats_core/backtest/data_loader.py`

**åŠŸèƒ½**:
```python
class HistoricalDataLoader:
    def __init__(self, start_date, end_date):
        pass

    def load_klines(self, symbol: str, interval: str) -> List[Dict]:
        """ä»Binance APIè·å–å†å²Kçº¿"""
        pass

    def load_btc_klines(self, interval: str) -> List[Dict]:
        """è·å–BTCå†å²Kçº¿ï¼ˆç”¨äºBTCå› å­ï¼‰"""
        pass

    def get_funding_rate_history(self, symbol: str) -> List[Dict]:
        """è·å–å†å²èµ„é‡‘è´¹ç‡"""
        pass

    def get_oi_history(self, symbol: str) -> List[Dict]:
        """è·å–å†å²æŒä»“é‡"""
        pass
```

**å·¥ä½œé‡**: 0.5å¤©

### 2. å›æµ‹å¼•æ“ (ä¼˜å…ˆçº§: é«˜)

**æ–‡ä»¶**: `ats_core/backtest/engine.py`

**åŠŸèƒ½**:
```python
class BacktestEngine:
    def __init__(
        self,
        start_date: str,
        end_date: str,
        symbols: List[str],
        params: dict
    ):
        self.data_loader = HistoricalDataLoader(start_date, end_date)
        self.params = params
        self.signals = []

    def run(self) -> List[Signal]:
        """æ‰§è¡Œå›æµ‹"""
        for symbol in self.symbols:
            for timestamp in self.date_range():
                # 1. åŠ è½½å†å²æ•°æ®
                klines = self.data_loader.load_klines(symbol, '1h')
                btc_klines = self.data_loader.load_btc_klines('1h')

                # 2. è®¡ç®—å› å­
                result = analyze_symbol(symbol, klines, ...)

                # 3. è°ƒç”¨å››æ­¥ç³»ç»Ÿ
                four_step_result = run_four_step_decision(...)

                # 4. å¦‚æœACCEPTï¼Œè®°å½•ä¿¡å·
                if four_step_result['decision'] == 'ACCEPT':
                    signal = self.create_signal(four_step_result, timestamp)
                    self.signals.append(signal)

        return self.signals

    def evaluate_signal(self, signal: Signal) -> SignalOutcome:
        """è¯„ä¼°ä¿¡å·ç»“æœï¼ˆä½¿ç”¨æœªæ¥æ•°æ®ï¼‰"""
        # è·Ÿè¸ªä»·æ ¼æ˜¯å¦è§¦åŠEntry/SL/TP
        pass
```

**å·¥ä½œé‡**: 1-1.5å¤©

### 3. æ€§èƒ½è¯„ä¼°å™¨ (ä¼˜å…ˆçº§: é«˜)

**æ–‡ä»¶**: `ats_core/backtest/metrics.py`

**åŠŸèƒ½**:
```python
class BacktestMetrics:
    def __init__(self, signals: List[Signal]):
        self.signals = signals

    # åŸºç¡€æŒ‡æ ‡
    def total_signals(self) -> int
    def win_rate(self) -> float
    def avg_risk_reward(self) -> float
    def profit_factor(self) -> float

    # å››æ­¥ç³»ç»ŸæŒ‡æ ‡
    def step_pass_rates(self) -> dict
    def rejection_distribution(self) -> dict
    def timing_quality_distribution(self) -> dict

    # é£é™©æŒ‡æ ‡
    def max_drawdown(self) -> float
    def sharpe_ratio(self, risk_free_rate=0.02) -> float

    # æŠ¥å‘Šç”Ÿæˆ
    def generate_report(self) -> str
    def export_to_json(self, path: str)
```

**å·¥ä½œé‡**: 0.5-1å¤©

### 4. å¯è§†åŒ–æ¨¡å— (ä¼˜å…ˆçº§: ä¸­)

**æ–‡ä»¶**: `ats_core/backtest/visualization.py`

**åŠŸèƒ½**:
```python
class BacktestVisualizer:
    def plot_equity_curve(self, signals)
    def plot_drawdown(self, signals)
    def plot_step_funnel(self, metrics)
    def plot_rr_distribution(self, signals)
    def generate_html_report(self, metrics, output_path)
```

**å·¥ä½œé‡**: 1å¤©

### 5. å›æµ‹è„šæœ¬ (ä¼˜å…ˆçº§: é«˜)

**æ–‡ä»¶**: `scripts/backtest_four_step.py`

**åŠŸèƒ½**:
```python
#!/usr/bin/env python3
"""
å››æ­¥å†³ç­–ç³»ç»Ÿå›æµ‹è„šæœ¬

Usage:
    python scripts/backtest_four_step.py --start 2024-01-01 --end 2024-11-18 --top 50
"""

import argparse
from ats_core.backtest.engine import BacktestEngine
from ats_core.backtest.metrics import BacktestMetrics
from ats_core.backtest.visualization import BacktestVisualizer

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--start', required=True)
    parser.add_argument('--end', required=True)
    parser.add_argument('--top', type=int, default=50)
    args = parser.parse_args()

    # 1. æ‰§è¡Œå›æµ‹
    engine = BacktestEngine(args.start, args.end, get_top_symbols(args.top))
    signals = engine.run()

    # 2. è®¡ç®—æŒ‡æ ‡
    metrics = BacktestMetrics(signals)

    # 3. ç”ŸæˆæŠ¥å‘Š
    print(metrics.generate_report())

    # 4. å¯è§†åŒ–
    viz = BacktestVisualizer()
    viz.generate_html_report(metrics, 'backtest_report.html')

if __name__ == '__main__':
    main()
```

**å·¥ä½œé‡**: 0.5å¤©

---

## ğŸ“Š æ€»ç»“ä¸å»ºè®®

### å½“å‰çŠ¶æ€è¯„ä¼°

| ç±»åˆ« | çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|------|------|--------|------|
| å››æ­¥å†³ç­–ç³»ç»Ÿ | âœ… å®Œæ•´ | 100% | å·²éªŒè¯ |
| æ•°æ®é‡‡é›†åŸºç¡€è®¾æ–½ | âœ… å­˜åœ¨ | 100% | TradeRecorder + AnalysisDB |
| å†å²æ•°æ®API | âœ… å¯ç”¨ | 100% | Binance API |
| å› å­è®¡ç®—Pipeline | âœ… å®Œæ•´ | 100% | analyze_symbol |
| å›æµ‹æ¡†æ¶ | âŒ ç¼ºå¤± | 0% | **éœ€è¦å¼€å‘** |
| æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ | âš ï¸ ä¸å®Œæ•´ | 30% | æ•°æ®åº“æœ‰åŸºç¡€å­—æ®µ |
| å¯è§†åŒ–å·¥å…· | âŒ ç¼ºå¤± | 0% | **éœ€è¦å¼€å‘** |

**æ€»ä½“å‡†å¤‡åº¦**: **75%** - åŸºç¡€æ¡ä»¶æ»¡è¶³ï¼Œéœ€è¦å¼€å‘å›æµ‹æ¡†æ¶

### ç«‹å³å¯æ‰§è¡Œçš„å·¥ä½œ

#### é€‰é¡¹A: åˆ©ç”¨ç°æœ‰æ•°æ® (æœ€å¿« - 0.5å¤©)

**ç«‹å³æ‰§è¡Œ**:
```bash
# 1. åˆ†æå·²é‡‡é›†çš„80ä¸ªå†å²ä¿¡å·
python scripts/analyze_historical_signals.py

# 2. è·Ÿè¸ªè¿™80ä¸ªä¿¡å·çš„å®é™…ç»“æœ
# æŸ¥è¯¢å½“å‰ä»·æ ¼ï¼Œè®¡ç®—ç›ˆäº
```

**ä¼˜ç‚¹**:
- æ— éœ€å¼€å‘å›æµ‹æ¡†æ¶
- ä½¿ç”¨çœŸå®ç”Ÿäº§æ•°æ®
- ç«‹å³å¯è§ç»“æœ

**ç¼ºç‚¹**: æ•°æ®é‡å°‘ï¼ˆ80ä¸ªï¼‰ï¼Œç»Ÿè®¡æ„ä¹‰æœ‰é™

#### é€‰é¡¹B: å¼€å‘ç®€æ˜“å›æµ‹æ¡†æ¶ (æ¨è - 2-3å¤©)â­

**æ‰§è¡Œè®¡åˆ’**:
1. **Day 1**: å¼€å‘æ ¸å¿ƒæ¨¡å—
   - HistoricalDataLoader (0.5å¤©)
   - BacktestEngineåŸºç¡€ç‰ˆ (0.5å¤©)

2. **Day 2**: å¼€å‘è¯„ä¼°æ¨¡å—
   - BacktestMetrics (0.5å¤©)
   - å›æµ‹è„šæœ¬ (0.5å¤©)

3. **Day 3**: æ‰§è¡Œå›æµ‹ + åˆ†æ
   - è¿è¡Œå›æµ‹ï¼ˆæœ€è¿‘3ä¸ªæœˆï¼ŒTop 50ï¼‰
   - ç”Ÿæˆåˆæ­¥æŠ¥å‘Š
   - è¯†åˆ«é—®é¢˜å¹¶è°ƒä¼˜

**é¢„æœŸäº§å‡º**:
- âœ… å¯å¤ç”¨çš„å›æµ‹æ¡†æ¶
- âœ… åˆæ­¥æ€§èƒ½æ•°æ®
- âœ… å‘ç°å¹¶ä¿®å¤é—®é¢˜

#### é€‰é¡¹C: å®Œæ•´å›æµ‹ç³»ç»Ÿ (å…¨é¢ - 1-2å‘¨)

**é€‚ç”¨åœºæ™¯**: éœ€è¦æ·±åº¦éªŒè¯å’Œé•¿æœŸä½¿ç”¨å›æµ‹ç³»ç»Ÿ

**å¼€å‘å†…å®¹**:
- å®Œæ•´çš„å›æµ‹å¼•æ“
- å…¨é¢çš„æ€§èƒ½æŒ‡æ ‡
- å¯è§†åŒ–å·¥å…·
- HTMLæŠ¥å‘Šç”Ÿæˆ

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

### æ¨èæ‰§è¡Œè·¯å¾„: é€‰é¡¹Bï¼ˆç®€æ˜“å›æµ‹æ¡†æ¶ï¼‰â­

**ç†ç”±**:
1. **å¹³è¡¡é€Ÿåº¦ä¸è´¨é‡**: 2-3å¤©å¯å®Œæˆï¼Œè·å¾—æœ‰æ„ä¹‰çš„ç»“æœ
2. **å¯å¤ç”¨**: æ¡†æ¶å¯ç”¨äºåç»­å‚æ•°è°ƒä¼˜
3. **éªŒè¯æ ¸å¿ƒåŠŸèƒ½**: é‡ç‚¹éªŒè¯å››æ­¥ç³»ç»Ÿæ€§èƒ½
4. **å¿«é€Ÿè¿­ä»£**: å‘ç°é—®é¢˜å¯ç«‹å³è°ƒæ•´

**æ‰§è¡Œæ—¶é—´è¡¨**:
- **Week 1**: å¼€å‘å›æµ‹æ¡†æ¶ï¼ˆ2-3å¤©ï¼‰
- **Week 1**: æ‰§è¡Œå›æµ‹ + ç”ŸæˆæŠ¥å‘Šï¼ˆ1å¤©ï¼‰
- **Week 2**: åˆ†æç»“æœ + å‚æ•°ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

### å…³é”®æˆåŠŸå› ç´ 

1. **æ•°æ®è´¨é‡**:
   - âœ… Binance APIæ•°æ®å¯é 
   - âš ï¸ è®¢å•ç°¿å†å²æ•°æ®ç¼ºå¤±ï¼ˆå¯æ¥å—ï¼‰

2. **è®¡ç®—æ•ˆç‡**:
   - é¢„è®¡100ä¸ªå¸ç§ Ã— 90å¤© Ã— 24å°æ—¶ = 216,000ä¸ªæ—¶é—´ç‚¹
   - éœ€è¦ä¼˜åŒ–: æ‰¹é‡æ•°æ®åŠ è½½ã€å¹¶è¡Œè®¡ç®—

3. **ç»“æœéªŒè¯**:
   - ä¸ç”Ÿäº§ç¯å¢ƒ80ä¸ªä¿¡å·å¯¹æ¯”
   - ä¸æ—§ç³»ç»Ÿæ€§èƒ½å¯¹æ¯”
   - äººå·¥æŠ½æŸ¥éƒ¨åˆ†ä¿¡å·åˆç†æ€§

---

## ğŸ“‹ å¾…åŠäº‹é¡¹æ¸…å•

### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

- [ ] **Day 1**: å¼€å‘ `HistoricalDataLoader`
  - [ ] Binanceå†å²Kçº¿è·å–
  - [ ] BTCæ•°æ®è·å–
  - [ ] èµ„é‡‘è´¹ç‡/æŒä»“é‡è·å–

- [ ] **Day 2**: å¼€å‘ `BacktestEngine`
  - [ ] æ—¶é—´å¾ªç¯é€»è¾‘
  - [ ] å› å­è®¡ç®—è°ƒç”¨
  - [ ] å››æ­¥ç³»ç»Ÿé›†æˆ
  - [ ] ä¿¡å·è®°å½•

- [ ] **Day 2**: å¼€å‘ `BacktestMetrics`
  - [ ] åŸºç¡€æŒ‡æ ‡ï¼ˆèƒœç‡ã€èµ”ç‡ï¼‰
  - [ ] å››æ­¥ç³»ç»ŸæŒ‡æ ‡ï¼ˆé€šè¿‡ç‡ã€æ‹’ç»åˆ†å¸ƒï¼‰
  - [ ] æŠ¥å‘Šç”Ÿæˆ

- [ ] **Day 3**: åˆ›å»ºå›æµ‹è„šæœ¬
  - [ ] CLIå‚æ•°è§£æ
  - [ ] å›æµ‹æ‰§è¡Œ
  - [ ] ç»“æœè¾“å‡º

- [ ] **Day 3**: æ‰§è¡Œé¦–æ¬¡å›æµ‹
  - [ ] æœ€è¿‘3ä¸ªæœˆ
  - [ ] Top 50å¸ç§
  - [ ] ç”Ÿæˆåˆæ­¥æŠ¥å‘Š

### çŸ­æœŸä¼˜åŒ–ï¼ˆä¸‹å‘¨ï¼‰

- [ ] åˆ†æå›æµ‹ç»“æœï¼Œè¯†åˆ«é—®é¢˜
- [ ] è°ƒä¼˜å››æ­¥ç³»ç»Ÿå‚æ•°
- [ ] å¯¹æ¯”å››æ­¥ç³»ç»Ÿ vs æ—§ç³»ç»Ÿ
- [ ] ç¼–å†™æ€§èƒ½æ”¹è¿›å»ºè®®

### ä¸­é•¿æœŸï¼ˆæœ¬æœˆï¼‰

- [ ] å¼€å‘å¯è§†åŒ–å·¥å…·
- [ ] æ‰©å±•å›æµ‹æ—¶é—´èŒƒå›´ï¼ˆ6-12ä¸ªæœˆï¼‰
- [ ] Walk-forward analysis
- [ ] å‚æ•°æ•æ„Ÿæ€§åˆ†æ

---

**æŠ¥å‘Šå®Œæˆæ—¥æœŸ**: 2025-11-18
**ç»“è®º**: âš ï¸ **åŸºç¡€æ¡ä»¶æ»¡è¶³ï¼ˆ75%ï¼‰ï¼Œéœ€å¼€å‘å›æµ‹æ¡†æ¶ï¼ˆé¢„è®¡2-3å¤©ï¼‰**
**æ¨èè¡ŒåŠ¨**: ç«‹å³å¼€å§‹ç®€æ˜“å›æµ‹æ¡†æ¶å¼€å‘

**ç­¾å**: Claude Code
