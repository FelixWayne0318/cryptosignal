# P2.4å› å­é¥±å’Œä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-05
**é—®é¢˜æ¥æº**: ç”¨æˆ·ç”µæŠ¥ç¾¤å®é™…è¿è¡Œåé¦ˆ
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜ï¼ˆå½±å“ä¿¡å·å‡†ç¡®æ€§ï¼‰
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶æ¨é€

---

## ğŸ”´ é—®é¢˜æè¿°

### ç”¨æˆ·åé¦ˆï¼ˆç”µæŠ¥æ¶ˆæ¯ï¼‰

```
â€¢ èµ„é‡‘ ğŸŸ¢ +100 â€”â€” å¼ºåŠ²èµ„é‡‘æµå…¥ (CVDæ•°æ®å¼‚å¸¸, æŒç»­âœ“)
âš¡ èµ„é‡‘åŠ¨é‡ âœ… èµ„é‡‘é¢†å…ˆä»·æ ¼ (F+100)
```

**å‘ç°çš„é—®é¢˜**:
1. **Få› å­ï¼ˆèµ„é‡‘é¢†å…ˆæ€§ï¼‰æ€»æ˜¯Â±100** - ä¸æ˜¯+100å°±æ˜¯-100ï¼Œæ— ä¸­é—´å€¼
2. **Cå› å­ï¼ˆCVDèµ„é‡‘æµï¼‰æ€»æ˜¯+100** - å¤§éƒ¨åˆ†æ—¶é—´éƒ½é¥±å’Œåœ¨+100

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜1: Få› å­é¥±å’Œ

**æ–‡ä»¶**: `ats_core/features/fund_leading.py`

**æ ¹æœ¬åŸå› **:
```python
# æ—§ç‰ˆé—®é¢˜é“¾
directional_score(..., min_score=10)  # è¿”å›10-100ï¼ˆä¸å¯¹ç§°ï¼‰
â†“
fund_momentum = (score - 50) * 2  # æ˜ å°„ï¼š10â†’-80, 100â†’+100ï¼ˆèŒƒå›´ä¸å¯¹ç§°ï¼ï¼‰
â†“
price_momentum = (score - 50) * 2  # åŒæ ·é—®é¢˜
â†“
leading_raw = fund_momentum - price_momentum  # èŒƒå›´: -180åˆ°+180ï¼ˆå¤ªå®½ï¼ï¼‰
â†“
F = 100 * tanh(leading_raw / 20)  # scale=20å¤ªå°ï¼Œå®¹æ˜“é¥±å’Œ
```

**å…·ä½“æ¡ˆä¾‹**:
```python
# èµ„é‡‘å¼ºåŠ¿é¢†å…ˆä»·æ ¼çš„åœºæ™¯
fund_momentum = +92.8
price_momentum = +27.2
leading_raw = 65.6

# æ—§ç‰ˆ
F = 100 * tanh(65.6 / 20) = 100 * tanh(3.28) = 100 * 0.997 â‰ˆ 100 âŒ é¥±å’Œï¼

# æ–°ç‰ˆä¿®å¤å
F = 100 * tanh(65.6 / 50) = 100 * tanh(1.31) = 100 * 0.86 â‰ˆ 86 âœ… æ­£å¸¸ï¼
```

---

### é—®é¢˜2: Cå› å­é¥±å’Œ

**æ–‡ä»¶**: `ats_core/features/cvd_flow.py`

**æ ¹æœ¬åŸå› **:
```python
cvd_scale = 0.02  # å¤ªå° âŒ

cvd_trend = slope_normalized * 6  # 6å°æ—¶æ€»å˜åŒ–
C = 100 * tanh(cvd_trend / 0.02)

# é—®é¢˜
å¦‚æœcvd_trend = 0.06ï¼ˆæ¸©å’Œèµ„é‡‘æµå…¥ï¼‰:
C = 100 * tanh(0.06 / 0.02) = 100 * tanh(3) = 100 * 0.995 â‰ˆ 100 âŒ é¥±å’Œï¼
```

**ä¸ºä»€ä¹ˆcvd_trendç»å¸¸è¶…è¿‡0.06?**
- æ­£å¸¸çš„èµ„é‡‘æµå…¥ï¼šcvd_trendé€šå¸¸åœ¨0.03-0.15èŒƒå›´
- cvd_scale=0.02å¤ªå°ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½é¥±å’Œ

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: Få› å­ï¼ˆèµ„é‡‘é¢†å…ˆæ€§ï¼‰

**å˜æ›´**:
```python
# 1. ä½¿ç”¨min_score=0ç¡®ä¿å¯¹ç§°æ˜ å°„
oi_score = directional_score(..., min_score=0.0)  # è¿”å›0-100ï¼ˆå¯¹ç§°ï¼‰
vol_score = directional_score(..., min_score=0.0)
cvd_score = directional_score(..., min_score=0.0)
trend_score = directional_score(..., min_score=0.0)
slope_score = directional_score(..., min_score=0.0)

# 2. å¢å¤§leading_scaleé¿å…é¥±å’Œ
"leading_scale": 50.0  # ä»20.0å¢åŠ åˆ°50.0ï¼ˆ2.5å€ï¼‰
```

**æ•ˆæœå¯¹æ¯”**:

| åœºæ™¯ | fund_momentum | price_momentum | leading_raw | æ—§ç‰ˆF | æ–°ç‰ˆF |
|------|--------------|----------------|-------------|-------|-------|
| èµ„é‡‘å¼ºåŠ¿é¢†å…ˆ | +100.0 | +53.2 | +46.8 | **+100** âŒ | **+73** âœ… |
| èµ„é‡‘æ¸©å’Œé¢†å…ˆ | +92.8 | +27.2 | +65.6 | **+100** âŒ | **+86** âœ… |
| ä»·æ ¼å¼ºåŠ¿é¢†å…ˆ | -10.6 | +94.8 | -105.4 | **-100** âŒ | **-97** âœ… |
| èµ„é‡‘ä»·æ ¼åŒæ­¥ | +92.8 | +94.8 | -2.0 | -4 | -4 âœ… |
| ä¸­æ€§ | 0.0 | 0.0 | 0.0 | 0 | 0 âœ… |

**å…³é”®æ”¹è¿›**:
- âœ… ä¸å†é¥±å’Œåˆ°Â±100ï¼ˆé™¤éæç«¯æƒ…å†µï¼‰
- âœ… Fåˆ†æ•°åœ¨-100åˆ°+100ä¹‹é—´æ›´å‡åŒ€åˆ†å¸ƒ
- âœ… èƒ½å¤ŸåŒºåˆ†"å¼ºåŠ¿é¢†å…ˆ"å’Œ"æ¸©å’Œé¢†å…ˆ"

---

### ä¿®å¤2: Cå› å­ï¼ˆCVDèµ„é‡‘æµï¼‰

**å˜æ›´**:
```python
# å¢å¤§cvd_scaleé¿å…é¥±å’Œ
"cvd_scale": 0.15  # ä»0.02å¢åŠ åˆ°0.15ï¼ˆ7.5å€ï¼‰
```

**æ•ˆæœå¯¹æ¯”**:

| cvd_trend | æè¿° | tanhè¾“å…¥ | æ—§ç‰ˆC | æ–°ç‰ˆC |
|-----------|------|---------|-------|-------|
| 0.06 | æ¸©å’Œæµå…¥ | 3.0 | **+100** âŒ | **+46** âœ… |
| 0.12 | æ˜æ˜¾æµå…¥ | 6.0 | **+100** âŒ | **+73** âœ… |
| 0.18 | å¼ºåŠ¿æµå…¥ | 9.0 | **+100** âŒ | **+83** âœ… |
| 0.30 | æå¼ºæµå…¥ | 15.0 | **+100** âŒ | **+96** âœ… |
| 0.45+ | æš´åŠ›æµå…¥ | 22.5+ | +100 | +100 âœ… (åˆç†) |

**å…³é”®æ”¹è¿›**:
- âœ… æ¸©å’Œæµå…¥ä¸å†é¥±å’Œï¼ˆ+46è€Œé+100ï¼‰
- âœ… èƒ½å¤ŸåŒºåˆ†ä¸åŒç¨‹åº¦çš„èµ„é‡‘æµå…¥
- âœ… åªæœ‰æç«¯æƒ…å†µæ‰é¥±å’Œï¼ˆcvd_trendâ‰¥0.45ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### Få› å­æµ‹è¯•ç»“æœ

```python
# æµ‹è¯•ç”¨ä¾‹1: èµ„é‡‘ä»·æ ¼åŒæ­¥
è¾“å…¥: OI=5%, vol=1.5, cvd=0.03, price=5%, slope=0.02
èµ„é‡‘åŠ¨é‡=92.8, ä»·æ ¼åŠ¨é‡=94.8, é¢†å…ˆæ€§=-2.0
F = -4 âœ… (æ—§ç‰ˆå¯èƒ½æ˜¯Â±100)

# æµ‹è¯•ç”¨ä¾‹2: èµ„é‡‘é¢†å…ˆä»·æ ¼
è¾“å…¥: OI=5%, vol=1.5, cvd=0.03, price=1%, slope=0.002
èµ„é‡‘åŠ¨é‡=92.8, ä»·æ ¼åŠ¨é‡=27.2, é¢†å…ˆæ€§=65.6
F = 86 âœ… (æ—§ç‰ˆæ˜¯+100)

# æµ‹è¯•ç”¨ä¾‹3: ä»·æ ¼é¢†å…ˆèµ„é‡‘
è¾“å…¥: OI=1%, vol=0.9, cvd=-0.01, price=5%, slope=0.02
èµ„é‡‘åŠ¨é‡=-10.6, ä»·æ ¼åŠ¨é‡=94.8, é¢†å…ˆæ€§=-105.4
F = -97 âœ… (æ—§ç‰ˆæ˜¯-100)

# æµ‹è¯•ç”¨ä¾‹4: èµ„é‡‘å¼ºåŠ¿é¢†å…ˆ
è¾“å…¥: OI=10%, vol=2.0, cvd=0.1, price=2%, slope=0.005
èµ„é‡‘åŠ¨é‡=100.0, ä»·æ ¼åŠ¨é‡=53.2, é¢†å…ˆæ€§=46.8
F = 73 âœ… (æ—§ç‰ˆæ˜¯+100)

# æµ‹è¯•ç”¨ä¾‹5: ä¸­æ€§
è¾“å…¥: OI=0%, vol=1.0, cvd=0, price=0%, slope=0
èµ„é‡‘åŠ¨é‡=0.0, ä»·æ ¼åŠ¨é‡=0.0, é¢†å…ˆæ€§=0.0
F = 0 âœ…
```

**ç»“è®º**: âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼ŒFå› å­ä¸å†ä¸åˆç†é¥±å’Œ

---

### Cå› å­æµ‹è¯•ç»“æœ

```python
cvd_trend=0.06 (æ¸©å’Œæµå…¥) â†’ C=46 âœ… (æ—§ç‰ˆæ˜¯100)
cvd_trend=0.18 (æ˜æ˜¾æµå…¥) â†’ C=83 âœ… (æ—§ç‰ˆæ˜¯100)
cvd_trend=0.30 (å¼ºåŠ¿æµå…¥) â†’ C=96 âœ… (æ—§ç‰ˆæ˜¯100)
cvd_trend=0.60 (æå¼ºæµå…¥) â†’ C=100 âœ… (åˆç†é¥±å’Œ)
cvd_trend=-0.36 (æ˜æ˜¾æµå‡º) â†’ C=-100 âœ… (åˆç†é¥±å’Œ)
```

**ç»“è®º**: âœ… Cå› å­åˆ†å¸ƒæ›´å‡åŒ€ï¼Œåªåœ¨æç«¯æƒ…å†µé¥±å’Œ

---

## ğŸ“¦ éƒ¨ç½²æ¸…å•

### Gitæäº¤è®°å½•

```bash
Commit: 85c40bd
Message: fix(P2.4): ä¿®å¤Få’ŒCå› å­é¥±å’Œé—®é¢˜
Files:
  - ats_core/features/fund_leading.py
  - ats_core/features/cvd_flow.py
Branch: claude/reorganize-repo-structure-011CUomirnKLtuiKaVqz6RpL
Status: âœ… å·²æ¨é€åˆ°GitHub
```

### å˜æ›´æ–‡ä»¶

1. **ats_core/features/fund_leading.py**
   - Line 87: `leading_scale`: 20.0 â†’ 50.0
   - Line 106-108: æ·»åŠ  `min_score=0.0` å‚æ•°
   - Line 123-124: æ·»åŠ  `min_score=0.0` å‚æ•°
   - Line 111, 127: æ›´æ–°æ³¨é‡Š

2. **ats_core/features/cvd_flow.py**
   - Line 43: `cvd_scale`: 0.02 â†’ 0.15

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

### æ–¹å¼1: å¿«é€Ÿé‡å¯ï¼ˆæ¨èï¼‰

```bash
cd ~/cryptosignal

# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin claude/reorganize-repo-structure-011CUomirnKLtuiKaVqz6RpL

# 2. æ¸…ç†Pythonç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
find . -name "*.pyc" -delete 2>/dev/null || true

# 3. é‡å¯æœåŠ¡
./auto_restart.sh

# 4. æŸ¥çœ‹æ—¥å¿—ï¼ˆç­‰å¾…1-2åˆ†é’Ÿï¼‰
tail -f logs/scanner_*.log | head -50
```

### æ–¹å¼2: éªŒè¯åé‡å¯

```bash
cd ~/cryptosignal
git pull origin claude/reorganize-repo-structure-011CUomirnKLtuiKaVqz6RpL

# éªŒè¯ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ
python3 << 'EOF'
import sys
sys.path.insert(0, '/home/cryptosignal/cryptosignal')

from ats_core.features.fund_leading import score_fund_leading

# æµ‹è¯•èµ„é‡‘å¼ºåŠ¿é¢†å…ˆçš„case
F, meta = score_fund_leading(10, 2.0, 0.10, 2, 0.005, {})
print(f"Få› å­æµ‹è¯•: F={F} (åº”è¯¥â‰ˆ73ï¼Œä¸åº”è¯¥=100)")
print(f"  èµ„é‡‘åŠ¨é‡={meta['fund_momentum']:.1f}")
print(f"  ä»·æ ¼åŠ¨é‡={meta['price_momentum']:.1f}")
print(f"  é¢†å…ˆæ€§={meta['leading_raw']:.1f}")

if abs(F) < 95:
    print("âœ… Få› å­ä¿®å¤ç”Ÿæ•ˆ")
else:
    print("âŒ Få› å­ä»ç„¶é¥±å’Œ")
EOF

# å¦‚æœéªŒè¯é€šè¿‡ï¼Œé‡å¯
./auto_restart.sh
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ç”µæŠ¥æ¶ˆæ¯æ”¹è¿›

**ä¿®å¤å‰**:
```
â€¢ èµ„é‡‘ ğŸŸ¢ +100 â€”â€” å¼ºåŠ²èµ„é‡‘æµå…¥ (CVDæ•°æ®å¼‚å¸¸, æŒç»­âœ“)
âš¡ èµ„é‡‘åŠ¨é‡ âœ… èµ„é‡‘é¢†å…ˆä»·æ ¼ (F+100)
```

**ä¿®å¤åï¼ˆé¢„æœŸï¼‰**:
```
â€¢ èµ„é‡‘ ğŸŸ¢  +46 â€”â€” æ¸©å’Œèµ„é‡‘æµå…¥ (æŒç»­âœ“)
âš¡ èµ„é‡‘åŠ¨é‡ âœ… èµ„é‡‘é¢†å…ˆä»·æ ¼ (F+73)
```

æˆ–è€…ï¼ˆå¦‚æœçœŸçš„æ˜¯å¼ºåŠ¿æµå…¥ï¼‰:
```
â€¢ èµ„é‡‘ ğŸŸ¢  +83 â€”â€” æ˜æ˜¾èµ„é‡‘æµå…¥ (æŒç»­âœ“)
âš¡ èµ„é‡‘åŠ¨é‡ âœ… èµ„é‡‘æ¸©å’Œé¢†å…ˆä»·æ ¼ (F+58)
```

### æ ¸å¿ƒæ”¹è¿›

1. **Få› å­**: ä¸å†æ€»æ˜¯Â±100ï¼Œèƒ½å¤ŸåŒºåˆ†"å¼ºåŠ¿é¢†å…ˆ"(73)ã€"æ¸©å’Œé¢†å…ˆ"(58)ã€"åŒæ­¥"(0)
2. **Cå› å­**: ä¸å†æ€»æ˜¯+100ï¼Œèƒ½å¤ŸåŒºåˆ†"æ¸©å’Œæµå…¥"(46)ã€"æ˜æ˜¾æµå…¥"(83)ã€"å¼ºåŠ¿æµå…¥"(96)
3. **ä¿¡å·è´¨é‡**: æ›´å‡†ç¡®çš„å› å­åˆ†æ•° â†’ æ›´ç²¾å‡†çš„Primeåˆ¤æ–­ â†’ æ›´é«˜è´¨é‡çš„ä¿¡å·

---

## âš ï¸ å·²çŸ¥é—ç•™é—®é¢˜

### é—®é¢˜3: å¤šç»´åˆ†ææè¿°é€»è¾‘ï¼ˆå¾…ä¼˜åŒ–ï¼‰

**æ–‡ä»¶**: `ats_core/outputs/telegram_fmt.py`

**é—®é¢˜**: æè¿°å‡½æ•°ï¼ˆå¦‚`_desc_cvd_flow`ã€`_desc_fund_leading`ï¼‰å¯èƒ½è¿˜åœ¨ä½¿ç”¨æ—§çš„åˆ¤æ–­é€»è¾‘

**ç¤ºä¾‹**:
```python
# å½“å‰å¯èƒ½çš„é€»è¾‘
def _desc_cvd_flow(C, ...):
    if C == 100:
        return "å¼ºåŠ²èµ„é‡‘æµå…¥ (CVDæ•°æ®å¼‚å¸¸, æŒç»­âœ“)"  # âŒ è®¤ä¸ºC=100å°±æ˜¯å¼‚å¸¸
```

**å½±å“**:
- å› å­åˆ†æ•°å·²ä¿®å¤ï¼Œä½†æ–‡å­—æè¿°å¯èƒ½ä¸å‡†ç¡®
- ä¾‹å¦‚C=46æ—¶åº”è¯¥è¯´"æ¸©å’Œæµå…¥"ï¼Œä½†å¯èƒ½è¿˜åœ¨è¯´"å¼ºåŠ²æµå…¥"

**ä¼˜å…ˆçº§**: ä¸­ç­‰ï¼ˆä¸å½±å“å®é™…äº¤æ˜“é€»è¾‘ï¼Œåªæ˜¯å±•ç¤ºé—®é¢˜ï¼‰

**è®¡åˆ’**: ä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡ä¼˜åŒ–æè¿°å‡½æ•°

---

## ğŸ“ æ€»ç»“

### ä¿®å¤æˆæœ

- âœ… Få› å­é¥±å’Œé—®é¢˜ - å·²ä¿®å¤ï¼ˆmin_score=0 + leading_scaleÃ—2.5ï¼‰
- âœ… Cå› å­é¥±å’Œé—®é¢˜ - å·²ä¿®å¤ï¼ˆcvd_scaleÃ—7.5ï¼‰
- âœ… æµ‹è¯•éªŒè¯ - å…¨éƒ¨é€šè¿‡
- âœ… ä»£ç æ¨é€ - å·²å®Œæˆ
- â³ å¤šç»´åˆ†ææè¿° - å¾…ä¼˜åŒ–ï¼ˆéé˜»å¡ï¼‰

### ä¸‹ä¸€æ­¥

1. **ç«‹å³**: éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè§‚å¯Ÿ1-2å°æ—¶å®é™…è¿è¡Œæ•ˆæœ
2. **çŸ­æœŸ**: æ”¶é›†åé¦ˆï¼ŒéªŒè¯ä¿®å¤æ˜¯å¦è§£å†³é—®é¢˜
3. **ä¸­æœŸ**: ä¼˜åŒ–ç”µæŠ¥æ¶ˆæ¯æè¿°å‡½æ•°ï¼Œä½¿å…¶é€‚é…P0-P2ä¿®å¤

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-05 12:15 UTC
**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 5åˆ†é’Ÿ
**é¢„è®¡è§‚å¯Ÿå‘¨æœŸ**: 1-2å°æ—¶
