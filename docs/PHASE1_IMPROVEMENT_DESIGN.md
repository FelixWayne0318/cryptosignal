# ç¬¬ä¸€é˜¶æ®µæ”¹è¿›æ–¹æ¡ˆ - è¯¦ç»†è®¾è®¡æ–‡æ¡£

**è®¾è®¡æ—¥æœŸ**: 2025-11-16
**ç‰ˆæœ¬**: v7.3.47
**ç›®æ ‡**: ç«‹å³æ”¹å–„ä¿¡å·æ»åé—®é¢˜ï¼ˆ30-40%æ”¹å–„ï¼‰
**é£é™©ç­‰çº§**: ğŸŸ¢ ä½é£é™©
**é¢„ä¼°å·¥æ—¶**: 8å°æ—¶

---

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

### æ”¹è¿›ç›®æ ‡

1. **æ‰©å¤§è“„åŠ¿æ£€æµ‹è¦†ç›–ç‡**: ä»15% â†’ 50-60%
2. **å¢å¼ºFå› å­è°ƒåˆ¶èƒ½åŠ›**: å®ç°TeffåŠ¨æ€è°ƒåˆ¶
3. **é˜²æ­¢è¿½é«˜ä¿¡å·**: æ·»åŠ åè¿½é«˜æƒ©ç½šæœºåˆ¶

### ä¸æ”¹å˜çš„éƒ¨åˆ†ï¼ˆä¿æŒç¨³å®šæ€§ï¼‰

- âœ… **ä¸ä¿®æ”¹æƒé‡åˆ†é…**ï¼ˆT/M/C/V/O/Bæƒé‡ä¿æŒä¸å˜ï¼‰
- âœ… **ä¸ä¿®æ”¹æ ¸å¿ƒæ¶æ„**ï¼ˆAå±‚/Bå±‚åˆ†å±‚ä¿æŒä¸å˜ï¼‰
- âœ… **ä¸ä¿®æ”¹å› å­è®¡ç®—é€»è¾‘**ï¼ˆå„å› å­ç®—æ³•ä¿æŒä¸å˜ï¼‰
- âœ… **å‘åå…¼å®¹**ï¼ˆæ‰€æœ‰å‚æ•°å¯é…ç½®ï¼Œå¯å›æ»šï¼‰

---

## æ–¹æ¡ˆ1: æ‰©å¤§è“„åŠ¿æ£€æµ‹è¦†ç›–ç‡

### ğŸ“ é—®é¢˜ç°çŠ¶

**å½“å‰é€»è¾‘** (`ats_core/pipeline/analyze_symbol.py` Lines 1280-1289):

```python
# å¼ºçƒˆè“„åŠ¿ç‰¹å¾
if F >= 90 and C >= 60 and T < 40:
    is_accumulating = True
    accumulating_reason = f"å¼ºåŠ¿è“„åŠ¿(Fâ‰¥90+Câ‰¥60+T<40)"
    prime_strength_threshold = 35

# æ·±åº¦è“„åŠ¿ç‰¹å¾
elif F >= 85 and C >= 70 and T < 30 and V < 0:
    is_accumulating = True
    accumulating_reason = f"æ·±åº¦è“„åŠ¿(Fâ‰¥85+Câ‰¥70+V<0+T<30)"
    prime_strength_threshold = 38
```

**é—®é¢˜åˆ†æ**:
- âŒ åªè¦†ç›–æç«¯è“„åŠ¿åœºæ™¯ï¼ˆFâ‰¥90æˆ–Fâ‰¥85+V<0ï¼‰
- âŒ ä¸­ç­‰è“„åŠ¿ï¼ˆF=60-89ï¼‰**å®Œå…¨é—æ¼**
- âŒ ä¼°ç®—è¦†ç›–ç‡ï¼šä»…15%

---

### ğŸ¯ æ”¹è¿›è®¾è®¡

#### è®¾è®¡ç†å¿µ

**ä¸‰çº§è“„åŠ¿æ£€æµ‹**ï¼š
- **å¼ºçƒˆè“„åŠ¿**ï¼ˆLv3ï¼‰: Fâ‰¥90 - æœ€ç§¯æ
- **ä¸­ç­‰è“„åŠ¿**ï¼ˆLv2ï¼‰: F=70-89 - é€‚åº¦ç§¯æ â† **æ–°å¢**
- **å¼±è“„åŠ¿**ï¼ˆLv1ï¼‰: F=50-69 - è°¨æ…ç§¯æ â† **æ–°å¢**

#### ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶**: `ats_core/pipeline/analyze_symbol.py`
**ä½ç½®**: Lines 1260-1289 é™„è¿‘
**ä¿®æ”¹ç±»å‹**: æ‰©å±•ç°æœ‰é€»è¾‘

#### ä»£ç è®¾è®¡ï¼ˆä¿®æ”¹åï¼‰

```python
# ---- è“„åŠ¿å¾…å‘æ£€æµ‹ï¼ˆä¸‰çº§æ£€æµ‹ v7.3.48ï¼‰----
is_accumulating = False
accumulating_reason = ""
accumulation_level = 0  # 0=æ— , 1=å¼±, 2=ä¸­ç­‰, 3=å¼ºçƒˆ

# ä»é…ç½®è¯»å–å‚æ•°
acc_cfg = params.get("factor_optimization_v2", {}).get("accumulation_detection", {})
version = acc_cfg.get("version", "v2")

if version == "v3":
    # v3ç‰ˆæœ¬ï¼šä¸‰çº§è“„åŠ¿æ£€æµ‹ï¼ˆæ–°å¢ï¼‰
    v3_cfg = acc_cfg.get("v3", {})

    # Lv3: å¼ºçƒˆè“„åŠ¿
    lv3_cfg = v3_cfg.get("level3_strong", {})
    F_min_lv3 = lv3_cfg.get("F_min", 90)
    C_min_lv3 = lv3_cfg.get("C_min", 60)
    T_max_lv3 = lv3_cfg.get("T_max", 40)
    threshold_lv3 = lv3_cfg.get("strength_threshold", 30)  # é™ä½åˆ°30

    # Lv2: ä¸­ç­‰è“„åŠ¿ï¼ˆæ–°å¢ï¼‰
    lv2_cfg = v3_cfg.get("level2_medium", {})
    F_min_lv2 = lv2_cfg.get("F_min", 70)
    C_min_lv2 = lv2_cfg.get("C_min", 50)
    T_max_lv2 = lv2_cfg.get("T_max", 50)
    M_max_lv2 = lv2_cfg.get("M_max", 40)  # é¿å…å·²åŠ é€Ÿ
    threshold_lv2 = lv2_cfg.get("strength_threshold", 35)

    # Lv1: å¼±è“„åŠ¿ï¼ˆæ–°å¢ï¼‰
    lv1_cfg = v3_cfg.get("level1_weak", {})
    F_min_lv1 = lv1_cfg.get("F_min", 50)
    C_min_lv1 = lv1_cfg.get("C_min", 40)
    T_max_lv1 = lv1_cfg.get("T_max", 60)
    M_max_lv1 = lv1_cfg.get("M_max", 30)
    O_min_lv1 = lv1_cfg.get("O_min", 30)  # éœ€è¦OIç¡®è®¤
    threshold_lv1 = lv1_cfg.get("strength_threshold", 40)

    # æ£€æµ‹é€»è¾‘ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
    if F >= F_min_lv3 and C >= C_min_lv3 and T < T_max_lv3:
        # Lv3: å¼ºçƒˆè“„åŠ¿
        is_accumulating = True
        accumulation_level = 3
        accumulating_reason = f"å¼ºçƒˆè“„åŠ¿(Fâ‰¥{F_min_lv3}+Câ‰¥{C_min_lv3}+T<{T_max_lv3})"
        prime_strength_threshold = threshold_lv3

    elif F >= F_min_lv2 and C >= C_min_lv2 and T < T_max_lv2 and M < M_max_lv2:
        # Lv2: ä¸­ç­‰è“„åŠ¿ï¼ˆæ–°å¢ï¼‰
        is_accumulating = True
        accumulation_level = 2
        accumulating_reason = f"ä¸­ç­‰è“„åŠ¿(Fâ‰¥{F_min_lv2}+Câ‰¥{C_min_lv2}+T<{T_max_lv2}+M<{M_max_lv2})"
        prime_strength_threshold = threshold_lv2

    elif F >= F_min_lv1 and C >= C_min_lv1 and T < T_max_lv1 and M < M_max_lv1 and O >= O_min_lv1:
        # Lv1: å¼±è“„åŠ¿ï¼ˆæ–°å¢ï¼‰
        is_accumulating = True
        accumulation_level = 1
        accumulating_reason = f"å¼±è“„åŠ¿(Fâ‰¥{F_min_lv1}+Câ‰¥{C_min_lv1}+T<{T_max_lv1}+Oâ‰¥{O_min_lv1})"
        prime_strength_threshold = threshold_lv1

else:
    # v2ç‰ˆæœ¬ï¼šä¿æŒç°æœ‰é€»è¾‘ï¼ˆå‘åå…¼å®¹ï¼‰
    v2_cfg = acc_cfg.get("v2", {})
    F_min_strong = v2_cfg.get("F_threshold", 90)
    C_min_strong = v2_cfg.get("C_threshold", 60)
    T_max_strong = v2_cfg.get("T_max", 40)
    strength_threshold_strong = v2_cfg.get("base_position_threshold", 35)

    if F >= F_min_strong and C >= C_min_strong and T < T_max_strong:
        is_accumulating = True
        accumulation_level = 3
        accumulating_reason = f"å¼ºåŠ¿è“„åŠ¿(Fâ‰¥{F_min_strong}+Câ‰¥{C_min_strong}+T<{T_max_strong})"
        prime_strength_threshold = strength_threshold_strong
```

#### é…ç½®å‚æ•°è®¾è®¡

**æ–‡ä»¶**: `config/params.json`
**ä½ç½®**: `factor_optimization_v2.accumulation_detection` èŠ‚ç‚¹
**æ–°å¢é…ç½®**:

```json
{
  "factor_optimization_v2": {
    "accumulation_detection": {
      "version": "v3",  // v2 (ç°æœ‰) | v3 (æ–°å¢ä¸‰çº§æ£€æµ‹)

      "v3": {
        "_comment": "v3: ä¸‰çº§è“„åŠ¿æ£€æµ‹ - æ‰©å¤§è¦†ç›–ç‡",

        "level3_strong": {
          "_comment": "å¼ºçƒˆè“„åŠ¿ï¼šèµ„é‡‘æå¼ºæµå…¥ï¼Œä»·æ ¼æœªæ¶¨",
          "F_min": 90,
          "C_min": 60,
          "T_max": 40,
          "strength_threshold": 30,
          "_rationale": "é™ä½é˜ˆå€¼30åˆ†ï¼ˆåŸ35ï¼‰ï¼Œæ›´ç§¯ææ•æ‰"
        },

        "level2_medium": {
          "_comment": "ä¸­ç­‰è“„åŠ¿ï¼šèµ„é‡‘æŒç»­æµå…¥ï¼Œä»·æ ¼æ¨ªç›˜ï¼ˆæ–°å¢ï¼‰",
          "F_min": 70,
          "C_min": 50,
          "T_max": 50,
          "M_max": 40,
          "strength_threshold": 35,
          "_rationale": "Fâ‰¥70è¦†ç›–æ›´å¤šåœºæ™¯ï¼ŒåŠ å…¥M<40é¿å…å·²åŠ é€Ÿ"
        },

        "level1_weak": {
          "_comment": "å¼±è“„åŠ¿ï¼šèµ„é‡‘æµå…¥ï¼Œéœ€è¦OIç¡®è®¤ï¼ˆæ–°å¢ï¼‰",
          "F_min": 50,
          "C_min": 40,
          "T_max": 60,
          "M_max": 30,
          "O_min": 30,
          "strength_threshold": 40,
          "_rationale": "Fâ‰¥50è¦†ç›–æ—©æœŸè“„åŠ¿ï¼Œè¦æ±‚Oâ‰¥30é¿å…è™šå‡ä¿¡å·"
        }
      },

      "v2": {
        "_comment": "v2: ç°æœ‰é€»è¾‘ï¼ˆå‘åå…¼å®¹ï¼‰",
        "F_threshold": 90,
        "C_threshold": 60,
        "T_max": 40,
        "base_position_threshold": 35
      }
    }
  }
}
```

#### å‚æ•°é€‰æ‹©ç†ç”±

| å‚æ•° | å€¼ | ç†ç”± |
|------|-----|------|
| **Lv3 F_min** | 90 | ä¿æŒç°æœ‰é€»è¾‘ |
| **Lv3 threshold** | 30 | ä»35é™åˆ°30ï¼Œæ›´ç§¯æï¼ˆFâ‰¥90å·²æ˜¯å¼ºä¿¡å·ï¼‰ |
| **Lv2 F_min** | 70 | è¦†ç›–ä¸­ç­‰è“„åŠ¿ï¼ŒF=70-89æ˜¯å¸¸è§èŒƒå›´ |
| **Lv2 M_max** | 40 | é¿å…å·²åŠ é€Ÿåœºæ™¯ï¼ˆM>40è¡¨ç¤ºä»·æ ¼å·²å¿«é€Ÿä¸Šæ¶¨ï¼‰ |
| **Lv1 F_min** | 50 | è¦†ç›–æ—©æœŸè“„åŠ¿ï¼Œä½†éœ€è¦æ›´å¤šç¡®è®¤ |
| **Lv1 O_min** | 30 | OIç¡®è®¤ï¼Œé¿å…CVDè™šå‡ä¿¡å· |
| **Lv1 threshold** | 40 | è¦æ±‚æ›´é«˜ï¼Œå› ä¸ºF=50-69ä¿¡å·è¾ƒå¼± |

#### é¢„æœŸæ•ˆæœ

**è¦†ç›–ç‡æå‡**:
```
å½“å‰è¦†ç›–:
- Fâ‰¥90: 15%åœºæ™¯ âœ…

æ”¹è¿›åè¦†ç›–:
- Fâ‰¥90: 15%åœºæ™¯ âœ… (Lv3)
- F=70-89: 30%åœºæ™¯ âœ… (Lv2, æ–°å¢)
- F=50-69: 15%åœºæ™¯ âœ… (Lv1, æ–°å¢)
æ€»è®¡: 60%åœºæ™¯ âœ…âœ…âœ…
```

**ä¿¡å·è´¨é‡**:
- Lv3ï¼ˆFâ‰¥90ï¼‰: é«˜è´¨é‡ï¼Œæœ€æ¿€è¿›
- Lv2ï¼ˆF=70-89ï¼‰: ä¸­ç­‰è´¨é‡ï¼Œé€‚åº¦ç§¯æ
- Lv1ï¼ˆF=50-69ï¼‰: éœ€è°¨æ…ï¼Œè¦æ±‚æ›´å¤šç¡®è®¤ï¼ˆOIï¼‰

---

## æ–¹æ¡ˆ2: å®ç°Få› å­Teffè°ƒåˆ¶

### ğŸ“ é—®é¢˜ç°çŠ¶

**å½“å‰é€»è¾‘** (`ats_core/modulators/modulator_chain.py` Lines 62-64):

```python
self.Teff_F = 1.0      # Temperature multiplier [0.80, 1.20]
self.p_min_adj = 0.0   # âš ï¸ DEPRECATED v6.7++
```

**é—®é¢˜åˆ†æ**:
- âŒ Teff_Fé»˜è®¤1.0ï¼Œ**æ— å®é™…è°ƒåˆ¶**
- âŒ Få› å­æ— æ³•é€šè¿‡æ¸©åº¦ç³»æ•°å½±å“æŒä»“æ—¶é—´
- âŒ è“„åŠ¿åœºæ™¯æ— æ³•æ›´æ¿€è¿›ï¼Œè¿½é«˜åœºæ™¯æ— æ³•æ›´ä¿å®ˆ

---

### ğŸ¯ æ”¹è¿›è®¾è®¡

#### è®¾è®¡ç†å¿µ

**Teffæ¸©åº¦ç³»æ•°è°ƒåˆ¶é€»è¾‘**:
```
F > 60ï¼ˆè“„åŠ¿ï¼‰  â†’ Teff_F = 1.0~1.20 â†’ æŒä»“æ—¶é—´å»¶é•¿ â†’ æ›´æ¿€è¿›
F = -60~60ï¼ˆä¸­æ€§ï¼‰â†’ Teff_F = 0.85~1.15 â†’ çº¿æ€§è°ƒåˆ¶ â†’ ä¸­æ€§
F < -60ï¼ˆè¿½é«˜ï¼‰  â†’ Teff_F = 0.70~0.85 â†’ æŒä»“æ—¶é—´ç¼©çŸ­ â†’ æ›´ä¿å®ˆ
```

**è°ƒåˆ¶å¼ºåº¦è®¾è®¡**:
- æœ€å¤§æå‡ï¼š+20%ï¼ˆTeff_F=1.20ï¼ŒF=+100æ—¶ï¼‰
- æœ€å¤§é™ä½ï¼š-30%ï¼ˆTeff_F=0.70ï¼ŒF=-100æ—¶ï¼‰
- ä¸­æ€§åŒºé—´ï¼šÂ±15%çº¿æ€§è°ƒåˆ¶

#### ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶**: `ats_core/modulators/modulator_chain.py`
**ä½ç½®**: `_modulate_F` æ–¹æ³•ï¼ˆæ–°å¢ï¼‰æˆ– `modulate_all` æ–¹æ³•å†…
**ä¿®æ”¹ç±»å‹**: æ–°å¢æ–¹æ³• + è°ƒç”¨

#### ä»£ç è®¾è®¡ï¼ˆæ–°å¢æ–¹æ³•ï¼‰

```python
def _modulate_F(self, F_score: float) -> float:
    """
    Få› å­è°ƒåˆ¶Teffæ¸©åº¦ç³»æ•°

    v7.3.48æ–°å¢ï¼šå®ç°Få› å­å¯¹æ¸©åº¦ç³»æ•°çš„è°ƒåˆ¶

    è°ƒåˆ¶é€»è¾‘ï¼š
    - F > 60ï¼ˆè“„åŠ¿ï¼‰: Teff_Få¢åŠ ï¼ŒæŒä»“æ—¶é—´å»¶é•¿ï¼Œæ›´æ¿€è¿›å…¥åœº
    - F < -60ï¼ˆè¿½é«˜ï¼‰: Teff_Fé™ä½ï¼ŒæŒä»“æ—¶é—´ç¼©çŸ­ï¼Œæ›´ä¿å®ˆç¦»åœº
    - Fåœ¨[-60, 60]ï¼ˆä¸­æ€§ï¼‰: çº¿æ€§è°ƒåˆ¶

    Args:
        F_score: Få› å­åˆ†æ•° [-100, +100]

    Returns:
        Teff_F: æ¸©åº¦ç³»æ•°å€æ•° [0.70, 1.20]

    ç¤ºä¾‹ï¼š
        F = +100 â†’ Teff_F = 1.20 â†’ æŒä»“æ—¶é—´Ã—1.20ï¼ˆå¼ºè“„åŠ¿ï¼Œæ›´æ¿€è¿›ï¼‰
        F = 0    â†’ Teff_F = 1.00 â†’ æŒä»“æ—¶é—´ä¸å˜ï¼ˆä¸­æ€§ï¼‰
        F = -100 â†’ Teff_F = 0.70 â†’ æŒä»“æ—¶é—´Ã—0.70ï¼ˆè¿½é«˜ï¼Œå¿«é€Ÿç¦»åœºï¼‰
    """
    # ä»é…ç½®è¯»å–å‚æ•°
    f_modulation_cfg = self.params.get("F_modulation", {})
    enabled = f_modulation_cfg.get("enabled", True)

    if not enabled:
        return 1.0

    # è°ƒåˆ¶å‚æ•°ï¼ˆå¯é…ç½®ï¼‰
    threshold_high = f_modulation_cfg.get("threshold_high", 60.0)   # è“„åŠ¿é˜ˆå€¼
    threshold_low = f_modulation_cfg.get("threshold_low", -60.0)    # è¿½é«˜é˜ˆå€¼
    max_boost = f_modulation_cfg.get("max_boost", 1.20)             # æœ€å¤§æå‡
    max_penalty = f_modulation_cfg.get("max_penalty", 0.70)         # æœ€å¤§æƒ©ç½š

    # ç¡®ä¿F_scoreåœ¨æœ‰æ•ˆèŒƒå›´
    F_score = max(-100.0, min(100.0, F_score))

    if F_score >= threshold_high:
        # è“„åŠ¿åŒºé—´ï¼šF âˆˆ [60, 100]
        # çº¿æ€§æ˜ å°„: F=60 â†’ 1.00, F=100 â†’ 1.20
        ratio = (F_score - threshold_high) / (100.0 - threshold_high)
        Teff_F = 1.0 + ratio * (max_boost - 1.0)

    elif F_score <= threshold_low:
        # è¿½é«˜åŒºé—´ï¼šF âˆˆ [-100, -60]
        # çº¿æ€§æ˜ å°„: F=-60 â†’ 1.00, F=-100 â†’ 0.70
        ratio = (threshold_low - F_score) / (threshold_low - (-100.0))
        Teff_F = 1.0 - ratio * (1.0 - max_penalty)

    else:
        # ä¸­æ€§åŒºé—´ï¼šF âˆˆ [-60, 60]
        # çº¿æ€§æ˜ å°„: F=-60 â†’ 0.85, F=0 â†’ 1.00, F=60 â†’ 1.15
        if F_score >= 0:
            # F âˆˆ [0, 60]
            ratio = F_score / threshold_high
            Teff_F = 1.0 + ratio * 0.15  # æœ€å¤§+15%
        else:
            # F âˆˆ [-60, 0]
            ratio = F_score / threshold_low
            Teff_F = 1.0 - ratio * 0.15  # æœ€å¤§-15%

    # ç¡®ä¿ç»“æœåœ¨åˆç†èŒƒå›´
    Teff_F = max(max_penalty, min(max_boost, Teff_F))

    return Teff_F
```

#### è°ƒç”¨ä½ç½®ä¿®æ”¹

**æ–‡ä»¶**: `ats_core/modulators/modulator_chain.py`
**æ–¹æ³•**: `modulate_all`
**ä½ç½®**: Lines 150é™„è¿‘ï¼ˆF_scoreå¤„ç†åï¼‰

```python
# ä¿®æ”¹å‰ï¼ˆLine 150é™„è¿‘ï¼‰:
self.Teff_F = 1.0  # â† ç¡¬ç¼–ç ä¸º1.0

# ä¿®æ”¹å:
# v7.3.48: ä½¿ç”¨Få› å­è°ƒåˆ¶Teff
self.Teff_F = self._modulate_F(F_score)
```

#### é…ç½®å‚æ•°è®¾è®¡

**æ–‡ä»¶**: `config/params.json`
**æ–°å¢é…ç½®èŠ‚ç‚¹**:

```json
{
  "F_modulation": {
    "_comment": "v7.3.48: Få› å­Teffè°ƒåˆ¶å‚æ•°",
    "enabled": true,
    "threshold_high": 60.0,
    "threshold_low": -60.0,
    "max_boost": 1.20,
    "max_penalty": 0.70,
    "_rationale": "F>60è“„åŠ¿æ—¶å»¶é•¿æŒä»“(Ã—1.20)ï¼ŒF<-60è¿½é«˜æ—¶ç¼©çŸ­æŒä»“(Ã—0.70)"
  }
}
```

#### å‚æ•°é€‰æ‹©ç†ç”±

| å‚æ•° | å€¼ | ç†ç”± |
|------|-----|------|
| **threshold_high** | 60 | Fâ‰¥60è¡¨ç¤ºæ˜æ˜¾è“„åŠ¿ï¼Œå¼€å§‹å¢åŠ æ¿€è¿›åº¦ |
| **threshold_low** | -60 | Fâ‰¤-60è¡¨ç¤ºè¿½é«˜é£é™©ï¼Œå¼€å§‹é™ä½æ¿€è¿›åº¦ |
| **max_boost** | 1.20 | æœ€å¤§æå‡20%ï¼Œä¸è¿‡äºæ¿€è¿› |
| **max_penalty** | 0.70 | æœ€å¤§æƒ©ç½š30%ï¼Œå¿«é€Ÿç¦»åœºä½†ä¸è¿‡åº¦ |

#### é¢„æœŸæ•ˆæœ

**è“„åŠ¿åœºæ™¯**ï¼ˆF=+90ï¼‰:
```
Teff_F = 1.0 + (90-60)/(100-60) Ã— (1.20-1.0)
       = 1.0 + 0.75 Ã— 0.20
       = 1.15

æŒä»“æ—¶é—´å»¶é•¿15% â†’ æ›´æœ‰è€å¿ƒç­‰å¾…çªç ´ âœ…
```

**è¿½é«˜åœºæ™¯**ï¼ˆF=-80ï¼‰:
```
Teff_F = 1.0 - (-60-(-80))/(-60-(-100)) Ã— (1.0-0.70)
       = 1.0 - 20/40 Ã— 0.30
       = 1.0 - 0.15
       = 0.85

æŒä»“æ—¶é—´ç¼©çŸ­15% â†’ å¿«é€Ÿæ­¢æŸç¦»åœº âœ…
```

---

## æ–¹æ¡ˆ3: åè¿½é«˜æ£€æµ‹

### ğŸ“ é—®é¢˜ç°çŠ¶

**å½“å‰é€»è¾‘**: æ— ä¸“é—¨çš„åè¿½é«˜æ£€æµ‹
- ä»…ä¾èµ–è“„åŠ¿æ£€æµ‹ï¼ˆä»…è¦†ç›–F>0åœºæ™¯ï¼‰
- F<0æ—¶æ— ä»»ä½•æƒ©ç½šæœºåˆ¶
- è¿½é«˜åœºæ™¯ï¼ˆTé«˜+Mé«˜+Fä½ï¼‰ä¾ç„¶å¯èƒ½å‘ä¿¡å·

---

### ğŸ¯ æ”¹è¿›è®¾è®¡

#### è®¾è®¡ç†å¿µ

**åè¿½é«˜æƒ©ç½šæœºåˆ¶**:
```
å¦‚æœåŒæ—¶æ»¡è¶³:
1. F < -40ï¼ˆèµ„é‡‘æµå‡ºï¼Œä»·æ ¼é¢†å…ˆï¼‰
2. T > 70 æˆ– M > 70ï¼ˆä»·æ ¼å·²å¤§æ¶¨ï¼‰

åˆ™åˆ¤å®šä¸º"è¿½é«˜é£é™©"ï¼š
- é™ä½prime_strengthï¼ˆä¿¡å·å¼ºåº¦Ã—0.7ï¼‰
- è®°å½•è¿½é«˜åŸå› 
- ä¸ç¡¬æ‹’ç»ï¼Œä½†æé«˜é—¨æ§›
```

**æƒ©ç½šåŠ›åº¦è®¾è®¡**:
- **è½»åº¦è¿½é«˜**ï¼ˆF=-40~-60, T=70-85ï¼‰: å¼ºåº¦Ã—0.85
- **ä¸­åº¦è¿½é«˜**ï¼ˆF=-60~-80, T>85ï¼‰: å¼ºåº¦Ã—0.70
- **é‡åº¦è¿½é«˜**ï¼ˆF<-80, T>90, M>90ï¼‰: å¼ºåº¦Ã—0.50

#### ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶**: `ats_core/pipeline/analyze_symbol.py`
**ä½ç½®**: è“„åŠ¿æ£€æµ‹åï¼ŒPrimeåˆ¤å®šå‰ï¼ˆLines 1290é™„è¿‘ï¼‰
**ä¿®æ”¹ç±»å‹**: æ–°å¢æ£€æµ‹é€»è¾‘

#### ä»£ç è®¾è®¡ï¼ˆæ–°å¢ï¼‰

```python
# ---- åè¿½é«˜æ£€æµ‹ï¼ˆv7.3.48æ–°å¢ï¼‰----
is_chasing = False
chasing_reason = ""
chasing_penalty = 1.0  # é»˜è®¤æ— æƒ©ç½š

# ä»é…ç½®è¯»å–å‚æ•°
anti_chase_cfg = params.get("anti_chase_detection", {})
enabled = anti_chase_cfg.get("enabled", True)

if enabled:
    # ä¸‰çº§è¿½é«˜æ£€æµ‹
    heavy_cfg = anti_chase_cfg.get("heavy_chase", {})
    medium_cfg = anti_chase_cfg.get("medium_chase", {})
    light_cfg = anti_chase_cfg.get("light_chase", {})

    # é‡åº¦è¿½é«˜æ£€æµ‹
    if (F < heavy_cfg.get("F_max", -80) and
        T > heavy_cfg.get("T_min", 90) and
        M > heavy_cfg.get("M_min", 90)):
        is_chasing = True
        chasing_penalty = heavy_cfg.get("penalty", 0.50)
        chasing_reason = f"é‡åº¦è¿½é«˜(F<{heavy_cfg.get('F_max')}+T>{heavy_cfg.get('T_min')}+M>{heavy_cfg.get('M_min')})"

    # ä¸­åº¦è¿½é«˜æ£€æµ‹
    elif (F < medium_cfg.get("F_max", -60) and
          (T > medium_cfg.get("T_min", 85) or M > medium_cfg.get("M_min", 80))):
        is_chasing = True
        chasing_penalty = medium_cfg.get("penalty", 0.70)
        chasing_reason = f"ä¸­åº¦è¿½é«˜(F<{medium_cfg.get('F_max')}+T>{medium_cfg.get('T_min')}/M>{medium_cfg.get('M_min')})"

    # è½»åº¦è¿½é«˜æ£€æµ‹
    elif (F < light_cfg.get("F_max", -40) and
          (T > light_cfg.get("T_min", 70) or M > light_cfg.get("M_min", 70))):
        is_chasing = True
        chasing_penalty = light_cfg.get("penalty", 0.85)
        chasing_reason = f"è½»åº¦è¿½é«˜(F<{light_cfg.get('F_max')}+T>{light_cfg.get('T_min')}/M>{light_cfg.get('M_min')})"

# ---- Primeåˆ¤å®šï¼ˆåº”ç”¨è“„åŠ¿æå‡æˆ–è¿½é«˜æƒ©ç½šï¼‰----
# ... ç°æœ‰ä»£ç  ...
# è®¡ç®—base_prime_strengthåï¼š

# åº”ç”¨è°ƒæ•´
if is_accumulating:
    # è“„åŠ¿åœºæ™¯ï¼šé™ä½é˜ˆå€¼ï¼ˆå·²æœ‰é€»è¾‘ï¼‰
    adjusted_threshold = prime_strength_threshold
    adjustment_reason = accumulating_reason
elif is_chasing:
    # è¿½é«˜åœºæ™¯ï¼šé™ä½å¼ºåº¦ï¼ˆæ–°å¢é€»è¾‘ï¼‰
    prime_strength = prime_strength * chasing_penalty
    adjusted_threshold = prime_strength_threshold  # é˜ˆå€¼ä¸å˜
    adjustment_reason = chasing_reason
else:
    # æ­£å¸¸åœºæ™¯
    adjusted_threshold = prime_strength_threshold
    adjustment_reason = "æ­£å¸¸è¯„åˆ†"

# Primeåˆ¤å®š
is_prime = (prime_strength >= adjusted_threshold) and (P_chosen >= p_min_adjusted)
```

#### é…ç½®å‚æ•°è®¾è®¡

**æ–‡ä»¶**: `config/params.json`
**æ–°å¢é…ç½®èŠ‚ç‚¹**:

```json
{
  "anti_chase_detection": {
    "_comment": "v7.3.48: åè¿½é«˜æ£€æµ‹ - é˜²æ­¢è¿½æ¶¨æ€è·Œ",
    "enabled": true,

    "heavy_chase": {
      "_comment": "é‡åº¦è¿½é«˜ï¼šä»·æ ¼æš´æ¶¨ä¸”èµ„é‡‘å¤§é‡æµå‡º",
      "F_max": -80,
      "T_min": 90,
      "M_min": 90,
      "penalty": 0.50,
      "_effect": "ä¿¡å·å¼ºåº¦Ã—0.50ï¼ˆä¸¥å‰æƒ©ç½šï¼‰"
    },

    "medium_chase": {
      "_comment": "ä¸­åº¦è¿½é«˜ï¼šä»·æ ¼å¤§æ¶¨ä¸”èµ„é‡‘æµå‡º",
      "F_max": -60,
      "T_min": 85,
      "M_min": 80,
      "penalty": 0.70,
      "_effect": "ä¿¡å·å¼ºåº¦Ã—0.70ï¼ˆä¸­åº¦æƒ©ç½šï¼‰"
    },

    "light_chase": {
      "_comment": "è½»åº¦è¿½é«˜ï¼šä»·æ ¼ä¸Šæ¶¨ä¸”èµ„é‡‘æµå‡º",
      "F_max": -40,
      "T_min": 70,
      "M_min": 70,
      "penalty": 0.85,
      "_effect": "ä¿¡å·å¼ºåº¦Ã—0.85ï¼ˆè½»åº¦æƒ©ç½šï¼‰"
    }
  }
}
```

#### å‚æ•°é€‰æ‹©ç†ç”±

| å‚æ•° | å€¼ | ç†ç”± |
|------|-----|------|
| **è½»åº¦ F_max** | -40 | F<-40è¡¨ç¤ºèµ„é‡‘å¼€å§‹æµå‡º |
| **è½»åº¦ T_min** | 70 | T>70è¡¨ç¤ºä»·æ ¼å·²æ˜æ˜¾ä¸Šæ¶¨ |
| **è½»åº¦ penalty** | 0.85 | è½»åº¦æƒ©ç½šï¼Œé™ä½15%å¼ºåº¦ |
| **ä¸­åº¦ F_max** | -60 | F<-60è¡¨ç¤ºèµ„é‡‘æ˜æ˜¾æµå‡º |
| **ä¸­åº¦ penalty** | 0.70 | ä¸­åº¦æƒ©ç½šï¼Œé™ä½30%å¼ºåº¦ |
| **é‡åº¦ F_max** | -80 | F<-80è¡¨ç¤ºèµ„é‡‘å¤§é‡æµå‡º |
| **é‡åº¦ T_min/M_min** | 90 | åŒé‡ç¡®è®¤ï¼ˆTå’ŒMåŒæ—¶æé«˜ï¼‰ |
| **é‡åº¦ penalty** | 0.50 | ä¸¥å‰æƒ©ç½šï¼Œé™ä½50%å¼ºåº¦ |

#### é¢„æœŸæ•ˆæœ

**è¿½é«˜åœºæ™¯æ¨¡æ‹Ÿ**:
```
å¸‚åœºçŠ¶æ€: BTCä»30000æ¶¨åˆ°35000ï¼ˆ+16.7%ï¼‰
F = -70, T = 88, M = 92

æ£€æµ‹ç»“æœ:
- æ»¡è¶³ä¸­åº¦è¿½é«˜æ¡ä»¶ï¼ˆF<-60 + T>85 + M>80ï¼‰
- chasing_penalty = 0.70

å‡è®¾åŸå§‹prime_strength = 50åˆ†:
è°ƒæ•´å = 50 Ã— 0.70 = 35åˆ†

å¦‚æœprimeé˜ˆå€¼=40åˆ†:
- åŸæœ¬ä¼šå‘ä¿¡å·ï¼ˆ50â‰¥40ï¼‰âœ…
- ç°åœ¨ä¸å‘ä¿¡å·ï¼ˆ35<40ï¼‰âŒ â† æˆåŠŸé˜»æ­¢è¿½é«˜ï¼
```

---

## å®æ–½è®¡åˆ’

### å®æ–½é¡ºåº

**ç¬¬1æ­¥: é…ç½®æ–‡ä»¶** (1å°æ—¶)
- [ ] ä¿®æ”¹ `config/params.json`
- [ ] æ·»åŠ  `accumulation_detection.v3` é…ç½®
- [ ] æ·»åŠ  `F_modulation` é…ç½®
- [ ] æ·»åŠ  `anti_chase_detection` é…ç½®

**ç¬¬2æ­¥: Få› å­Teffè°ƒåˆ¶** (2å°æ—¶)
- [ ] ä¿®æ”¹ `ats_core/modulators/modulator_chain.py`
- [ ] æ–°å¢ `_modulate_F` æ–¹æ³•
- [ ] ä¿®æ”¹ `modulate_all` æ–¹æ³•è°ƒç”¨

**ç¬¬3æ­¥: æ‰©å¤§è“„åŠ¿æ£€æµ‹** (3å°æ—¶)
- [ ] ä¿®æ”¹ `ats_core/pipeline/analyze_symbol.py`
- [ ] å®ç°ä¸‰çº§è“„åŠ¿æ£€æµ‹é€»è¾‘
- [ ] å‘åå…¼å®¹v2ç‰ˆæœ¬

**ç¬¬4æ­¥: åè¿½é«˜æ£€æµ‹** (2å°æ—¶)
- [ ] ä¿®æ”¹ `ats_core/pipeline/analyze_symbol.py`
- [ ] å®ç°ä¸‰çº§è¿½é«˜æƒ©ç½šé€»è¾‘
- [ ] é›†æˆåˆ°Primeåˆ¤å®šæµç¨‹

---

## é£é™©è¯„ä¼°

### é£é™©çŸ©é˜µ

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|----------|
| **é…ç½®é”™è¯¯** | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | å‘åå…¼å®¹ï¼Œå¯åˆ‡æ¢v2 |
| **é˜ˆå€¼ä¸å½“** | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | å‚æ•°å¯é…ç½®ï¼Œå¯è°ƒæ•´ |
| **ä¿¡å·è¿‡å¤š** | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ä¿ç•™è´¨é‡é—¨æ§› |
| **ä¿¡å·è¿‡å°‘** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | å¯é™ä½é˜ˆå€¼ |
| **æ€§èƒ½å½±å“** | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ä»…å¢åŠ å°‘é‡åˆ¤æ–­ |

### å›æ»šæ–¹æ¡ˆ

**å¦‚æœæ•ˆæœä¸ä½³ï¼Œå¯ç«‹å³å›æ»š**:

1. **é…ç½®å›æ»š**:
```json
{
  "accumulation_detection": {
    "version": "v2"  // åˆ‡æ¢å›v2
  },
  "F_modulation": {
    "enabled": false  // ç¦ç”¨Fè°ƒåˆ¶
  },
  "anti_chase_detection": {
    "enabled": false  // ç¦ç”¨åè¿½é«˜
  }
}
```

2. **ä»£ç å›æ»š**:
- æ‰€æœ‰æ–°å¢é€»è¾‘éƒ½æœ‰ `enabled` å¼€å…³
- å¯é€šè¿‡é…ç½®ç¦ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- Gitå¯å›æ»šåˆ°å®æ–½å‰çš„commit

---

## é¢„æœŸæ•ˆæœé‡åŒ–åˆ†æ

### ä¿¡å·è´¨é‡æ”¹å–„

**è“„åŠ¿ä¿¡å·è¦†ç›–ç‡**:
```
å½“å‰: 15% â†’ æ”¹è¿›å: 50-60% (æå‡3-4å€) âœ…âœ…âœ…
```

**è¿½é«˜ä¿¡å·å‡å°‘**:
```
å½“å‰: ä¼°è®¡30%ä¿¡å·ä¸ºè¿½é«˜
æ”¹è¿›å: å‡å°‘è‡³10-15% (å‡å°‘50%) âœ…âœ…
```

**ä¿¡å·æ»åæ”¹å–„**:
```
å½“å‰: å¹³å‡æ»å15-20%æ¶¨å¹…
æ”¹è¿›å: å¹³å‡æ»å10-15%æ¶¨å¹… (æ”¹å–„25-30%) âœ…
```

### å®é™…æ¡ˆä¾‹æ¨¡æ‹Ÿ

#### æ¡ˆä¾‹1: ä¸­ç­‰è“„åŠ¿ï¼ˆå½“å‰ä¼šé”™è¿‡ï¼‰

**å¸‚åœºçŠ¶æ€**:
```
BTCæ¨ªç›˜30000
F = +75, C = +55, T = +25, M = +15, O = +50
```

**å½“å‰ç³»ç»Ÿ**:
- âŒ ä¸æ»¡è¶³è“„åŠ¿æ¡ä»¶ï¼ˆF<90ï¼‰
- ç»¼åˆåˆ†æ•° â‰ˆ 42åˆ†
- å¯èƒ½ä¸å‘ä¿¡å· â†’ **é”™è¿‡æœºä¼š**

**æ”¹è¿›å**:
- âœ… æ»¡è¶³Lv2ä¸­ç­‰è“„åŠ¿ï¼ˆFâ‰¥70 + Câ‰¥50 + T<50ï¼‰
- primeé˜ˆå€¼é™ä½åˆ°35åˆ†
- ç»¼åˆåˆ†æ•°42åˆ† â‰¥ 35åˆ†
- **å‘ä¿¡å·** âœ… â†’ æå‰æ•æ‰

#### æ¡ˆä¾‹2: ä¸­åº¦è¿½é«˜ï¼ˆå½“å‰ä¼šå‘ä¿¡å·ï¼‰

**å¸‚åœºçŠ¶æ€**:
```
BTCä»30000æ¶¨åˆ°35000
F = -65, T = +88, M = +82
```

**å½“å‰ç³»ç»Ÿ**:
- ç»¼åˆåˆ†æ•° â‰ˆ 48åˆ†
- primeé˜ˆå€¼ = 40åˆ†
- 48 â‰¥ 40 â†’ **å‘ä¿¡å·** âŒï¼ˆè¿½é«˜ï¼‰

**æ”¹è¿›å**:
- âœ… æ£€æµ‹åˆ°ä¸­åº¦è¿½é«˜ï¼ˆF<-60 + T>85ï¼‰
- prime_strength = 48 Ã— 0.70 = 33.6åˆ†
- 33.6 < 40åˆ†
- **ä¸å‘ä¿¡å·** âœ… â†’ æˆåŠŸé˜»æ­¢

---

## ç›‘æ§æŒ‡æ ‡

### å®æ–½åéœ€è¦ç›‘æ§çš„æŒ‡æ ‡

1. **è“„åŠ¿æ£€æµ‹è§¦å‘ç‡**:
   - Lv3è§¦å‘æ¬¡æ•° / æ€»ä¿¡å·æ•°
   - Lv2è§¦å‘æ¬¡æ•° / æ€»ä¿¡å·æ•°
   - Lv1è§¦å‘æ¬¡æ•° / æ€»ä¿¡å·æ•°
   - **ç›®æ ‡**: Lv2+Lv3 â‰¥ 40%

2. **è¿½é«˜æ£€æµ‹è§¦å‘ç‡**:
   - è½»åº¦è¿½é«˜æ¬¡æ•° / æ€»å€™é€‰
   - ä¸­åº¦è¿½é«˜æ¬¡æ•° / æ€»å€™é€‰
   - é‡åº¦è¿½é«˜æ¬¡æ•° / æ€»å€™é€‰
   - **ç›®æ ‡**: è¿½é«˜æƒ©ç½šç‡ â‰¥ 20%

3. **Få› å­Teffè°ƒåˆ¶åˆ†å¸ƒ**:
   - Teff_F > 1.0çš„æ¯”ä¾‹ï¼ˆè“„åŠ¿åœºæ™¯ï¼‰
   - Teff_F < 1.0çš„æ¯”ä¾‹ï¼ˆè¿½é«˜åœºæ™¯ï¼‰
   - **ç›®æ ‡**: åˆ†å¸ƒåˆç†ï¼Œä¸æç«¯

4. **ä¿¡å·è´¨é‡**:
   - ä¿¡å·æ•°é‡å˜åŒ–ï¼ˆÂ±20%å¯æ¥å—ï¼‰
   - å…¥åœºä»·æ ¼ vs æœ€ä¼˜ä»·æ ¼çš„å·®è·
   - **ç›®æ ‡**: å·®è·å‡å°‘25-30%

---

## æ€»ç»“

### æ–¹æ¡ˆç‰¹ç‚¹

âœ… **ä½é£é™©**: ä¸æ”¹å˜æ ¸å¿ƒæ¶æ„ï¼Œå¯é…ç½®å¯å›æ»š
âœ… **é«˜æ”¶ç›Š**: é¢„æœŸæ”¹å–„30-40%
âœ… **å‘åå…¼å®¹**: ä¿ç•™v2ç‰ˆæœ¬ï¼Œå¹³æ»‘è¿ç§»
âœ… **å¯ç›‘æ§**: æ˜ç¡®çš„ç›‘æ§æŒ‡æ ‡
âœ… **å¯è°ƒæ•´**: æ‰€æœ‰å‚æ•°å¯é…ç½®

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç­‰å¾…æ‚¨çš„ç¡®è®¤**:
1. âœ… æ˜¯å¦åŒæ„æ–¹æ¡ˆè®¾è®¡ï¼Ÿ
2. âœ… é…ç½®å‚æ•°æ˜¯å¦éœ€è¦è°ƒæ•´ï¼Ÿ
3. âœ… æ˜¯å¦ç«‹å³å¼€å§‹å®æ–½ï¼Ÿ

**å®æ–½å**:
1. ç›‘æ§1-2å¤©æ•°æ®
2. æ ¹æ®ç›‘æ§ç»“æœå¾®è°ƒå‚æ•°
3. å¦‚æ•ˆæœè‰¯å¥½ï¼Œæ¨è¿›åˆ°ç¬¬äºŒé˜¶æ®µ

---

**è®¾è®¡å®Œæˆ**: 2025-11-16
**ç­‰å¾…ç¡®è®¤**: è¯·å®¡é˜…æ–¹æ¡ˆå¹¶åé¦ˆ
