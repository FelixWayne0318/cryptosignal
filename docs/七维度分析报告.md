# 七维度系统分析报告

## 一、硬阈值检查

### ✅ 已使用软映射的维度（4个）
| 维度 | 映射方式 | 状态 |
|------|---------|------|
| **A（加速）** | `directional_score()` - tanh曲线 | ✅ 真实数据 |
| **V（量能）** | `directional_score()` - tanh曲线 | ✅ 真实数据 |
| **O（持仓）** | `directional_score()` - tanh曲线 | ✅ 真实数据 |
| **F（资金领先）** | `tanh()` 直接映射 | ✅ 真实数据 |

### ⚠️ 使用线性映射的维度（2个）
| 维度 | 映射方式 | 问题 |
|------|---------|------|
| **S（结构）** | 线性加权组合 | 不是硬阈值，但不够平滑 |
| **E（环境）** | 线性 clamp 映射 | 不是硬阈值，但不够平滑 |

### ❌ 使用硬阈值的维度（1个）
| 维度 | 映射方式 | 问题 |
|------|---------|------|
| **T（趋势）** | **阶梯式加分** | **存在硬阈值！** |

**T（趋势）的硬阈值示例**：
```python
T = 50  # 基础分
if ema_up:
    T += 15  # 硬跳变
elif ema_dn:
    T -= 15  # 硬跳变

if slope_per_bar >= slope_atr_min_long:
    T += 25  # 硬跳变
elif slope_per_bar <= -slope_atr_min_long:
    T -= 25  # 硬跳变
# ... 更多阶梯
```

**问题**：当 `slope_per_bar` 从 0.099 变到 0.101 时（假设阈值是0.1），分数会从 65 突变到 90。

---

## 二、维度重叠分析

### 🔴 严重重叠的指标

#### 1. CVD（累积量差）
| 维度 | 用途 | 权重 |
|------|------|------|
| **A（加速）** | cvd6（6小时CVD变化） → 判断加速度 | A维度权重=10% |
| **F（资金领先）** | cvd_change → 构成资金动量的30% | F维度权重=15% × 30% = 4.5% |

**重叠度**：★★★★☆（同一个指标用了两次）

#### 2. Volume（成交量）
| 维度 | 用途 | 权重 |
|------|------|------|
| **V（量能）** | v5/v20 比率 → 判断量能强弱 | V维度权重=15% |
| **F（资金领先）** | vol_ratio（也是v5/v20）→ 构成资金动量的30% | F维度权重=15% × 30% = 4.5% |

**重叠度**：★★★★★（完全相同的指标）

#### 3. OI（持仓量）
| 维度 | 用途 | 权重 |
|------|------|------|
| **O（持仓）** | oi24h变化 + 价格-OI对齐度 | O维度权重=15% |
| **F（资金领先）** | oi_change_pct → 构成资金动量的40% | F维度权重=15% × 40% = 6% |

**重叠度**：★★★☆☆（O还包含对齐度，F只用变化量）

#### 4. 价格趋势/斜率
| 维度 | 用途 | 权重 |
|------|------|------|
| **T（趋势）** | 斜率/ATR、EMA顺序 | T维度权重=20% |
| **A（加速）** | 价格斜率30 | A维度权重=10% |
| **F（资金领先）** | price_change_pct + price_slope → 构成价格动量 | F维度权重=15% |

**重叠度**：★★★★☆（价格斜率被多次使用）

---

## 三、F（资金领先）维度的本质

### F 维度的计算公式
```
fund_momentum = 0.4×OI分数 + 0.3×Volume分数 + 0.3×CVD分数
price_momentum = 0.6×价格变化分数 + 0.4×价格斜率分数
F = tanh((fund_momentum - price_momentum) / 20)
```

### F 维度的特点
✅ **不是新指标**，而是已有指标的**重新组合**
✅ **核心价值**：判断资金（因）与价格（果）的**时序关系**
✅ **元维度**：它是对其他维度（O、V、A、T）的**二次分析**

### F 维度的合理性
虽然F使用了O、V、A、T的指标，但它提供了**新的信息维度**：
- **O、V、A** 单独看：资金流入了吗？量能放大了吗？
- **F 综合看**：资金流入了，但价格还没涨 → **蓄势待发**（F=78）
- **F 综合看**：价格大涨了，但资金没跟上 → **追高风险**（F=0）

**结论**：F 维度虽然重叠，但提供了**独特的因果关系视角**。

---

## 四、可能遗漏的市场信息

### 当前七维度覆盖的信息
| 类别 | 覆盖的指标 |
|------|-----------|
| **价格** | 趋势、斜率、结构、加速度 |
| **成交量** | v5/v20、变化率 |
| **持仓量** | OI变化、价格-OI对齐 |
| **市场微观** | ATR、Chop、Room |
| **资金流** | CVD、资金-价格领先性 |

### 未覆盖但重要的信息
| 信息 | 重要性 | 难度 | 说明 |
|------|--------|------|------|
| **资金费率** | ⭐⭐⭐⭐⭐ | 低 | 反映多空情绪，Binance API 可直接获取 |
| **未平仓价值/市值比** | ⭐⭐⭐⭐ | 中 | 衡量杠杆程度 |
| **大单成交（主力动向）** | ⭐⭐⭐⭐ | 高 | 需要逐笔成交数据 |
| **盘口深度** | ⭐⭐⭐ | 中 | 流动性指标 |
| **BTC/ETH 相关性** | ⭐⭐⭐ | 低 | 市场整体环境 |
| **链上数据** | ⭐⭐ | 高 | 现货市场的影响 |

---

## 五、改进建议

### 🔥 紧急修复：T（趋势）维度的硬阈值
**问题**：T 维度使用阶梯式加分，存在硬跳变
**建议**：改用 `directional_score()` 实现软映射

### 🔧 优化建议：S、E 维度
**问题**：使用线性映射，不够平滑
**建议**：考虑改用 sigmoid/tanh 等S型曲线

### 💡 去重建议：F 维度的重叠
**评估**：重叠是合理的，因为F提供了**因果关系视角**
**建议**：保持现状，但可以考虑：
1. 调整权重，减少重叠指标的总权重占比
2. 在文档中明确说明F的"元维度"性质

### 🚀 扩展建议：资金费率维度
**建议**：考虑添加第8个维度 - **R（Risk/资金费率）**
```python
def score_funding_rate(funding_rate: float, oi_value_ratio: float):
    """
    资金费率维度：
    - 做多时：资金费率负值好（空头付费）
    - 做空时：资金费率正值好（多头付费）
    - 结合 OI/市值 比率判断过热程度
    """
    pass
```

---

## 六、总结

### 当前状态
✅ **4/7 维度使用软映射**（A、V、O、F）
⚠️ **2/7 维度使用线性映射**（S、E）
❌ **1/7 维度存在硬阈值**（T）← **需要修复**

### 重叠情况
- **Volume**: V 和 F 完全重叠（v5/v20）
- **CVD**: A 和 F 重叠
- **OI**: O 和 F 部分重叠
- **价格趋势**: T、A、F 多次使用

### 是否合理？
✅ **F 维度的重叠是合理的**：它不是引入新数据，而是提供**因果关系分析**
❌ **T 维度的硬阈值不合理**：需要改成软映射
⚠️ **可以考虑添加资金费率维度**：补充市场情绪信息

### 用户问题的答案
> "目前是不是所有分析的数据都是真实的，不存在超过某一个阈值直接赋值为100或者0"

**回答**：
- ✅ **A、V、O、F** 是真实的（软映射）
- ⚠️ **S、E** 是真实的（线性映射，不是硬阈值）
- ❌ **T** 存在硬阈值（阶梯式加分）← **需要修复**

> "阈值只在发送信号的时候启用"

**回答**：
- ✅ 发送信号的阈值（P≥0.62 PRIME，P≥0.58 WATCH）是正确使用
- ❌ T 维度的内部阈值需要去除

---

**日期**：2025-10-25
**版本**：v1.6-analysis
