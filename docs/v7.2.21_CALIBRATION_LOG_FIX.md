# v7.2.21 Calibrationæ—¥å¿—ä¼˜åŒ–ä¿®å¤

**ä¿®å¤æ—¥æœŸ**: 2025-11-11
**ä¼˜å…ˆçº§**: P2 (ä¼˜åŒ–)
**æ€»è€—æ—¶**: ~30åˆ†é’Ÿ

---

## ä¿®å¤å†…å®¹æ¦‚è§ˆ

| # | é—®é¢˜ | é£é™©ç­‰çº§ | çŠ¶æ€ |
|---|------|---------|------|
| 1 | Calibrationé‡å¤åˆå§‹åŒ–å¯¼è‡´æ—¥å¿—æ±¡æŸ“ | ğŸŸ¡ ä¸­ | âœ… å·²ä¿®å¤ |
| 2 | æ€§èƒ½æµªè´¹ï¼šé‡å¤åŠ è½½calibration_history.json | ğŸŸ¢ ä½ | âœ… å·²ä¿®å¤ |

---

## é—®é¢˜è¯¦æƒ…

### 1. Calibrationæ—¥å¿—æ±¡æŸ“

#### é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šæ—¥å¿—ä¸­æœ‰å¤§é‡é‡å¤è­¦å‘Šä¿¡æ¯ï¼š

```
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
[TradeRecorder] è®°å½•ä¿¡å·å¿«ç…§: BTCUSDT_1762846077537
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
[TradeRecorder] è®°å½•ä¿¡å·å¿«ç…§: SOLUSDT_1762846077565
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
[TradeRecorder] è®°å½•ä¿¡å·å¿«ç…§: XRPUSDT_1762846077597
...
```

**å½±å“**:
- 406ä¸ªå¸ç§æ‰«æ = 406æ¡é‡å¤è­¦å‘Š
- ä¸¥é‡æ±¡æŸ“æ—¥å¿—ï¼Œéš¾ä»¥æŸ¥çœ‹å…³é”®ä¿¡æ¯
- ç”¨æˆ·è¯¯è®¤ä¸ºæ˜¯åŠŸèƒ½é—®é¢˜

#### æ ¹æœ¬åŸå› 

**ä½ç½®**: `ats_core/pipeline/analyze_symbol_v72.py:107`

```python
# é”™è¯¯ï¼šæ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°å®ä¾‹
def analyze_with_v72_enhancements(...):
    calibrator = EmpiricalCalibrator()  # â† æ¯ä¸ªå¸ç§éƒ½åˆ›å»ºä¸€æ¬¡
    ...
```

**è°ƒç”¨é“¾**:
```
realtime_signal_scanner.py
  â””â”€ batch_scan_optimized.py (æ‰«æ406ä¸ªå¸ç§)
      â””â”€ analyze_symbol_v72.py
          â””â”€ EmpiricalCalibrator().__init__()  â† åˆ›å»º406æ¬¡ï¼
              â””â”€ _update_table()
                  â””â”€ print("æ•°æ®ä¸è¶³...")  â† æ‰“å°406æ¬¡ï¼
```

**å‰¯ä½œç”¨**:
1. **æ—¥å¿—æ±¡æŸ“**: æ¯ä¸ªå¸ç§æ‰“å°ä¸€æ¬¡è­¦å‘Š
2. **æ€§èƒ½æµªè´¹**: é‡å¤åŠ è½½ `calibration_history.json` 406æ¬¡
3. **å†…å­˜æµªè´¹**: åˆ›å»º406ä¸ªç›¸åŒçš„å¯¹è±¡

---

## ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šæ¨¡å—çº§å•ä¾‹æ¨¡å¼

#### è®¾è®¡ç†å¿µ

**å•ä¾‹æ¨¡å¼é€‚ç”¨åœºæ™¯**ï¼ˆSYSTEM_ENHANCEMENT_STANDARD.md Â§ 2.3ï¼‰:
- å¯¹è±¡åˆå§‹åŒ–å¼€é”€å¤§ï¼ˆåŠ è½½æ–‡ä»¶ã€è¿æ¥æ•°æ®åº“ï¼‰
- å¯¹è±¡çŠ¶æ€éœ€è¦åœ¨å¤šæ¬¡è°ƒç”¨é—´å…±äº«
- å¯¹è±¡æ— çŠ¶æ€æˆ–çŠ¶æ€å¯å¤ç”¨

`EmpiricalCalibrator` å®Œå…¨ç¬¦åˆï¼š
- âœ… åˆå§‹åŒ–æ—¶åŠ è½½ `calibration_history.json`
- âœ… æ ¡å‡†è¡¨å¯ä»¥åœ¨å¤šæ¬¡è°ƒç”¨é—´å…±äº«
- âœ… å†å²è®°å½•éœ€è¦ç´¯ç§¯ï¼Œä¸åº”é‡ç½®

#### å®ç°ç»†èŠ‚

**æ–‡ä»¶1**: `ats_core/pipeline/analyze_symbol_v72.py`

```python
# v7.2.21ä¿®å¤ï¼šä½¿ç”¨æ¨¡å—çº§å•ä¾‹ï¼Œé¿å…é‡å¤åˆå§‹åŒ–å’Œæ—¥å¿—æ±¡æŸ“
from ats_core.calibration.empirical_calibration import EmpiricalCalibrator
_calibrator_singleton = None

def _get_calibrator() -> EmpiricalCalibrator:
    """
    è·å–æ ¡å‡†å™¨å•ä¾‹

    ä¿®å¤åŸå› ï¼ˆv7.2.21ï¼‰ï¼š
    - ä¹‹å‰æ¯æ¬¡è°ƒç”¨analyze_with_v72_enhancementséƒ½åˆ›å»ºæ–°å®ä¾‹
    - å¯¼è‡´æ¯ä¸ªå¸ç§æ‰«æéƒ½æ‰“å°"æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™"
    - 406ä¸ªå¸ç§ = 406æ¡é‡å¤è­¦å‘Šï¼Œä¸¥é‡æ±¡æŸ“æ—¥å¿—
    - ä¸”æµªè´¹æ€§èƒ½ï¼ˆé‡å¤åŠ è½½calibration_history.jsonï¼‰

    Returns:
        å…¨å±€å•ä¾‹æ ¡å‡†å™¨å®ä¾‹
    """
    global _calibrator_singleton
    if _calibrator_singleton is None:
        _calibrator_singleton = EmpiricalCalibrator()
    return _calibrator_singleton

def analyze_with_v72_enhancements(...):
    # v7.2.21ä¿®å¤ï¼šä½¿ç”¨æ¨¡å—çº§å•ä¾‹ï¼Œé¿å…é‡å¤åˆå§‹åŒ–
    calibrator = _get_calibrator()
    ...
```

**æ–‡ä»¶2**: `ats_core/calibration/empirical_calibration.py`

```python
def __init__(self, storage_path: str = "data/calibration_history.json", silent: bool = False):
    """
    åˆå§‹åŒ–æ ¡å‡†å™¨

    Args:
        storage_path: å†å²è®°å½•å­˜å‚¨è·¯å¾„
        silent: æ˜¯å¦é™é»˜æ¨¡å¼ï¼ˆä¸æ‰“å°åˆå§‹åŒ–æ—¥å¿—ï¼‰
    """
    self.storage_path = storage_path
    self.history = self._load_history()
    self.calibration_table = {}
    self._silent = silent
    self._update_table()

    # v7.2.21ï¼šåªåœ¨åˆå§‹åŒ–æ—¶æ‰“å°ä¸€æ¬¡çŠ¶æ€ä¿¡æ¯
    if not self._silent:
        if len(self.history) < 30:
            print(f"[Calibration] åˆå§‹åŒ–å®Œæˆï¼šæ•°æ®ä¸è¶³({len(self.history)}/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™")
        else:
            print(f"[Calibration] åˆå§‹åŒ–å®Œæˆï¼šå·²åŠ è½½ {len(self.history)} æ¡å†å²è®°å½•ï¼Œä½¿ç”¨ç»Ÿè®¡æ ¡å‡†")

def _update_table(self):
    """
    æ›´æ–°æ ¡å‡†è¡¨

    åˆ†æ¡¶ç»Ÿè®¡ï¼šæŠŠconfidenceåˆ†æˆ10ä¸ªæ¡¶ï¼Œè®¡ç®—æ¯ä¸ªæ¡¶çš„å®é™…èƒœç‡
    """
    # P0.3ä¿®å¤ï¼šé™ä½å¯ç”¨é˜ˆå€¼ä»50â†’30ï¼ŒåŠ å¿«å†·å¯åŠ¨
    # v7.2.21ä¿®å¤ï¼šç§»é™¤é‡å¤æ—¥å¿—ï¼Œåªåœ¨åˆå§‹åŒ–æ—¶æ‰“å°ä¸€æ¬¡
    if len(self.history) < 30:  # è‡³å°‘30ä¸ªæ ·æœ¬
        return
    ...
```

---

## éªŒè¯ç»“æœ

### æµ‹è¯•1: æ¨¡å—å¯¼å…¥éªŒè¯

```bash
$ python3 -c "
from ats_core.pipeline.analyze_symbol_v72 import analyze_with_v72_enhancements, _get_calibrator
print('âœ… analyze_symbol_v72 æ¨¡å—å¯¼å…¥æˆåŠŸ')

# æµ‹è¯•å•ä¾‹
cal1 = _get_calibrator()
cal2 = _get_calibrator()
assert cal1 is cal2, 'å•ä¾‹éªŒè¯å¤±è´¥'
print(f'âœ… æ ¡å‡†å™¨å•ä¾‹éªŒè¯é€šè¿‡ (åŒä¸€å®ä¾‹)')
print(f'âœ… å†å²è®°å½•æ•°: {len(cal1.history)}')
"

# è¾“å‡º:
âœ… analyze_symbol_v72 æ¨¡å—å¯¼å…¥æˆåŠŸ
[Calibration] åˆå§‹åŒ–å®Œæˆï¼šæ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™  â† åªæ‰“å°ä¸€æ¬¡
âœ… æ ¡å‡†å™¨å•ä¾‹éªŒè¯é€šè¿‡ (åŒä¸€å®ä¾‹)
âœ… å†å²è®°å½•æ•°: 0
```

**ç»“æœ**: âœ… é€šè¿‡
- æ¨¡å—å¯¼å…¥æˆåŠŸ
- å•ä¾‹éªŒè¯é€šè¿‡ï¼ˆä¸¤æ¬¡è°ƒç”¨è¿”å›åŒä¸€å®ä¾‹ï¼‰
- æ—¥å¿—åªæ‰“å°ä¸€æ¬¡

### æµ‹è¯•2: é…ç½®åŠ è½½éªŒè¯

```bash
$ python3 -c "
from ats_core.config.threshold_config import get_thresholds
config = get_thresholds()
print('âœ… é…ç½®åŠ è½½æˆåŠŸ')
"

# è¾“å‡º:
âœ… é…ç½®åŠ è½½æˆåŠŸ
```

**ç»“æœ**: âœ… é€šè¿‡

---

## ä¿®å¤æ•ˆæœå¯¹æ¯”

### Beforeï¼ˆv7.2.20ï¼‰

**æ—¥å¿—è¾“å‡ºï¼ˆ406ä¸ªå¸ç§æ‰«æï¼‰**:
```
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
[Calibration] æ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™
... (é‡å¤406æ¬¡)
```

**æ€§èƒ½å½±å“**:
- æ–‡ä»¶åŠ è½½: 406æ¬¡ `open(calibration_history.json)`
- å¯¹è±¡åˆ›å»º: 406ä¸ª `EmpiricalCalibrator` å®ä¾‹
- æ—¥å¿—è¾“å‡º: 406æ¡é‡å¤è­¦å‘Š

### Afterï¼ˆv7.2.21ï¼‰

**æ—¥å¿—è¾“å‡ºï¼ˆ406ä¸ªå¸ç§æ‰«æï¼‰**:
```
[Calibration] åˆå§‹åŒ–å®Œæˆï¼šæ•°æ®ä¸è¶³(0/30)ï¼Œä½¿ç”¨å¯å‘å¼è§„åˆ™  â† åªæ˜¾ç¤ºä¸€æ¬¡
```

**æ€§èƒ½å½±å“**:
- æ–‡ä»¶åŠ è½½: 1æ¬¡ `open(calibration_history.json)`
- å¯¹è±¡åˆ›å»º: 1ä¸ª `EmpiricalCalibrator` å®ä¾‹
- æ—¥å¿—è¾“å‡º: 1æ¡æ¸…æ™°æç¤º

---

## æ”¹è¿›æ€»ç»“

| æŒ‡æ ‡ | Before | After | æ”¹å–„ |
|------|--------|-------|------|
| æ—¥å¿—æ¡æ•°ï¼ˆ406å¸ç§ï¼‰ | 406æ¡ | 1æ¡ | -99.8% |
| æ–‡ä»¶åŠ è½½æ¬¡æ•° | 406æ¬¡ | 1æ¬¡ | -99.8% |
| å¯¹è±¡åˆ›å»ºæ¬¡æ•° | 406ä¸ª | 1ä¸ª | -99.8% |
| æ—¥å¿—å¯è¯»æ€§ | âŒ æ±¡æŸ“ä¸¥é‡ | âœ… æ¸…æ™°æ˜äº† | - |
| ç”¨æˆ·ä½“éªŒ | âŒ è¯¯è®¤ä¸ºé”™è¯¯ | âœ… æ­£å¸¸æç¤º | - |

**å…³é”®æ”¹è¿›**:
- âœ… æ—¥å¿—ä»406æ¡å‡å°‘åˆ°1æ¡ï¼ˆ-99.8%ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šæ–‡ä»¶åŠ è½½å’Œå¯¹è±¡åˆ›å»ºå‡å°‘406å€
- âœ… ç”¨æˆ·ä½“éªŒï¼šæ¸…æ™°çš„åˆå§‹åŒ–æç¤ºï¼Œä¸å†è¯¯è®¤ä¸ºé”™è¯¯
- âœ… åŠŸèƒ½å®Œæ•´ï¼šå•ä¾‹å…±äº«æ ¡å‡†æ•°æ®ï¼Œæ”¯æŒå†å²ç´¯ç§¯

---

## æ–‡ä»¶å˜æ›´æ¸…å•

### æ ¸å¿ƒä¿®å¤
- `ats_core/pipeline/analyze_symbol_v72.py`
  - æ·»åŠ æ¨¡å—çº§å•ä¾‹å‡½æ•° `_get_calibrator()`
  - Line 25-44: æ–°å¢å•ä¾‹å®ç°
  - Line 128: ä½¿ç”¨å•ä¾‹ä»£æ›¿å±€éƒ¨åˆ›å»º

- `ats_core/calibration/empirical_calibration.py`
  - Line 45: æ·»åŠ  `silent` å‚æ•°æ”¯æŒ
  - Line 59-64: æ·»åŠ åˆå§‹åŒ–æ—¥å¿—ï¼ˆåªæ‰“å°ä¸€æ¬¡ï¼‰
  - Line 118: ç§»é™¤ `_update_table()` ä¸­çš„é‡å¤æ—¥å¿—

### æ–‡æ¡£æ›´æ–°
- `docs/v7.2.21_CALIBRATION_LOG_FIX.md` (æœ¬æ–‡æ¡£)

---

## å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹**

- ä¿æŒ `EmpiricalCalibrator` å…¬å…±APIä¸å˜
- `__init__` æ–°å¢å¯é€‰å‚æ•° `silent`ï¼Œé»˜è®¤å€¼ `False` ä¿æŒå…¼å®¹
- å•ä¾‹å®ç°å¯¹å¤–éƒ¨é€æ˜ï¼Œä¸å½±å“ç°æœ‰è°ƒç”¨
- æ ¡å‡†é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œä¸å½±å“ä¿¡å·è´¨é‡

---

## æœ€ä½³å®è·µæç‚¼

### ä½•æ—¶ä½¿ç”¨å•ä¾‹æ¨¡å¼

**é€‚ç”¨åœºæ™¯**:
1. **åˆå§‹åŒ–å¼€é”€å¤§**: åŠ è½½æ–‡ä»¶ã€è¿æ¥æ•°æ®åº“ã€å¤æ‚è®¡ç®—
2. **çŠ¶æ€éœ€å…±äº«**: ç¼“å­˜ã€é…ç½®ã€æ ¡å‡†æ•°æ®
3. **é¢‘ç¹è°ƒç”¨**: æ¯æ¬¡è¯·æ±‚ã€æ¯ä¸ªå¾ªç¯éƒ½éœ€è¦ä½¿ç”¨

**å®ç°æ¨¡å¼**ï¼ˆPythonæ¨èï¼‰:
```python
# æ¨¡å—çº§å•ä¾‹ï¼ˆæ¨èï¼‰
_singleton = None

def get_instance():
    global _singleton
    if _singleton is None:
        _singleton = HeavyObject()
    return _singleton
```

**é¿å…åœºæ™¯**:
- å¯¹è±¡æœ‰ç‹¬ç«‹çŠ¶æ€ä¸”ä¸åº”å…±äº«
- å¯¹è±¡è½»é‡çº§ï¼ˆåˆ›å»ºæˆæœ¬ä½ï¼‰
- æµ‹è¯•éœ€è¦éš”ç¦»ï¼ˆè€ƒè™‘ä¾èµ–æ³¨å…¥ï¼‰

### æ—¥å¿—ä¼˜åŒ–åŸåˆ™

1. **é¿å…é‡å¤**: å¾ªç¯ä¸­çš„æ—¥å¿—åº”æå–åˆ°å¤–éƒ¨
2. **çº§åˆ«åˆ†æ˜**: INFOï¼ˆæ­£å¸¸ï¼‰ã€WARNï¼ˆå¼‚å¸¸ä½†å¯å¤„ç†ï¼‰ã€ERRORï¼ˆå¤±è´¥ï¼‰
3. **ä¸Šä¸‹æ–‡æ¸…æ™°**: åŒ…å«è¶³å¤Ÿä¿¡æ¯å®šä½é—®é¢˜
4. **ç”¨æˆ·å‹å¥½**: é¿å…æŠ€æœ¯æœ¯è¯­ï¼Œæä¾›è§£å†³æ–¹æ¡ˆ

**ç¤ºä¾‹**:
```python
# âŒ é”™è¯¯ï¼šå¾ªç¯ä¸­æ‰“å°
for item in items:
    print(f"Processing {item}...")

# âœ… æ­£ç¡®ï¼šæ±‡æ€»æ‰“å°
print(f"Processing {len(items)} items...")
for item in items:
    process(item)
print("âœ… All items processed")
```

---

## ç›¸å…³é—®é¢˜

### ç”¨æˆ·æåˆ°çš„"æŠ¥å‘Šè·¯å¾„é—®é¢˜"

**ç”¨æˆ·æ—¥å¿—æ˜¾ç¤º**:
```
[2025-11-11 07:27:57Z] âœ… æŠ¥å‘Šå·²å†™å…¥ä»“åº“:
[2025-11-11 07:27:57Z]    - latest_summary_json: /home/cryptosignal/cryptosignal/reports/latest/scan_summary.json
```

**è°ƒæŸ¥ç»“æœ**:
- è·¯å¾„è®¡ç®—ä½ç½®: `report_writer.py:28` ä½¿ç”¨ `Path(__file__).parent.parent.parent`
- è·¯å¾„æ˜¾ç¤ºä½ç½®: `batch_scan_optimized.py:913-915`
- å®é™…æƒ…å†µ: `auto_commit_reports.sh:30` ä¼˜å…ˆæ£€æµ‹ `/home/user/cryptosignal`
- **ç»“è®º**: åªæ˜¯æ—¥å¿—æ˜¾ç¤ºé—®é¢˜ï¼Œæ–‡ä»¶å®é™…å†™å…¥æ­£ç¡®ä½ç½®

**æ˜¯å¦éœ€è¦ä¿®å¤**: âŒ ä¸éœ€è¦
- åŠŸèƒ½æ­£å¸¸ï¼ˆæŠ¥å‘ŠæˆåŠŸå†™å…¥ï¼‰
- è·¯å¾„è‡ªåŠ¨æ£€æµ‹æœºåˆ¶å·¥ä½œæ­£å¸¸
- ç”¨æˆ·ç¯å¢ƒå¯èƒ½æœ‰ç¬¦å·é“¾æ¥æˆ–åˆ«å
- ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

## ç‰ˆæœ¬å†å²

- **v7.2.21** (2025-11-11): Calibrationæ—¥å¿—ä¼˜åŒ– - å•ä¾‹æ¨¡å¼ + æ—¥å¿—æ¸…ç†
- **v7.2.20** (2025-11-11): ä¿®å¤é…ç½®åŠ è½½å¤±è´¥ï¼ˆPythonä½œç”¨åŸŸé—®é¢˜ï¼‰
- **v7.2.19** (2025-11-11): åŸºäºå®é™…æ•°æ®çš„é˜ˆå€¼é…ç½®
- **v7.2.18** (2025-11-11): å°è¯•æé«˜é˜ˆå€¼ï¼ˆå¤±è´¥ï¼Œ0ä¿¡å·ï¼‰

---

**å½“å‰ç‰ˆæœ¬**: v7.2.21
**æœ€åæ›´æ–°**: 2025-11-11
**é€‚ç”¨èŒƒå›´**: Calibrationæ—¥å¿—ä¼˜åŒ–å’Œæ€§èƒ½æå‡
