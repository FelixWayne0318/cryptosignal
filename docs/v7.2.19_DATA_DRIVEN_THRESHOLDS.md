# v7.2.19 数据驱动阈值配置

**版本**: v7.2.19
**日期**: 2025-11-11
**类型**: 配置修复 (Config Fix)
**影响范围**: 信号阈值调整

---

## 📋 问题背景

### v7.2.18配置的严重问题

**扫描结果**: 405个币种，**0个信号** ❌

**根本原因**: 配置阈值严重脱离实际市场数据分布

| 参数 | v7.2.18配置 | 实际数据分布 | 结果 |
|------|------------|--------------|------|
| confidence_min | 50 | 中位=9, P75=15, **Max=32** | ❌ 50>32，100%拒绝 |
| edge_min | 0.20 | 中位=0.09, **P75=0.15** | ⚠️ 75%拒绝 |
| prime_strength_min | 50 | 中位=36, **P75=42**, Max=56 | ⚠️ 90%拒绝 |

**拒绝统计**:
- 置信度不足: 399/405 (98.5%) ← **最致命的拦截**
- Edge不足: 360/405 (88.9%)
- Prime强度不足: 172/405 (42.5%)

**接近通过但被拦截**: 21个币种非常接近阈值（差1-4分），但全部被拒绝

---

## ✅ 解决方案：v7.2.19数据驱动配置

### 设计原则

**基于2025-11-11实际扫描数据**:
- confidence: 中位=9, P75=15, Max=32
- prime_strength: 中位=36, P75=42, Max=56
- edge: 中位=0.09, P75=0.15, Max=0.32
- F因子: 中位=-1, P75=1, Max=95

**设计目标**:
1. 阈值设在P75附近（通过率约25%）
2. Gate阈值基于实际分布调整
3. 预期：基础层40-80个候选 → Gate过滤 → 5-15个Prime信号

---

## 📊 具体变更

### 一、基础分析阈值

| 参数 | 旧配置 | v7.2.18(错误) | v7.2.19(修复) | 数据依据 |
|------|--------|---------------|---------------|----------|
| **confidence_min** | 8 | 50 | **15** | P75水平 ⭐️ |
| **prime_strength_min** | 35 | 50 | **42** | P75水平 ⭐️ |
| **edge_min** | 0.10 | 0.20 | **0.12** | 略高于中位(0.09) |
| **prime_prob_min** | 0.45 | 0.60 | **0.50** | 适度提升 |
| **base_strength_min** | 30 | 45 | **40** | 略高于中位(36) |
| **gate_multiplier_min** | 0.84 | 0.90 | **0.84** | 恢复合理值 |
| **dims_ok_min** | 3 | 4 | **3** | 保持宽松 |

### 二、Gate阈值调整

| Gate | 参数 | 旧配置 | v7.2.18(错误) | v7.2.19(修复) | 数据依据 |
|------|------|--------|---------------|---------------|----------|
| **Gate 1** | min_klines | 100 | 150 | **150** | 实际min=191，合理 |
| **Gate 2** | F_min | -50 | +10 | **-10** | 中位=-1, P75=1 ⭐️ |
| **Gate 3** | EV_min | 0.0 | 2.0 | **0.015** | 1.5%，略低于中位 |
| **Gate 4** | P_min | 0.40 | 0.60 | **0.50** | 适度提升 |
| **Gate 5** | I_min | 0 | 0 | **0** | 保持不变 |

---

## 📈 预期效果对比

### v7.2.18（错误配置）

```
扫描: 405个币种
↓
基础层: 0个通过 (confidence_min=50 > Max 32) ❌
↓
Gate层: 无候选
↓
最终: 0个信号 ❌
```

### v7.2.19（数据驱动配置）

```
扫描: 405个币种
↓
基础层: 40-80个候选 (10-20%通过率) ✅
  - confidence≥15 (P75水平)
  - edge≥0.12 (略高于中位)
↓
Gate层: 过滤
  - Gate 2: F≥-10 (允许适度流出)
  - Gate 4: P≥50% (适度胜率要求)
↓
最终: 5-15个Prime信号 ✅
```

---

## 🎯 关键修复点

### 修复1：解除confidence_min致命拦截

**问题**: confidence_min=50，但实际Max=32
- 100%币种被这一条拒绝

**修复**: confidence_min=50 → **15**
- 基于P75水平
- 预期通过率25%

### 修复2：F因子阈值回归现实

**问题**: F_min=10，但中位=-1, P75=1
- 要求"明显资金流入"，但市场常态是轻度流出

**修复**: F_min=10 → **-10**
- 允许适度资金流出
- 符合实际市场状态

### 修复3：edge阈值降低到可达水平

**问题**: edge_min=0.20，超过P75(0.15)
- 75%币种被拒绝

**修复**: edge_min=0.20 → **0.12**
- 略高于中位数(0.09)
- 仍比旧配置(0.10)严格

### 修复4：prime_strength基于实际最大值

**问题**: prime_strength_min=50，接近Max(56)
- 90%币种被拒绝

**修复**: prime_strength_min=50 → **42**
- 恰好等于P75
- 预期通过率25%

---

## 📊 技术细节

### 阈值与数据分布对比

```
confidence分布:
  Min=0  ─────── P25=5 ─── [中位=9] ─── [P75=15] ─────── Max=32
                                          ↑
                                    v7.2.19=15 ✅
                                                               ↑
                                                         v7.2.18=50 ❌

edge分布:
  Min=-0.11 ── P25=0.04 ── [中位=0.09] ── [P75=0.15] ── Max=0.32
                               ↑              ↑
                          v7.2.19=0.12   v7.2.18=0.20 ❌

F因子分布:
  Min=-100 ─── P25=-4 ─ [中位=-1] ─ [P75=1] ──── Max=95
                            ↑
                      v7.2.19=-10 ✅
                                                ↑
                                          v7.2.18=10 ❌
```

---

## 🔍 配置哲学变化

### v7.2.18理念（理想主义）

**目标**: 追求"高质量信号"
**方法**: 设置理论上的高标准
**结果**: ❌ 脱离实际，0信号

**类比**:
> "招聘要求985硕士+5年经验"
> 现实：99%应聘者是本科+2年经验
> 结果：没人能通过面试

### v7.2.19理念（数据驱动）

**目标**: 平衡质量与数量
**方法**: 基于实际数据分布设置阈值
**结果**: ✅ 预期5-15个优质信号

**类比**:
> "招聘要求：本科+3年经验（基于实际P75水平）"
> 结果：筛选出前25%候选人，质量和数量平衡

---

## 🧪 验证

### JSON语法验证
```bash
✅ JSON语法正确
✅ 配置加载成功
```

### 配置完整性
```json
{
  "version": "v7.2.19_data_driven",
  "基础分析阈值": {
    "mature_coin": {
      "confidence_min": 15,      ✅ P75水平
      "prime_strength_min": 42,  ✅ P75水平
      "edge_min": 0.12,          ✅ 略高于中位
      "prime_prob_min": 0.50     ✅ 适度提升
    }
  },
  "v72闸门阈值": {
    "gate2_fund_support": {
      "F_min": -10               ✅ 基于F分布
    },
    "gate3_ev": {
      "EV_min": 0.015            ✅ 1.5%
    },
    "gate4_probability": {
      "P_min": 0.50              ✅ 50%
    }
  }
}
```

---

## 📌 回滚方案

如需回到v7.2.18（不推荐）：
```bash
# 查看备份
git log --oneline -5

# 回滚到特定commit
git checkout <commit_hash> -- config/signal_thresholds.json
```

如需回到最初旧配置：
```bash
cp config/signal_thresholds_backup_20251111_050634.json config/signal_thresholds.json
```

---

## 📖 相关文档

- `docs/v7.2.18_HIGH_QUALITY_THRESHOLD.md` - 理想配置的失败教训
- `standards/SYSTEM_ENHANCEMENT_STANDARD.md` - 系统增强标准

---

## ✅ 检查清单

- [x] 基于实际数据分析
- [x] 修改基础分析阈值
- [x] 修改Gate阈值
- [x] JSON语法验证通过
- [x] 配置加载验证通过
- [x] 创建变更文档
- [ ] Git提交配置变更
- [ ] 生产环境测试

---

## 💡 经验教训

### ❌ 不应该做的

1. **脱离实际数据设置阈值**
   - confidence_min=50，但Max=32
   - 导致100%拒绝

2. **基于理论理想值而非实际分布**
   - "高质量应该这样"
   - 而不是"实际数据是这样"

3. **未验证配置在实际数据上的效果**
   - 应该先测试通过率
   - 再正式应用

### ✅ 应该做的

1. **数据驱动决策**
   - 收集实际扫描数据
   - 分析P25/中位/P75/Max
   - 基于分位数设置阈值

2. **预测通过率**
   - P75阈值 → 约25%通过
   - 中位阈值 → 约50%通过

3. **逐步调整**
   - 先恢复可用性（有信号）
   - 再根据质量反馈微调

---

**状态**: ✅ 配置已修复，待重启验证
**下一步**: 重启系统，观察实际效果，根据需要微调
