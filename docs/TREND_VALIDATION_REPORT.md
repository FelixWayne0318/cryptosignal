# T（趋势）指标验证报告

## 一、验证清单检查

### ✅ 1. 物理意义验证

**当前实现**：
```python
T = 趋势强度（0-100）
Tm = 趋势方向（-1空/0震荡/1多）
```

**计算方法**：
1. EMA排列（EMA5 vs EMA20）
2. 价格斜率（线性回归）
3. R²拟合优度（置信度）

**物理意义**：
- T分数：趋势的强度（0=弱，100=强）
- Tm标记：市场实际方向
- 做多时：T高 + Tm=1 = 强势上涨趋势 ✅
- 做空时：T高 + Tm=-1 = 强势下跌趋势 ✅

✅ **结论**：物理意义清晰明确

---

### ✅ 2. 方向性验证

**当前实现**：
```python
if side_long:
    # 做多：斜率越大越好
    slope_score = directional_score(slope_per_bar, ...)
else:
    # 做空：斜率越小（负值越大）越好
    slope_score = directional_score(-slope_per_bar, ...)  # 取反
```

**测试场景**：
| 场景 | 斜率 | 做多T | 做空T | 正确性 |
|------|------|-------|-------|--------|
| 强势上涨 | +0.10 | 高分 | 低分 | ✅ |
| 强势下跌 | -0.10 | 低分 | 高分 | ✅ |
| 震荡 | ~0 | 中分 | 中分 | ✅ |

✅ **结论**：方向性处理正确

---

### ✅ 3. 持续性验证

**当前实现**：
```python
# 使用线性回归斜率（12根K线）
slope, r2 = _linreg_r2(C[-LB:])  # LB=12
slope_per_bar = slope / atr
```

**优点**：
1. ✅ 使用斜率而非两点比较（和CVD改进一致）
2. ✅ 使用R²判断趋势稳定性
3. ✅ 不会被单根K线主导

**对比CVD方法**：
| 特性 | CVD | T（趋势） |
|------|-----|----------|
| 计算方式 | 线性回归斜率 | 线性回归斜率 |
| 持续性判断 | R² >= 0.7 | R²作为置信度加权 |
| 震荡惩罚 | R² < 0.7 打折 | R²低时加分少 |

✅ **结论**：持续性验证方法与CVD一致，设计合理

---

### ✅ 4. 单根K线主导问题

**测试**：
- 使用12根K线的线性回归
- 平均每根K线权重 ≈ 8.3%
- 单根K线无法主导

✅ **结论**：不存在单根K线主导问题

---

### ✅ 5. 滞后性分析

**EMA滞后性**：
- EMA5：滞后约2-3根K线
- EMA20：滞后约10根K线

**斜率滞后性**：
- 使用最近12根K线
- 滞后约6根K线（窗口中点）

**评估**：
- ⚠️ 有一定滞后（趋势跟踪的固有特性）
- ✅ 但滞后是可接受的（趋势确认需要时间）
- ✅ 通过R²置信度降低虚假信号

✅ **结论**：滞后性可接受（趋势指标的本质特征）

---

## 二、是否需要改为带符号？

### 当前设计
```
T = 0-100（强度）
Tm = -1/0/1（方向）
```

### 如果改为带符号
```
T = -100到+100（方向+强度）
- 正数：上涨趋势
- 负数：下跌趋势
- 绝对值：趋势强度
```

### 对比分析

| 方面 | 当前设计（T + Tm） | 带符号设计（T signed） |
|------|-------------------|----------------------|
| 表达能力 | 分离（强度+方向） | 合并（符号=方向，值=强度） |
| 可读性 | T=80, Tm=1（强势上涨） | T=+80（强势上涨） |
| 多空对称 | T反映适配度（做多/做空都0-100） | T反映市场方向（绝对） |
| 与C/F一致性 | 不一致 | 一致 |

### 决策

**参考优化计划**：
```
### Q1：哪些指标需要带符号？
- ✅ C（CVD）：需要，区分流入/流出
- ✅ F（资金领先）：需要，区分谁领先谁
- ❌ V（量能）：不需要，多空都需要量能
- ❌ O（持仓）：不需要，已在打分时考虑方向
- ❌ T（趋势）：不需要，已有Tm标记方向
```

**建议：保持当前设计（T + Tm分离）**

**理由**：
1. T表示"趋势与信号方向的适配度"（0-100）
   - 做多信号：T高 = 上涨趋势强（适配）
   - 做空信号：T高 = 下跌趋势强（适配）

2. Tm表示"市场实际趋势方向"（-1/0/1）
   - 独立于交易方向
   - 用于环境判断

3. 不改为带符号的好处：
   - T反映"趋势对当前信号的支持度"
   - 多空信号的T分数可以直接比较
   - Tm提供额外的市场方向信息

4. 如果改为带符号：
   - 做多和做空的T无法直接比较
   - 需要额外字段标记市场方向
   - 反而增加复杂度

✅ **最终决定：T保持0-100 + Tm方向标记，不改为带符号**

---

## 三、与CVD对比总结

| 维度 | CVD | T（趋势） | 一致性 |
|------|-----|----------|--------|
| 计算方法 | 线性回归斜率 | 线性回归斜率 | ✅ |
| 持续性验证 | R² >= 0.7 | R²置信度加权 | ✅ |
| 震荡处理 | R²低打折 | R²低加分少 | ✅ |
| 符号设计 | 带符号（-100到+100） | 不带符号（0-100 + Tm） | ⚠️ 不同但合理 |

**结论**：
- T指标的计算逻辑与CVD一致（使用斜率+R²）
- 不需要改为带符号（设计目的不同）
- 当前实现已经很合理，无需优化

---

## 四、建议改进（可选）

### 改进1：在Telegram显示中强调Tm

**当前**：
```
• 趋势 🟢 78 —— 强势/上行倾向 [多头]
```

**建议**：
```
• 趋势 🟢 78 —— 强势上涨趋势 (Tm=↑) [趋势适配✓]
或
• 趋势 🟡 45 —— 下跌趋势 (Tm=↓) [趋势不适配⚠️]（做多信号遇到下跌趋势）
```

### 改进2：添加R²显示（类似CVD的"持续✓"）

**建议**：
```
• 趋势 🟢 78 —— 强势上涨趋势 (R²=0.82, 稳定✓)
• 趋势 🟡 62 —— 震荡上行 (R²=0.45, 不稳⚠️)
```

---

## 五、最终结论

✅ **T（趋势）指标验证通过**

1. ✅ 物理意义清晰
2. ✅ 方向性处理正确
3. ✅ 使用斜率+R²（与CVD一致）
4. ✅ 无单根K线主导问题
5. ✅ 滞后性可接受
6. ✅ 不需要改为带符号（当前设计更合理）

**建议**：
- 保持当前实现
- 可选：优化Telegram显示（强调Tm和R²）
- 无需代码改动
